$(function(){App.Router=new(Backbone.Router.extend({routes:{addCommunity:"CommunityForm","addCommunity/:CommunityId":"CommunityForm",login:"MemberLogin",logout:"MemberLogout",listCommunity:"ListCommunity",siteFeedback:"viewAllFeedback",dashboard:"Dashboard",request:"commRequest",earthrequest:"earthRequest",reports:"Reports","reports/edit/:resportId":"ReportForm","reports/add":"ReportForm",publication:"Publication","publication/add":"PublicationForm",configuration:"Configuration","publication/add/:publicationId":"PublicationForm","publicationdetail/:publicationId":"PublicationDetails","courses/:publicationId":"addCourses",trendreport:"TrendReport","communityreport/:syncDate/:name/:code":"communityReport"},initialize:function(){this.bind("all",this.checkLoggedIn),this.bind("all",this.routeStartupTasks),this.bind("all",this.renderNav)},routeStartupTasks:function(){$("#invitationdiv").hide(),$("#debug").hide()},findIndicesOfMax:function(a,b){for(var c=[],d=0;d<a.length;d++)c.push(d),c.length>b&&(c.sort(function(b,c){return a[c]-a[b]}),c.pop());return a.length<=b&&c.sort(function(b,c){return a[c]-a[b]}),c},findIndicesOfMin:function(a,b){for(var c=[],d=0;d<a.length;d++)c.push(d),c.length>b&&(c.sort(function(b,c){return a[b]-a[c]}),c.pop());return a.length<=b&&c.sort(function(b,c){return a[b]-a[c]}),c},aggregateDataForTrendReport:function(a,b){if(b.length<1){var c={Visits:{male:0,female:0},New_Signups:{male:0,female:0},Deleted:{male:0,female:0},Most_Freq_Open:[],Highest_Rated:[],Lowest_Rated:[],ResourceViews:{male:0,female:0}};return c}var d=b[0];void 0==d&&alert("No Activity Logged for this period");var e=[],f=[],g=[],h=0,i=0,j=0,k=0,l=[],m=[],n=[],o=[],p=[],q=[],r=0,s=0;d.resourcesIds&&(e=d.resourcesIds),d.resources_names&&(g=d.resources_names),d.resources_opened&&(f=d.resources_opened),d.male_visits&&(h=d.male_visits),d.female_visits&&(i=d.female_visits),d.male_new_signups&&(j=d.male_new_signups),d.female_new_signups&&(k=d.female_new_signups),d.male_rating&&(l=d.male_rating),d.female_rating&&(m=d.female_rating),d.male_timesRated&&(n=d.male_timesRated),d.female_timesRated&&(o=d.female_timesRated),d.male_opened&&(p=d.male_opened),d.female_opened&&(q=d.female_opened),d.male_deleted_count&&(s=d.male_deleted_count),d.female_deleted_count&&(r=d.female_deleted_count);for(var t=0;t<b.length;t++)if(t>0){var u=b[t];h+=u.male_visits,i+=u.female_visits,j+=u.male_new_signups?u.male_new_signups:0,k+=u.female_new_signups?u.female_new_signups:0,r+=u.female_deleted_count?u.female_deleted_count:0,s+=u.male_deleted_count?u.male_deleted_count:0;for(var v=u.resourcesIds,w=u.resources_names,x=u.resources_opened,y=0;y<v.length;y++){var z=v[y],A=e.indexOf(z);-1==A?(e.push(z),l.push(u.male_rating[y]),m.push(u.female_rating[y]),n.push(u.male_timesRated[y]),o.push(u.female_timesRated[y])):(l[A]=l[A]+u.male_rating[y],m[A]=m[A]+u.female_rating[y],n[A]=n[A]+u.male_timesRated[y],o[A]=o[A]+u.female_timesRated[y])}if(x)for(var y=0;y<x.length;y++){var z=x[y],A=f.indexOf(z);-1==A?(f.push(z),void 0!=w&&null!=w&&w.length>0&&g.push(w[y]),p.push(u.male_opened[y]),q.push(u.female_opened[y])):(p[A]=p[A]+u.male_opened[y],q[A]=q[A]+u.female_opened[y])}}for(var B=0,y=0;y<q.length;y++)B+=q[y];for(var C=0,y=0;y<p.length;y++)C+=p[y];for(var D=[],E=[],y=0;y<f.length;y++)D.push(p[y]+q[y]);var F=[],G=5;F=D.length>=G?this.findIndicesOfMax(D,G):this.findIndicesOfMax(D,D.length);var H,I;if(D.length>0)for(var J,K,y=0;y<F.length;y++){var L=new App.Models.Resource({_id:f[F[y]]});L.fetch({async:!1});var M=f[F[y]],N=L.get("title");if(console.log(d.resources_names),!N){var O=f.indexOf(M);console.log(O),N=g[F[y]]}J={resourceName:N,timesOpenedCumulative:D[F[y]],timesOpenedByMales:p[F[y]],timesOpenedByFemales:q[F[y]]},-1===(K=e.indexOf(f[F[y]]))?(J.avgRatingCumulative="N/A",J.avgRatingByMales="N/A",J.avgRatingByFemales="N/A",J.timesRatedByMales="N/A",J.timesRatedByFemales="N/A",J.timesRatedCumulative="N/A"):(H=n[K]+o[K],I=l[K]+m[K],J.avgRatingCumulative=Math.round(I/H*100)/100,J.avgRatingByMales=l[K],J.avgRatingByFemales=m[K],J.timesRatedByMales=n[K],J.timesRatedByFemales=o[K],J.timesRatedCumulative=H),E.push(J)}for(var P=[],Q=[],R=[],S=5,y=0;y<e.length;y++)H=n[y]+o[y],I=l[y]+m[y],P.push(I/H);var T=[],U=[];if(P.length>=G?(T=this.findIndicesOfMax(P,G),U=this.findIndicesOfMin(P,S)):(T=this.findIndicesOfMax(P,P.length),U=this.findIndicesOfMin(P,P.length)),P.length>0){for(var V,W,y=0;y<T.length;y++){var L=new App.Models.Resource({_id:e[T[y]]});L.fetch({async:!1});var N=L.get("title");if(!N){var O=f.indexOf(M);console.log(O),N=g[F[y]]}H=n[T[y]]+o[T[y]],V={resourceName:N,avgRatingCumulative:Math.round(100*P[T[y]])/100,avgRatingByMales:l[T[y]],avgRatingByFemales:m[T[y]],timesRatedByMales:n[T[y]],timesRatedByFemales:o[T[y]],timesRatedCumulative:n[T[y]]+o[T[y]]},-1===(K=f.indexOf(e[T[y]]))?(V.timesOpenedByMales="N/A",V.timesOpenedByFemales="N/A",V.timesOpenedCumulative="N/A"):(V.timesOpenedByMales=p[K],V.timesOpenedByFemales=q[K],V.timesOpenedCumulative=D[K]),Q.push(V)}for(var y=0;y<U.length;y++){H=n[U[y]]+o[U[y]];var L=new App.Models.Resource({_id:e[U[y]]});L.fetch({async:!1});var N=L.get("title");if(!N){var O=f.indexOf(M);console.log(O),N=g[F[y]]}W={resourceName:N,avgRatingCumulative:Math.round(100*P[U[y]])/100,avgRatingByMales:l[U[y]],avgRatingByFemales:m[U[y]],timesRatedByMales:n[U[y]],timesRatedByFemales:o[U[y]],timesRatedCumulative:n[U[y]]+o[U[y]]},-1===(K=f.indexOf(e[U[y]]))?(W.timesOpenedByMales="N/A",W.timesOpenedByFemales="N/A",W.timesOpenedCumulative="N/A"):(W.timesOpenedByMales=p[K],W.timesOpenedByFemales=q[K],W.timesOpenedCumulative=D[K]),R.push(W)}}var c={Visits:{male:h,female:i},New_Signups:{male:j,female:k},Deleted:{male:s,female:r},Most_Freq_Open:E,Highest_Rated:Q,Lowest_Rated:R,ResourceViews:{male:C,female:B}};return c},turnDateFromMMDDYYYYToYYYYMMDDFormat:function(a){var b=a.match(/\d+/g),c=b[0],d=b[1],e=b[2];return e+"/"+c+"/"+d},turnDateToYYYYMMDDFormat:function(a){var b=a.getFullYear().toString(),c=(a.getMonth()+1).toString(),d=a.getDate().toString(),e=c.split(""),f=d.split(""),g=b+"/"+(2===e.length?c:"0"+e[0])+"/"+(2===f.length?d:"0"+f[0]);return g},changeDateFormat:function(a){var b=a.match(/\d+/g),c=b[0],d=b[1],e=b[2];return c+"/"+d+"/"+e},Configuration:function(){var a=new App.Collections.Configurations;a.fetch({async:!1});var b=a.first(),c=new App.Views.Configurations({model:b});c.render(),App.$el.children(".body").html(c.el)},getRegisteredMembersCount:function(a,b){var c=0,d=0;$.ajax({url:'/activitylog/_design/bell/_view/GetMaleCountByCommunity?key="'+a+'"',type:"GET",dataType:"json",async:!1,success:function(e){e.rows[0]&&(c=e.rows[0].value),$.ajax({url:'/activitylog/_design/bell/_view/GetFemaleCountByCommunity?key="'+a+'"',type:"GET",dataType:"json",async:!1,success:function(a){a.rows[0]&&(d=a.rows[0].value),b(c,d)}})}})},getRegisteredMembersCountFromMembersDB:function(a,b){var c=0,d=0;$.ajax({url:'/members/_design/bell/_view/MaleCountByCommunity?key="'+a+'"',type:"GET",dataType:"json",async:!1,success:function(e){e.rows[0]&&(c=e.rows[0].value),$.ajax({url:'/members/_design/bell/_view/FemaleCountByCommunity?key="'+a+'"',type:"GET",dataType:"json",async:!1,success:function(a){a.rows[0]&&(d=a.rows[0].value),b(c,d)}})}})},getTotalMemberVisits:function(a,b){var c=0,d=0;$.ajax({url:'/activitylog/_design/bell/_view/GetMaleVisitsByCommunity?key="'+a+'"',type:"GET",dataType:"json",async:!1,success:function(e){e.rows[0]&&(c=e.rows[0].value),$.ajax({url:'/activitylog/_design/bell/_view/GetFemaleVisitsByCommunity?key="'+a+'"',type:"GET",dataType:"json",async:!1,success:function(a){a.rows[0]&&(d=a.rows[0].value),b(c,d)}})}})},lastSyncDateForCommunity:function(a,b){var a=a,c=$.url().data.attr.host.split("."),d=c[0],e=$.url().data.attr.authority,f="";$.ajax({url:"http://"+d+":oleoleole@"+e+'/community/_design/bell/_view/getCommunityByCode?_include_docs=true&key="'+a+'"',type:"GET",dataType:"jsonp",success:function(a){var c=a.rows[0].value;a.rows[0].id;f=c.lastActivitiesSyncDate,b(f)},async:!1})},communityReport:function(a,b,c){var d=this,e=c,b=b,f=a,g=new Date,h=new Date(g.getFullYear(),g.getMonth(),1),i=new Date(h.getFullYear(),h.getMonth(),h.getDate()-1),j=new Date(i.getFullYear(),i.getMonth(),1),k=new Date(j.getFullYear(),j.getMonth(),j.getDate()-1),l=new Date(k.getFullYear(),k.getMonth(),1),m=new Date(l.getFullYear(),l.getMonth(),l.getDate()-1),n=new Date(m.getFullYear(),m.getMonth(),1),o=new Date(n.getFullYear(),n.getMonth(),n.getDate()-1),p=new Date(o.getFullYear(),o.getMonth(),1),q=new Date(p.getFullYear(),p.getMonth(),p.getDate()-1),r=new Date(q.getFullYear(),q.getMonth(),1),s=new Date(r.getFullYear(),r.getMonth(),r.getDate()-1),t=new Date(s.getFullYear(),s.getMonth(),1),u=new Date(t.getFullYear(),t.getMonth(),t.getDate()-1),v=new Date(u.getFullYear(),u.getMonth(),1),w=new Date(v.getFullYear(),v.getMonth(),v.getDate()-1),x=new Date(w.getFullYear(),w.getMonth(),1),y=new Date(x.getFullYear(),x.getMonth(),x.getDate()-1),z=new Date(y.getFullYear(),y.getMonth(),1),A=new Date(z.getFullYear(),z.getMonth(),p.getDate()-1),B=new Date(A.getFullYear(),A.getMonth(),1),C=new Date(B.getFullYear(),B.getMonth(),B.getDate()-1),D=new Date(C.getFullYear(),C.getMonth(),1),E=d.changeDateFormat(d.turnDateToYYYYMMDDFormat(D)),F=d.changeDateFormat(d.turnDateToYYYYMMDDFormat(g)),G=new App.Collections.ActivityLog,H=App.Server+'/activitylog/_design/bell/_view/getDocByCommunityCode?include_docs=true&startkey=["'+e+'","'+E+'"]&endkey=["'+e+'","'+F+'"]';G.setUrl(H),G.fetch({async:!1}),G.toJSON();var I=[],J=[],K=[],L=[],M=[],N=[],O=[],P=[],Q=[],R=[],S=[],T=[];for(var U in G.models){var V=d.turnDateFromMMDDYYYYToYYYYMMDDFormat(G.models[U].get("logDate"));V>=d.turnDateToYYYYMMDDFormat(h)&&V<=d.turnDateToYYYYMMDDFormat(g)?I.push(JSON.parse(JSON.stringify(G.models[U]))):V>=d.turnDateToYYYYMMDDFormat(j)&&V<=d.turnDateToYYYYMMDDFormat(i)?J.push(JSON.parse(JSON.stringify(G.models[U]))):V>=d.turnDateToYYYYMMDDFormat(l)&&V<=d.turnDateToYYYYMMDDFormat(k)?K.push(JSON.parse(JSON.stringify(G.models[U]))):V>=d.turnDateToYYYYMMDDFormat(n)&&V<=d.turnDateToYYYYMMDDFormat(m)?L.push(JSON.parse(JSON.stringify(G.models[U]))):V>=d.turnDateToYYYYMMDDFormat(p)&&V<=d.turnDateToYYYYMMDDFormat(o)?M.push(JSON.parse(JSON.stringify(G.models[U]))):V>=d.turnDateToYYYYMMDDFormat(r)&&V<=d.turnDateToYYYYMMDDFormat(q)?N.push(JSON.parse(JSON.stringify(G.models[U]))):V>=d.turnDateToYYYYMMDDFormat(t)&&V<=d.turnDateToYYYYMMDDFormat(s)?O.push(JSON.parse(JSON.stringify(G.models[U]))):V>=d.turnDateToYYYYMMDDFormat(v)&&V<=d.turnDateToYYYYMMDDFormat(u)?P.push(JSON.parse(JSON.stringify(G.models[U]))):V>=d.turnDateToYYYYMMDDFormat(x)&&V<=d.turnDateToYYYYMMDDFormat(w)?Q.push(JSON.parse(JSON.stringify(G.models[U]))):V>=d.turnDateToYYYYMMDDFormat(z)&&V<=d.turnDateToYYYYMMDDFormat(y)?R.push(JSON.parse(JSON.stringify(G.models[U]))):V>=d.turnDateToYYYYMMDDFormat(B)&&V<=d.turnDateToYYYYMMDDFormat(A)?S.push(JSON.parse(JSON.stringify(G.models[U]))):V>=d.turnDateToYYYYMMDDFormat(D)&&V<=d.turnDateToYYYYMMDDFormat(C)&&T.push(JSON.parse(JSON.stringify(G.models[U])))}var W=d.aggregateDataForTrendReport("communityX",I),X=d.aggregateDataForTrendReport("communityX",J),Y=d.aggregateDataForTrendReport("communityX",K),Z=d.aggregateDataForTrendReport("communityX",L),_=d.aggregateDataForTrendReport("communityX",M),aa=d.aggregateDataForTrendReport("communityX",N),ba=d.aggregateDataForTrendReport("communityX",O),ca=d.aggregateDataForTrendReport("communityX",P),da=d.aggregateDataForTrendReport("communityX",Q),ea=d.aggregateDataForTrendReport("communityX",R),fa=d.aggregateDataForTrendReport("communityX",S),ga=d.aggregateDataForTrendReport("communityX",T),ha=d.aggregateDataForTrendReport("communityX",JSON.parse(JSON.stringify(G.models)));console.log(W);var ia=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],ja={male:0,female:0};d.getRegisteredMembersCount(e,function(a,b){ja.male=a,ja.female=b});var ka={male:0,female:0};d.getRegisteredMembersCountFromMembersDB(e,function(a,b){ka.male=a,ka.female=b});var la={male:0,female:0};d.getTotalMemberVisits(e,function(a,b){la.male=a,la.female=b});var ma={male:ja.male,female:ja.female,total:0},na={male:ja.male-W.New_Signups.male,female:ja.female-W.New_Signups.female,total:0},oa={male:na.male-X.New_Signups.male,female:na.female-X.New_Signups.female,total:0},pa={male:oa.male-Y.New_Signups.male,female:oa.female-Y.New_Signups.female,total:0},qa={male:pa.male-Z.New_Signups.male,female:pa.female-Z.New_Signups.female,total:0},ra={male:qa.male-_.New_Signups.male,female:qa.female-_.New_Signups.female,total:0},sa={male:ra.male-aa.New_Signups.male,female:ra.female-aa.New_Signups.female,total:0},ta={male:sa.male-ba.New_Signups.male,female:sa.female-ba.New_Signups.female,total:0},ua={male:ta.male-ca.New_Signups.male,female:ta.female-ca.New_Signups.female,total:0},va={male:ua.male-da.New_Signups.male,female:ua.female-da.New_Signups.female,total:0},wa={male:va.male-ea.New_Signups.male,female:va.female-ea.New_Signups.female,total:0},xa={male:wa.male-fa.New_Signups.male,female:wa.female-fa.New_Signups.female,total:0};ma.total=ma.male+ma.female,na.total=na.male+na.female,oa.total=oa.male+oa.female,pa.total=pa.male+pa.female,qa.total=qa.male+qa.female,ra.total=ra.male+ra.female,sa.total=sa.male+sa.female,ta.total=ta.male+ta.female,ua.total=ua.male+ua.female,va.total=va.male+va.female,wa.total=wa.male+wa.female,xa.total=xa.male+xa.female;var ya={male:ka.male,female:ka.female,total:0},za={male:ka.male-(W.New_Signups.male-W.Deleted.male),female:ka.female-(W.New_Signups.female-W.Deleted.female),total:0},Aa={male:za.male-(X.New_Signups.male-X.Deleted.male),female:za.female-(X.New_Signups.female-X.Deleted.female),total:0},Ba={male:Aa.male-(Y.New_Signups.male-Y.Deleted.male),female:Aa.female-(Y.New_Signups.female-Y.Deleted.female),total:0},Ca={male:Ba.male-(Z.New_Signups.male-Z.Deleted.male),female:Ba.female-(Z.New_Signups.female-Z.Deleted.female),total:0},Da={male:Ca.male-(_.New_Signups.male-_.Deleted.male),female:Ca.female-(_.New_Signups.female-_.Deleted.female),total:0},Ea={male:Da.male-(aa.New_Signups.male-aa.Deleted.male),female:Da.female-(aa.New_Signups.female-aa.Deleted.female),total:0},Fa={male:Ea.male-(ba.New_Signups.male-ba.Deleted.male),female:Ea.female-(ba.New_Signups.female-ba.Deleted.female),total:0},Ga={male:Fa.male-(ca.New_Signups.male-ca.Deleted.male),female:Fa.female-(ca.New_Signups.female-ca.Deleted.female),total:0},Ha={male:Ga.male-(da.New_Signups.male-da.Deleted.male),female:Ga.female-(da.New_Signups.female-da.Deleted.female),total:0},Ia={male:Ha.male-(ea.New_Signups.male-ea.Deleted.male),female:Ha.female-(ea.New_Signups.female-ea.Deleted.female),total:0},Ja={male:Ia.male-(fa.New_Signups.male-fa.Deleted.male),female:Ia.female-(fa.New_Signups.female-fa.Deleted.female),total:0};ya.total=ya.male+ya.female,za.total=za.male+za.female,Aa.total=Aa.male+Aa.female,Ba.total=Ba.male+Ba.female,Ca.total=Ca.male+Ca.female,Da.total=Da.male+Da.female,Ea.total=Ea.male+Ea.female,Fa.total=Fa.male+Fa.female,Ga.total=Ga.male+Ga.female,Ha.total=Ha.male+Ha.female,Ia.total=Ia.male+Ia.female,Ja.total=Ja.male+Ja.female;var Ka={male:la.male,female:la.female,total:0},La={male:la.male-W.Visits.male,female:la.female-W.Visits.female,total:0},Ma={male:La.male-X.Visits.male,female:La.female-X.Visits.female,total:0},Na={male:Ma.male-Y.Visits.male,female:Ma.female-Y.Visits.female,total:0},Oa={male:Na.male-Z.Visits.male,female:Na.female-Z.Visits.female,total:0},Pa={male:Oa.male-_.Visits.male,female:Oa.female-_.Visits.female,total:0},Qa={male:Pa.male-aa.Visits.male,female:Pa.female-aa.Visits.female,total:0},Ra={male:Qa.male-ba.Visits.male,female:Qa.female-ba.Visits.female,total:0},Sa={male:Ra.male-ca.Visits.male,female:Ra.female-ca.Visits.female,total:0},Ta={male:Sa.male-da.Visits.male,female:Sa.female-da.Visits.female,total:0},Ua={male:Ta.male-ea.Visits.male,female:Ta.female-ea.Visits.female,total:0},Va={male:Ua.male-fa.Visits.male,female:Ua.female-fa.Visits.female,total:0};Ka.total=Ka.male+Ka.female,La.total=La.male+La.female,Ma.total=Ma.male+Ma.female,Na.total=Na.male+Na.female,Oa.total=Oa.male+Oa.female,Pa.total=Pa.male+Pa.female,Qa.total=Qa.male+Qa.female,Ra.total=Ra.male+Ra.female,Sa.total=Sa.male+Sa.female,Ta.total=Ta.male+Ta.female,Ua.total=Ua.male+Ua.female,Va.total=Va.male+Va.female;var Wa=new App.Views.TrendActivityReport;Wa.data=ha,Wa.startDate=G.startkey,Wa.endDate=G.endkey,Wa.CommunityName=b,Wa.lastActivitySyncDate=f,Wa.render(),App.$el.children(".body").html(Wa.el),$("#trend-report-div-total-members").highcharts({chart:{type:"column",borderColor:"#999999",borderWidth:2,borderRadius:10},title:{text:"Total Registered Members Past 12 Months"},xAxis:{categories:[ia[D.getMonth()]+" "+D.getFullYear(),ia[B.getMonth()]+" "+B.getFullYear(),ia[z.getMonth()]+" "+z.getFullYear(),ia[x.getMonth()]+" "+x.getFullYear(),ia[v.getMonth()]+" "+v.getFullYear(),ia[t.getMonth()]+" "+t.getFullYear(),ia[r.getMonth()]+" "+r.getFullYear(),ia[p.getMonth()]+" "+p.getFullYear(),ia[n.getMonth()]+" "+n.getFullYear(),ia[l.getMonth()]+" "+l.getFullYear(),ia[j.getMonth()]+" "+j.getFullYear(),ia[h.getMonth()]+" "+h.getFullYear()]},yAxis:{min:0,title:{text:"Members Count"}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td><td style="padding:0"><b>{point.y}</b></td></tr>',footerFormat:"</table>",shared:!0,useHTML:!0},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:[{name:"Males",data:[Ja.male,Ia.male,Ha.male,Ga.male,Fa.male,Ea.male,Da.male,Ca.male,Ba.male,Aa.male,za.male,ya.male],color:"#33ccff"},{name:"Females",data:[Ja.female,Ia.female,Ha.female,Ga.female,Fa.female,Ea.female,Da.female,Ca.female,Ba.female,Aa.female,za.female,ya.female],color:"#66ff66"},{name:"Total",data:[Ja.total,Ia.total,Ha.total,Ga.total,Fa.total,Ea.total,Da.total,Ca.total,Ba.total,Aa.total,za.total,ya.total],color:"#ff9900"}]}),$("#trend-report-div-total-member-visits").highcharts({chart:{type:"column",borderColor:"#999999",borderWidth:2,borderRadius:10},title:{text:"Total Visits Past 12 Months"},xAxis:{categories:[ia[D.getMonth()]+" "+D.getFullYear(),ia[B.getMonth()]+" "+B.getFullYear(),ia[z.getMonth()]+" "+z.getFullYear(),ia[x.getMonth()]+" "+x.getFullYear(),ia[v.getMonth()]+" "+v.getFullYear(),ia[t.getMonth()]+" "+t.getFullYear(),ia[r.getMonth()]+" "+r.getFullYear(),ia[p.getMonth()]+" "+p.getFullYear(),ia[n.getMonth()]+" "+n.getFullYear(),ia[l.getMonth()]+" "+l.getFullYear(),ia[j.getMonth()]+" "+j.getFullYear(),ia[h.getMonth()]+" "+h.getFullYear()]},yAxis:{min:0,title:{text:"Visits Count"}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td><td style="padding:0"><b>{point.y}</b></td></tr>',footerFormat:"</table>",shared:!0,useHTML:!0},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:[{name:"Males",data:[Va.male,Ua.male,Ta.male,Sa.male,Ra.male,Qa.male,Pa.male,Oa.male,Na.male,Ma.male,La.male,Ka.male],color:"#33ccff"},{name:"Females",data:[Va.female,Ua.female,Ta.female,Sa.female,Ra.female,Qa.female,Pa.female,Oa.female,Na.female,Ma.female,La.female,Ka.female],color:"#66ff66"},{name:"Total",data:[Va.total,Ua.total,Ta.total,Sa.total,Ra.total,Qa.total,Pa.total,Oa.total,Na.total,Ma.total,La.total,Ka.total],color:"#ff9900"}]}),$("#trend-report-div-new-memberships").highcharts({chart:{type:"column",borderColor:"#999999",borderWidth:2,borderRadius:10},title:{text:"Active Members This Month"},xAxis:{categories:[ia[D.getMonth()]+" "+D.getFullYear(),ia[B.getMonth()]+" "+B.getFullYear(),ia[z.getMonth()]+" "+z.getFullYear(),ia[x.getMonth()]+" "+x.getFullYear(),ia[v.getMonth()]+" "+v.getFullYear(),ia[t.getMonth()]+" "+t.getFullYear(),ia[r.getMonth()]+" "+r.getFullYear(),ia[p.getMonth()]+" "+p.getFullYear(),ia[n.getMonth()]+" "+n.getFullYear(),ia[l.getMonth()]+" "+l.getFullYear(),ia[j.getMonth()]+" "+j.getFullYear(),ia[h.getMonth()]+" "+h.getFullYear()]},yAxis:{min:0,title:{text:"Members Count"}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td><td style="padding:0"><b>{point.y}</b></td></tr>',footerFormat:"</table>",shared:!0,useHTML:!0},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:[{name:"Males",data:[xa.male,wa.male-xa.male,va.male-wa.male,ua.male-va.male,ta.male-ua.male,sa.male-ta.male,ra.male-sa.male,qa.male-ra.male,pa.male-qa.male,oa.male-pa.male,na.male-oa.male,ja.male-na.male],color:"#33ccff"},{name:"Females",data:[xa.female,wa.female-xa.female,va.female-wa.female,ua.female-va.female,ta.female-ua.female,sa.female-ta.female,ra.female-sa.female,qa.female-ra.female,pa.female-qa.female,oa.female-pa.female,na.female-oa.female,ja.female-na.female],color:"#66ff66"},{name:"Total",data:[xa.total,wa.total-xa.total,va.total-wa.total,ua.total-va.total,ta.total-ua.total,sa.total-ta.total,ra.total-sa.total,qa.total-ra.total,pa.total-qa.total,oa.total-pa.total,na.total-oa.total,ma.total-na.total],color:"#ff9900"}]}),$("#trend-report-div-visits").highcharts({chart:{type:"column",borderColor:"#999999",borderWidth:2,borderRadius:10},title:{text:"Total Member Visits This Month"},xAxis:{categories:[ia[D.getMonth()]+" "+D.getFullYear(),ia[B.getMonth()]+" "+B.getFullYear(),ia[z.getMonth()]+" "+z.getFullYear(),ia[x.getMonth()]+" "+x.getFullYear(),ia[v.getMonth()]+" "+v.getFullYear(),ia[t.getMonth()]+" "+t.getFullYear(),ia[r.getMonth()]+" "+r.getFullYear(),ia[p.getMonth()]+" "+p.getFullYear(),ia[n.getMonth()]+" "+n.getFullYear(),ia[l.getMonth()]+" "+l.getFullYear(),ia[j.getMonth()]+" "+j.getFullYear(),ia[h.getMonth()]+" "+h.getFullYear()]},yAxis:{min:0,title:{text:"Visits Count"}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td><td style="padding:0"><b>{point.y}</b></td></tr>',footerFormat:"</table>",shared:!0,useHTML:!0},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:[{name:"Males",data:[ga.Visits.male,fa.Visits.male,ea.Visits.male,da.Visits.male,ca.Visits.male,ba.Visits.male,aa.Visits.male,_.Visits.male,Z.Visits.male,Y.Visits.male,X.Visits.male,W.Visits.male],color:"#33ccff"},{name:"Females",data:[ga.Visits.female,fa.Visits.female,ea.Visits.female,da.Visits.female,ca.Visits.female,ba.Visits.female,aa.Visits.female,_.Visits.female,Z.Visits.female,Y.Visits.female,X.Visits.female,W.Visits.female],color:"#66ff66"},{name:"Total",data:[ga.Visits.male+ga.Visits.female,fa.Visits.male+fa.Visits.female,ea.Visits.male+ea.Visits.female,da.Visits.male+da.Visits.female,ca.Visits.male+ca.Visits.female,ba.Visits.male+ba.Visits.female,aa.Visits.male+aa.Visits.female,_.Visits.male+_.Visits.female,Z.Visits.male+Z.Visits.female,Y.Visits.male+Y.Visits.female,X.Visits.male+X.Visits.female,W.Visits.male+W.Visits.female],color:"#ff9900"}]}),$("#trend-report-div-total-resource-views-this-month").highcharts({chart:{type:"column",borderColor:"#999999",borderWidth:2,borderRadius:10},title:{text:"Total Resource Views This Month"},xAxis:{categories:[ia[D.getMonth()]+" "+D.getFullYear(),ia[B.getMonth()]+" "+B.getFullYear(),ia[z.getMonth()]+" "+z.getFullYear(),ia[x.getMonth()]+" "+x.getFullYear(),ia[v.getMonth()]+" "+v.getFullYear(),ia[t.getMonth()]+" "+t.getFullYear(),ia[r.getMonth()]+" "+r.getFullYear(),ia[p.getMonth()]+" "+p.getFullYear(),ia[n.getMonth()]+" "+n.getFullYear(),ia[l.getMonth()]+" "+l.getFullYear(),ia[j.getMonth()]+" "+j.getFullYear(),ia[h.getMonth()]+" "+h.getFullYear()]},yAxis:{min:0,title:{text:"Resource count"}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td><td style="padding:0"><b>{point.y}</b></td></tr>',footerFormat:"</table>",shared:!0,useHTML:!0},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:[{name:"Males",data:[ga.ResourceViews.male,fa.ResourceViews.male,ea.ResourceViews.male,da.ResourceViews.male,ca.ResourceViews.male,ba.ResourceViews.male,aa.ResourceViews.male,_.ResourceViews.male,Z.ResourceViews.male,Y.ResourceViews.male,X.ResourceViews.male,W.ResourceViews.male],color:"#33ccff"},{name:"Females",data:[ga.ResourceViews.female,fa.ResourceViews.female,ea.ResourceViews.female,da.ResourceViews.female,ca.ResourceViews.female,ba.ResourceViews.female,aa.ResourceViews.female,_.ResourceViews.female,Z.ResourceViews.female,Y.ResourceViews.female,X.ResourceViews.female,W.ResourceViews.female],color:"#66ff66"},{name:"Total",data:[ga.ResourceViews.male+ga.ResourceViews.female,fa.ResourceViews.male+fa.ResourceViews.female,ea.ResourceViews.male+ea.ResourceViews.female,da.ResourceViews.male+da.ResourceViews.female,ca.ResourceViews.male+ca.ResourceViews.female,ba.ResourceViews.male+ba.ResourceViews.female,aa.ResourceViews.male+aa.ResourceViews.female,_.ResourceViews.male+_.ResourceViews.female,Z.ResourceViews.male+Z.ResourceViews.female,Y.ResourceViews.male+Y.ResourceViews.female,X.ResourceViews.male+X.ResourceViews.female,W.ResourceViews.male+W.ResourceViews.female],color:"#ff9900"}]})},TrendReport:function(){var a=this;App.$el.children(".body").html(""),$('<div id="trend-report-form" style="height: auto"></div>').appendTo(App.$el.children(".body"));var b=$("<select id='communitySelector'>"),c=$("<label>").text("Select Community: ");$("#trend-report-form").append(c);var d=[];$.ajax({type:"GET",url:"/community/_design/bell/_view/getAllCommunityNames",dataType:"json",success:function(a){for(var c=0;c<a.rows.length;c++)d[c]=a.rows[c].value,b.append("<option value="+d[c]+">"+a.rows[c].key+"</option>")},data:{},async:!1}),$("#trend-report-form").append(b);var e=$('<input type="button" style="height: 100%">').attr({id:"submit",name:"submit","class":"btn btn-success",value:"Generate Report"});$("#trend-report-form").append(e);var f="";e.click(function(){var b=$("#communitySelector").val();f=$("#communitySelector option:selected").text();var c=new Date,d=new Date(c.getFullYear(),c.getMonth(),1),e=new Date(d.getFullYear(),d.getMonth(),d.getDate()-1),g=new Date(e.getFullYear(),e.getMonth(),1),h=new Date(g.getFullYear(),g.getMonth(),g.getDate()-1),i=new Date(h.getFullYear(),h.getMonth(),1),j=new Date(i.getFullYear(),i.getMonth(),i.getDate()-1),k=new Date(j.getFullYear(),j.getMonth(),1),l=new Date(k.getFullYear(),k.getMonth(),k.getDate()-1),m=new Date(l.getFullYear(),l.getMonth(),1),n=new Date(m.getFullYear(),m.getMonth(),m.getDate()-1),o=new Date(n.getFullYear(),n.getMonth(),1),p=new Date(o.getFullYear(),o.getMonth(),o.getDate()-1),q=new Date(p.getFullYear(),p.getMonth(),1),r=new Date(q.getFullYear(),q.getMonth(),q.getDate()-1),s=new Date(r.getFullYear(),r.getMonth(),1),t=new Date(s.getFullYear(),s.getMonth(),s.getDate()-1),u=new Date(t.getFullYear(),t.getMonth(),1),v=new Date(u.getFullYear(),u.getMonth(),u.getDate()-1),w=new Date(v.getFullYear(),v.getMonth(),1),x=new Date(w.getFullYear(),w.getMonth(),m.getDate()-1),y=new Date(x.getFullYear(),x.getMonth(),1),z=new Date(y.getFullYear(),y.getMonth(),y.getDate()-1),A=new Date(z.getFullYear(),z.getMonth(),1),B=a.changeDateFormat(a.turnDateToYYYYMMDDFormat(A)),C=a.changeDateFormat(a.turnDateToYYYYMMDDFormat(c)),D=new App.Collections.ActivityLog,E=App.Server+'/activitylog/_design/bell/_view/getDocByCommunityCode?include_docs=true&startkey=["'+b+'","'+B+'"]&endkey=["'+b+'","'+C+'"]';D.setUrl(E),D.fetch({async:!1}),D.toJSON();var F=[],G=[],H=[],I=[],J=[],K=[],L=[],M=[],N=[],O=[],P=[],Q=[];for(var R in D.models){var S=a.turnDateFromMMDDYYYYToYYYYMMDDFormat(D.models[R].get("logDate"));S>=a.turnDateToYYYYMMDDFormat(d)&&S<=a.turnDateToYYYYMMDDFormat(c)?F.push(JSON.parse(JSON.stringify(D.models[R]))):S>=a.turnDateToYYYYMMDDFormat(g)&&S<=a.turnDateToYYYYMMDDFormat(e)?G.push(JSON.parse(JSON.stringify(D.models[R]))):S>=a.turnDateToYYYYMMDDFormat(i)&&S<=a.turnDateToYYYYMMDDFormat(h)?H.push(JSON.parse(JSON.stringify(D.models[R]))):S>=a.turnDateToYYYYMMDDFormat(k)&&S<=a.turnDateToYYYYMMDDFormat(j)?I.push(JSON.parse(JSON.stringify(D.models[R]))):S>=a.turnDateToYYYYMMDDFormat(m)&&S<=a.turnDateToYYYYMMDDFormat(l)?J.push(JSON.parse(JSON.stringify(D.models[R]))):S>=a.turnDateToYYYYMMDDFormat(o)&&S<=a.turnDateToYYYYMMDDFormat(n)?K.push(JSON.parse(JSON.stringify(D.models[R]))):S>=a.turnDateToYYYYMMDDFormat(q)&&S<=a.turnDateToYYYYMMDDFormat(p)?L.push(JSON.parse(JSON.stringify(D.models[R]))):S>=a.turnDateToYYYYMMDDFormat(s)&&S<=a.turnDateToYYYYMMDDFormat(r)?M.push(JSON.parse(JSON.stringify(D.models[R]))):S>=a.turnDateToYYYYMMDDFormat(u)&&S<=a.turnDateToYYYYMMDDFormat(t)?N.push(JSON.parse(JSON.stringify(D.models[R]))):S>=a.turnDateToYYYYMMDDFormat(w)&&S<=a.turnDateToYYYYMMDDFormat(v)?O.push(JSON.parse(JSON.stringify(D.models[R]))):S>=a.turnDateToYYYYMMDDFormat(y)&&S<=a.turnDateToYYYYMMDDFormat(x)?P.push(JSON.parse(JSON.stringify(D.models[R]))):S>=a.turnDateToYYYYMMDDFormat(A)&&S<=a.turnDateToYYYYMMDDFormat(z)&&Q.push(JSON.parse(JSON.stringify(D.models[R])))}var T=a.aggregateDataForTrendReport("communityX",F),U=a.aggregateDataForTrendReport("communityX",G),V=a.aggregateDataForTrendReport("communityX",H),W=a.aggregateDataForTrendReport("communityX",I),X=a.aggregateDataForTrendReport("communityX",J),Y=a.aggregateDataForTrendReport("communityX",K),Z=a.aggregateDataForTrendReport("communityX",L),_=a.aggregateDataForTrendReport("communityX",M),aa=a.aggregateDataForTrendReport("communityX",N),ba=a.aggregateDataForTrendReport("communityX",O),ca=a.aggregateDataForTrendReport("communityX",P),da=a.aggregateDataForTrendReport("communityX",Q),ea=a.aggregateDataForTrendReport("communityX",JSON.parse(JSON.stringify(D.models)));console.log(T);var fa=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],ga={male:0,female:0};a.getRegisteredMembersCount(b,function(a,b){ga.male=a,ga.female=b});var ha={male:0,female:0};a.getRegisteredMembersCountFromMembersDB(b,function(a,b){ha.male=a,ha.female=b});var ia={male:0,female:0};a.getTotalMemberVisits(b,function(a,b){ia.male=a,ia.female=b});var ja={male:ga.male,female:ga.female,total:0},ka={male:ga.male-T.New_Signups.male,female:ga.female-T.New_Signups.female,total:0},la={male:ka.male-U.New_Signups.male,female:ka.female-U.New_Signups.female,total:0},ma={male:la.male-V.New_Signups.male,female:la.female-V.New_Signups.female,total:0},na={male:ma.male-W.New_Signups.male,female:ma.female-W.New_Signups.female,total:0},oa={male:na.male-X.New_Signups.male,female:na.female-X.New_Signups.female,total:0},pa={male:oa.male-Y.New_Signups.male,female:oa.female-Y.New_Signups.female,total:0},qa={male:pa.male-Z.New_Signups.male,female:pa.female-Z.New_Signups.female,total:0},ra={male:qa.male-_.New_Signups.male,female:qa.female-_.New_Signups.female,total:0},sa={male:ra.male-aa.New_Signups.male,female:ra.female-aa.New_Signups.female,total:0},ta={male:sa.male-ba.New_Signups.male,female:sa.female-ba.New_Signups.female,total:0},ua={male:ta.male-ca.New_Signups.male,female:ta.female-ca.New_Signups.female,total:0};ja.total=ja.male+ja.female,ka.total=ka.male+ka.female,la.total=la.male+la.female,ma.total=ma.male+ma.female,na.total=na.male+na.female,oa.total=oa.male+oa.female,pa.total=pa.male+pa.female,qa.total=qa.male+qa.female,ra.total=ra.male+ra.female,sa.total=sa.male+sa.female,ta.total=ta.male+ta.female,ua.total=ua.male+ua.female;var va={male:ha.male,female:ha.female,total:0},wa={male:ha.male-(T.New_Signups.male-T.Deleted.male),female:ha.female-(T.New_Signups.female-T.Deleted.female),total:0},xa={male:wa.male-(U.New_Signups.male-U.Deleted.male),female:wa.female-(U.New_Signups.female-U.Deleted.female),total:0},ya={male:xa.male-(V.New_Signups.male-V.Deleted.male),female:xa.female-(V.New_Signups.female-V.Deleted.female),total:0},za={male:ya.male-(W.New_Signups.male-W.Deleted.male),female:ya.female-(W.New_Signups.female-W.Deleted.female),total:0},Aa={male:za.male-(X.New_Signups.male-X.Deleted.male),female:za.female-(X.New_Signups.female-X.Deleted.female),total:0},Ba={male:Aa.male-(Y.New_Signups.male-Y.Deleted.male),
female:Aa.female-(Y.New_Signups.female-Y.Deleted.female),total:0},Ca={male:Ba.male-(Z.New_Signups.male-Z.Deleted.male),female:Ba.female-(Z.New_Signups.female-Z.Deleted.female),total:0},Da={male:Ca.male-(_.New_Signups.male-_.Deleted.male),female:Ca.female-(_.New_Signups.female-_.Deleted.female),total:0},Ea={male:Da.male-(aa.New_Signups.male-aa.Deleted.male),female:Da.female-(aa.New_Signups.female-aa.Deleted.female),total:0},Fa={male:Ea.male-(ba.New_Signups.male-ba.Deleted.male),female:Ea.female-(ba.New_Signups.female-ba.Deleted.female),total:0},Ga={male:Fa.male-(ca.New_Signups.male-ca.Deleted.male),female:Fa.female-(ca.New_Signups.female-ca.Deleted.female),total:0};va.total=va.male+va.female,wa.total=wa.male+wa.female,xa.total=xa.male+xa.female,ya.total=ya.male+ya.female,za.total=za.male+za.female,Aa.total=Aa.male+Aa.female,Ba.total=Ba.male+Ba.female,Ca.total=Ca.male+Ca.female,Da.total=Da.male+Da.female,Ea.total=Ea.male+Ea.female,Fa.total=Fa.male+Fa.female,Ga.total=Ga.male+Ga.female;var Ha={male:ia.male,female:ia.female,total:0},Ia={male:ia.male-T.Visits.male,female:ia.female-T.Visits.female,total:0},Ja={male:Ia.male-U.Visits.male,female:Ia.female-U.Visits.female,total:0},Ka={male:Ja.male-V.Visits.male,female:Ja.female-V.Visits.female,total:0},La={male:Ka.male-W.Visits.male,female:Ka.female-W.Visits.female,total:0},Ma={male:La.male-X.Visits.male,female:La.female-X.Visits.female,total:0},Na={male:Ma.male-Y.Visits.male,female:Ma.female-Y.Visits.female,total:0},Oa={male:Na.male-Z.Visits.male,female:Na.female-Z.Visits.female,total:0},Pa={male:Oa.male-_.Visits.male,female:Oa.female-_.Visits.female,total:0},Qa={male:Pa.male-aa.Visits.male,female:Pa.female-aa.Visits.female,total:0},Ra={male:Qa.male-ba.Visits.male,female:Qa.female-ba.Visits.female,total:0},Sa={male:Ra.male-ca.Visits.male,female:Ra.female-ca.Visits.female,total:0};Ha.total=Ha.male+Ha.female,Ia.total=Ia.male+Ia.female,Ja.total=Ja.male+Ja.female,Ka.total=Ka.male+Ka.female,La.total=La.male+La.female,Ma.total=Ma.male+Ma.female,Na.total=Na.male+Na.female,Oa.total=Oa.male+Oa.female,Pa.total=Pa.male+Pa.female,Qa.total=Qa.male+Qa.female,Ra.total=Ra.male+Ra.female,Sa.total=Sa.male+Sa.female;var Ta=new App.Views.TrendActivityReport;Ta.data=ea,Ta.startDate=D.startkey,Ta.endDate=D.endkey,Ta.CommunityName=f,Ta.render(),App.$el.children(".body").html(Ta.el),$("#trend-report-div-total-members").highcharts({chart:{type:"column",borderColor:"#999999",borderWidth:2,borderRadius:10},title:{text:"Total Registered Members Past 12 Months"},xAxis:{categories:[fa[A.getMonth()]+" "+A.getFullYear(),fa[y.getMonth()]+" "+y.getFullYear(),fa[w.getMonth()]+" "+w.getFullYear(),fa[u.getMonth()]+" "+u.getFullYear(),fa[s.getMonth()]+" "+s.getFullYear(),fa[q.getMonth()]+" "+q.getFullYear(),fa[o.getMonth()]+" "+o.getFullYear(),fa[m.getMonth()]+" "+m.getFullYear(),fa[k.getMonth()]+" "+k.getFullYear(),fa[i.getMonth()]+" "+i.getFullYear(),fa[g.getMonth()]+" "+g.getFullYear(),fa[d.getMonth()]+" "+d.getFullYear()]},yAxis:{min:0,title:{text:"Members Count"}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td><td style="padding:0"><b>{point.y}</b></td></tr>',footerFormat:"</table>",shared:!0,useHTML:!0},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:[{name:"Males",data:[Ga.male,Fa.male,Ea.male,Da.male,Ca.male,Ba.male,Aa.male,za.male,ya.male,xa.male,wa.male,va.male],color:"#33ccff"},{name:"Females",data:[Ga.female,Fa.female,Ea.female,Da.female,Ca.female,Ba.female,Aa.female,za.female,ya.female,xa.female,wa.female,va.female],color:"#66ff66"},{name:"Total",data:[Ga.total,Fa.total,Ea.total,Da.total,Ca.total,Ba.total,Aa.total,za.total,ya.total,xa.total,wa.total,va.total],color:"#ff9900"}]}),$("#trend-report-div-total-member-visits").highcharts({chart:{type:"column",borderColor:"#999999",borderWidth:2,borderRadius:10},title:{text:"Total Visits Past 12 Months"},xAxis:{categories:[fa[A.getMonth()]+" "+A.getFullYear(),fa[y.getMonth()]+" "+y.getFullYear(),fa[w.getMonth()]+" "+w.getFullYear(),fa[u.getMonth()]+" "+u.getFullYear(),fa[s.getMonth()]+" "+s.getFullYear(),fa[q.getMonth()]+" "+q.getFullYear(),fa[o.getMonth()]+" "+o.getFullYear(),fa[m.getMonth()]+" "+m.getFullYear(),fa[k.getMonth()]+" "+k.getFullYear(),fa[i.getMonth()]+" "+i.getFullYear(),fa[g.getMonth()]+" "+g.getFullYear(),fa[d.getMonth()]+" "+d.getFullYear()]},yAxis:{min:0,title:{text:"Visits Count"}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td><td style="padding:0"><b>{point.y}</b></td></tr>',footerFormat:"</table>",shared:!0,useHTML:!0},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:[{name:"Males",data:[Sa.male,Ra.male,Qa.male,Pa.male,Oa.male,Na.male,Ma.male,La.male,Ka.male,Ja.male,Ia.male,Ha.male],color:"#33ccff"},{name:"Females",data:[Sa.female,Ra.female,Qa.female,Pa.female,Oa.female,Na.female,Ma.female,La.female,Ka.female,Ja.female,Ia.female,Ha.female],color:"#66ff66"},{name:"Total",data:[Sa.total,Ra.total,Qa.total,Pa.total,Oa.total,Na.total,Ma.total,La.total,Ka.total,Ja.total,Ia.total,Ha.total],color:"#ff9900"}]}),$("#trend-report-div-new-memberships").highcharts({chart:{type:"column",borderColor:"#999999",borderWidth:2,borderRadius:10},title:{text:"Active Members This Month"},xAxis:{categories:[fa[A.getMonth()]+" "+A.getFullYear(),fa[y.getMonth()]+" "+y.getFullYear(),fa[w.getMonth()]+" "+w.getFullYear(),fa[u.getMonth()]+" "+u.getFullYear(),fa[s.getMonth()]+" "+s.getFullYear(),fa[q.getMonth()]+" "+q.getFullYear(),fa[o.getMonth()]+" "+o.getFullYear(),fa[m.getMonth()]+" "+m.getFullYear(),fa[k.getMonth()]+" "+k.getFullYear(),fa[i.getMonth()]+" "+i.getFullYear(),fa[g.getMonth()]+" "+g.getFullYear(),fa[d.getMonth()]+" "+d.getFullYear()]},yAxis:{min:0,title:{text:"Members Count"}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td><td style="padding:0"><b>{point.y}</b></td></tr>',footerFormat:"</table>",shared:!0,useHTML:!0},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:[{name:"Males",data:[ua.male,ta.male-ua.male,sa.male-ta.male,ra.male-sa.male,qa.male-ra.male,pa.male-qa.male,oa.male-pa.male,na.male-oa.male,ma.male-na.male,la.male-ma.male,ka.male-la.male,ga.male-ka.male],color:"#33ccff"},{name:"Females",data:[ua.female,ta.female-ua.female,sa.female-ta.female,ra.female-sa.female,qa.female-ra.female,pa.female-qa.female,oa.female-pa.female,na.female-oa.female,ma.female-na.female,la.female-ma.female,ka.female-la.female,ga.female-ka.female],color:"#66ff66"},{name:"Total",data:[ua.total,ta.total-ua.total,sa.total-ta.total,ra.total-sa.total,qa.total-ra.total,pa.total-qa.total,oa.total-pa.total,na.total-oa.total,ma.total-na.total,la.total-ma.total,ka.total-la.total,ja.total-ka.total],color:"#ff9900"}]}),$("#trend-report-div-visits").highcharts({chart:{type:"column",borderColor:"#999999",borderWidth:2,borderRadius:10},title:{text:"Total Member Visits This Month"},xAxis:{categories:[fa[A.getMonth()]+" "+A.getFullYear(),fa[y.getMonth()]+" "+y.getFullYear(),fa[w.getMonth()]+" "+w.getFullYear(),fa[u.getMonth()]+" "+u.getFullYear(),fa[s.getMonth()]+" "+s.getFullYear(),fa[q.getMonth()]+" "+q.getFullYear(),fa[o.getMonth()]+" "+o.getFullYear(),fa[m.getMonth()]+" "+m.getFullYear(),fa[k.getMonth()]+" "+k.getFullYear(),fa[i.getMonth()]+" "+i.getFullYear(),fa[g.getMonth()]+" "+g.getFullYear(),fa[d.getMonth()]+" "+d.getFullYear()]},yAxis:{min:0,title:{text:"Visits Count"}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td><td style="padding:0"><b>{point.y}</b></td></tr>',footerFormat:"</table>",shared:!0,useHTML:!0},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:[{name:"Males",data:[da.Visits.male,ca.Visits.male,ba.Visits.male,aa.Visits.male,_.Visits.male,Z.Visits.male,Y.Visits.male,X.Visits.male,W.Visits.male,V.Visits.male,U.Visits.male,T.Visits.male],color:"#33ccff"},{name:"Females",data:[da.Visits.female,ca.Visits.female,ba.Visits.female,aa.Visits.female,_.Visits.female,Z.Visits.female,Y.Visits.female,X.Visits.female,W.Visits.female,V.Visits.female,U.Visits.female,T.Visits.female],color:"#66ff66"},{name:"Total",data:[da.Visits.male+da.Visits.female,ca.Visits.male+ca.Visits.female,ba.Visits.male+ba.Visits.female,aa.Visits.male+aa.Visits.female,_.Visits.male+_.Visits.female,Z.Visits.male+Z.Visits.female,Y.Visits.male+Y.Visits.female,X.Visits.male+X.Visits.female,W.Visits.male+W.Visits.female,V.Visits.male+V.Visits.female,U.Visits.male+U.Visits.female,T.Visits.male+T.Visits.female],color:"#ff9900"}]}),$("#trend-report-div-total-resource-views-this-month").highcharts({chart:{type:"column",borderColor:"#999999",borderWidth:2,borderRadius:10},title:{text:"Total Resource Views This Month"},xAxis:{categories:[fa[A.getMonth()]+" "+A.getFullYear(),fa[y.getMonth()]+" "+y.getFullYear(),fa[w.getMonth()]+" "+w.getFullYear(),fa[u.getMonth()]+" "+u.getFullYear(),fa[s.getMonth()]+" "+s.getFullYear(),fa[q.getMonth()]+" "+q.getFullYear(),fa[o.getMonth()]+" "+o.getFullYear(),fa[m.getMonth()]+" "+m.getFullYear(),fa[k.getMonth()]+" "+k.getFullYear(),fa[i.getMonth()]+" "+i.getFullYear(),fa[g.getMonth()]+" "+g.getFullYear(),fa[d.getMonth()]+" "+d.getFullYear()]},yAxis:{min:0,title:{text:"Resource count"}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td><td style="padding:0"><b>{point.y}</b></td></tr>',footerFormat:"</table>",shared:!0,useHTML:!0},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:[{name:"Males",data:[da.ResourceViews.male,ca.ResourceViews.male,ba.ResourceViews.male,aa.ResourceViews.male,_.ResourceViews.male,Z.ResourceViews.male,Y.ResourceViews.male,X.ResourceViews.male,W.ResourceViews.male,V.ResourceViews.male,U.ResourceViews.male,T.ResourceViews.male],color:"#33ccff"},{name:"Females",data:[da.ResourceViews.female,ca.ResourceViews.female,ba.ResourceViews.female,aa.ResourceViews.female,_.ResourceViews.female,Z.ResourceViews.female,Y.ResourceViews.female,X.ResourceViews.female,W.ResourceViews.female,V.ResourceViews.female,U.ResourceViews.female,T.ResourceViews.female],color:"#66ff66"},{name:"Total",data:[da.ResourceViews.male+da.ResourceViews.female,ca.ResourceViews.male+ca.ResourceViews.female,ba.ResourceViews.male+ba.ResourceViews.female,aa.ResourceViews.male+aa.ResourceViews.female,_.ResourceViews.male+_.ResourceViews.female,Z.ResourceViews.male+Z.ResourceViews.female,Y.ResourceViews.male+Y.ResourceViews.female,X.ResourceViews.male+X.ResourceViews.female,W.ResourceViews.male+W.ResourceViews.female,V.ResourceViews.male+V.ResourceViews.female,U.ResourceViews.male+U.ResourceViews.female,T.ResourceViews.male+T.ResourceViews.female],color:"#ff9900"}]})})},renderNav:function(){var a=this.getConfigurations();if($.cookie("Member._id"))var b=new App.Views.navBarView({isLoggedIn:"1",type:a.get("type")});else var b=new App.Views.navBarView({isLoggedIn:"0"});$("div.navbar-collapse").html(b.el)},checkLoggedIn:function(){if($.cookie("Member._id")){var a=$.cookie("Member.expTime"),b=new Date(Date.parse(a)),c=Math.abs(new Date-b),d=72e5;if(d>c){var e=new Date;$.cookie("Member.expTime",e,{path:"/apps/_design/bell"}),$.cookie("Member.expTime",e,{path:"/apps/_design/bell"})}else this.expireSession(),Backbone.history.stop(),App.start()}else"login"!=$.url().attr("fragment")&&""!=$.url().attr("fragment")&&"landingPage"!=$.url().attr("fragment")&&"becomemember"!=$.url().attr("fragment")&&(Backbone.history.stop(),App.start())},getConfigurations:function(){var a=new App.Collections.Configurations;a.fetch({async:!1});var b=a.first();return b},addCourses:function(a){var b=new App.Views.courseSeach;b.publicationId=a,b.render(),App.$el.children(".body").html(b.el)},Dashboard:function(){var a=this.getConfigurations();if("community"==a.get("type"))return void this.cummunityManage();var b=new App.Views.Dashboard;App.$el.children(".body").html(b.el),b.render();var c=new App.Collections.Community({limit:3});c.fetch({async:!1}),console.log(c),c.each(function(a){$("#communities tbody").append('<tr class="success"><td>'+a.toJSON().Name+"</td></tr>")}),$("#communities").append('<tr ><td><a class="btn btn-default" href="#listCommunity" id="clickmore">Click for more</a></td></tr>');var d=new App.Collections.Publication;d.getlast=!0,d.fetch({success:function(a,b){_.each(b.results,function(a){void 0!=a.doc.IssueNo?$("#publications tbody").append('<tr class="info"><td>Issue :'+a.doc.IssueNo+"</td></tr>"):$("#publications tbody").append('<tr class="info"><td>Issue Deleted</td></tr>')})},async:!1}),$("#publications").append('<tr ><td><a class="btn btn-default" href="#publication" id="clickmore">Click for more</a></td></tr>')},cummunityManage:function(){App.$el.children(".body").html(""),App.$el.children(".body").append('<a href="#configuration"><button class="btn btn-hg btn-primary" id="configbutton">Configurations</button></a>'),App.$el.children(".body").append('<button class="btn btn-hg btn-primary" onclick=SyncDbSelect() id="sync">Sync With Nation</button>')},CommunityForm:function(a){this.modelForm("Community",a,"login")},viewAllFeedback:function(){var a=new App.Collections.siteFeedbacks;a.fetch({async:!1}),feedul=new App.Views.siteFeedbackPage({collection:a}),feedul.render(),$("#see-all",feedul.$el).trigger("click"),App.$el.children(".body").html("&nbsp"),App.$el.children(".body").append(feedul.el),$("#previousButton").hide(),$("#progress_img").hide()},modelForm:function(a,b,c){var d=new App.Models[a],e=new App.Views.CommunityForm({model:d});App.$el.children(".body").html(""),App.$el.children(".body").append(e.el),d.once("Model:ready",function(){e.on(a+"Form:done",function(){Backbone.history.navigate(c,{trigger:!0})}),e.render()}),b?(d.id=b,d.once("sync",function(){d.trigger("Model:ready")}),d.fetch({async:!1})):d.trigger("Model:ready")},MemberLogin:function(){if($.cookie("Member._id"))return void Backbone.history.navigate("listCommunity",{trigger:!0});var a=new App.Models.Credentials,b=new App.Views.MemberLoginForm({model:a});b.once("success:login",function(){window.location.href="../MyApp/index.html#dashboard"}),b.render(),App.$el.children(".body").html(b.el),$("ul.nav").html($("#template-nav-log-in").html()).hide()},MemberLogout:function(){this.expireSession(),Backbone.history.navigate("login",{trigger:!0})},expireSession:function(){$.removeCookie("Member.login",{path:"/apps/_design/bell"}),$.removeCookie("Member._id",{path:"/apps/_design/bell"}),$.removeCookie("Member.expTime",{path:"/apps/_design/bell"})},ListCommunity:function(){App.startActivityIndicator();var a=new App.Collections.Community;a.fetch({success:function(){CommunityTable=new App.Views.CommunitiesTable({collection:a}),CommunityTable.render();var b="<h3> Communities  |  <a  class='btn btn-success' id='addComm' href='#addCommunity'>Add Community</a>  </h3><p>*The Total Member Visits and Total Resource Views columns contain data of the current month only</p>";b+="<div id='list-of-Communities'></div>",App.$el.children(".body").html(b),$("#list-of-Communities",App.$el).append(CommunityTable.el)}}),App.stopActivityIndicator()},earthRequest:function(){var a="<div id='listRequest-head'> <p class='heading'> <a href='#' style='color:#1ABC9C'>Earth Request</a>  |   <a href='#request'>Communities Request</a> </p> </div>";a+="<div style='width:940px;margin:0 auto' id='listReq'></div>",App.$el.children(".body").html(a)},commRequest:function(){var a="<div id='listRequest-head'> <p class='heading'> <a href='#earthrequest' >Earth Request</a>  |   <a href='#request' style='color:#1ABC9C'>Communities Request</a> </p> </div>";a+="<div style='width:940px;margin:0 auto' id='listReq'></div>",App.$el.children(".body").html(a),App.startActivityIndicator();var b=new App.Collections.CourseRequest;b.fetch({async:!1});var c=new App.Collections.ResourceRequest;c.fetch({async:!1}),b.add(c.toJSON(),{silent:!0});var d=new App.Views.RequestsTable({collection:b});d.render(),App.$el.children(".body").append(d.el),App.stopActivityIndicator()},Reports:function(a){App.startActivityIndicator();var b=new App.Models.Member({_id:$.cookie("Member._id")});b.fetch({async:!1});var c=b.get("roles");$("ul.nav").html($("#template-nav-logged-in").html()).show(),$("#itemsinnavbar").html($("#template-nav-logged-in").html());var d=new App.Collections.Reports;d.fetch({async:!1});var e=new App.Views.ReportsTable({collection:d});e.isManager=c.indexOf("Manager"),e.render(),App.$el.children(".body").html(""),c.indexOf("Manager")>-1&&App.$el.children(".body").append('<p><a class="btn btn-success" href="#reports/add">Add a new Report</a><a style="margin-left:20px" class="btn btn-success" href="#trendreport">Trend Activity Report</a></p>');var f=$.url().attr("host").split(".");f=f[0].substring(3),0==f.length&&(f+="Nation"),App.$el.children(".body").append('<h4><span style="color:gray;">'+f+"</span> | Reports</h4>"),App.$el.children(".body").append(e.el),App.stopActivityIndicator()},ReportForm:function(a){var b=a?new App.Models.NationReport({_id:a}):new App.Models.NationReport;b.on("processed",function(){Backbone.history.navigate("report",{trigger:!0})});var c=new App.Views.ReportForm({model:b});App.$el.children(".body").html(c.el),b.id?(App.listenToOnce(b,"sync",function(){c.render()}),b.fetch()):c.render()},Publication:function(){App.startActivityIndicator();var a=new App.Collections.Publication;a.fetch({async:!1});var b=new App.Views.Publication;b.render(),App.$el.children(".body").html(b.el);var c=new App.Views.PublicationTable({collection:a});c.render(),App.$el.children(".body").append(c.el),App.stopActivityIndicator()},PublicationDetails:function(a){var b=new App.Models.Publication({_id:a});b.fetch({async:!1});var c=b.get("resources"),d=b.get("courses");App.$el.children(".body").html('<div style="margin-top:10px"><h6 style="float:left;">Issue No.'+b.get("IssueNo")+'</h6> <a class="btn btn-success" style="margin-left:20px" href="#courses/'+a+'">Add Course</a> <a class="btn btn-success" href = "../MyApp/index.html#search-bell/'+a+'" style="float:left;margin-left:20px;margin-bottom:10px;">Add Resource</a><button class="btn btn-info" style="float:left;margin-left:20px" onclick=SelectCommunity("'+a+'")>Send Publication</button></div>');var e="";_.each(c,function(a){e+='"'+a+'",'}),""!=e&&(e=e.substring(0,e.length-1));var f=new App.Collections.Resources;f.keys=encodeURI(e),f.fetch({async:!1});var g=new App.Views.PublicationResourceTable({collection:f});g.Id=a,g.render(),App.$el.children(".body").append(g.el);var h="";_.each(d,function(a){h+='"'+a.courseID+'",'}),""!=h&&(h=h.substring(0,h.length-1));var i=new App.Collections.Courses;i.keys=encodeURI(h),i.fetch({async:!1});var j=new App.Views.PublicationCoursesTable({collection:i});j.Id=a,j.render(),App.$el.children(".body").append(j.el)},PublicationForm:function(a){var b=a?new App.Models.Publication({_id:a}):new App.Models.Publication;b.on("processed",function(){Backbone.history.navigate("publication",{trigger:!0})});var c=new App.Views.PublicationForm({model:b});App.$el.children(".body").html(c.el),b.id?(b.fetch({success:function(a){"CoursePublication"==b.get("kind")?c.rlength=b.get("courses").length:null!=b.get("resources")&&(c.rlength=b.get("resources").length)},async:!1}),c.render()):(c.rlength=0,c.render()),$(".bbf-form .field-Date input").attr("disabled",!0),b.id||$(".bbf-form .field-IssueNo input").val("");var d=new Date;$(".bbf-form .field-Date input").datepicker({todayHighlight:!0}),$(".bbf-form .field-Date input",this.el).datepicker("setDate",d),$(".bbf-form .field-Date input").datepicker({todayHighlight:!0})},SelectCommunities:function(a){$("#invitationdiv").fadeIn(1e3);var b=new App.Views.listCommunityView;b.pId=a,b.render(),$("#invitationdiv").html("&nbsp"),$("#invitationdiv").append(b.el);var c=new App.Collections.Community;c.fetch({async:!1}),c.each(function(a){$("#comselect").append("<option value='"+a.get("Name")+"'>"+a.get("Name")+"</option>")})},SyncDbSelect:function(){$("#invitationdiv").fadeIn(1e3);var a=new App.Views.listSyncDbView;a.render(),$("#invitationdiv").html("&nbsp"),$("#invitationdiv").append(a.el)}}))});