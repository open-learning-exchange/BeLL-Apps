$(function(){App.Views.CommunitiesTable=Backbone.View.extend({tagName:"table",className:"table table-striped",vars:{},addOne:function(a){if("_design/bell"!==a.get("_id")){var b=new App.Views.CommunityRow({model:a});b.render(),this.$el.append(b.el)}},addAll:function(){this.collection.each(this.addOne,this)},render:function(){this.$el.append('<tr><th>Community</th><th>Last App <br>Update</th><th>Version No.</th><th>Last Publications <br>Sync</th><th>Last Activities <br>Sync</th><th>Total Member <br>Visits</th><th>Total Resource <br>Views</th></th><th colspan="2">Actions</th></tr>'),this.addAll()}})}),$(function(){App.Views.CommunityForm=Backbone.View.extend({className:"addNation-form",vars:{},events:{"click #formButton":function(){document.getElementById("addCommunity").submit()},"submit form":"setForm"},template:$("#template-addCommunity").html(),render:function(){var a=this.model;this.$el.append(_.template(this.template,this.vars)),void 0!=this.model.id&&(buttonText="Update",$("#nation-name").val(a.get("Name")),$("#community-code").val(a.get("Code")),$("#nation-url").val(a.get("Url")),$("#org-name").val(a.get("SponserName")),$("#org-sponseraddress").val(a.get("SponserAddress")),$("#org-firstname").val(a.get("ContactFirstname")),$("#org-middlename").val(a.get("ContactMiddlename")),$("#org-lastname").val(a.get("ContactLastname")),$("#org-phone").val(a.get("ContactPhone")),$("#org-email").val(a.get("ContactEmail")),$("#leader-firstname").val(a.get("LeaderFirstname")),$("#leader-middlename").val(a.get("LeaderMiddlename")),$("#leader-lastname").val(a.get("LeaderLastname")),$("#leader-phone").val(a.get("LeaderPhone")),$("#leader-email").val(a.get("LeaderEmail")),$("#leader-ID").val(a.get("LeaderId")),$("#leader-password").val(a.get("LeaderPassword")),$("#urg-name").val(a.get("UrgentName")),$("#urg-phone").val(a.get("UrgentPhone")),$("#auth-name").val(a.get("AuthName")),$("#auth-date").val(a.get("AuthDate")))},setForm:function(){this.model.set({Name:$("#nation-name").val(),Code:$("#community-code").val(),Url:$("#nation-url").val(),SponserName:$("#org-name").val(),SponserAddress:$("#org-sponseraddress").val(),ContactFirstname:$("#org-firstname").val(),ContactMiddlename:$("#org-middlename").val(),ContactLastname:$("#org-lastname").val(),ContactPhone:$("#org-phone").val(),ContactEmail:$("#org-email").val(),LeaderFirstname:$("#leader-firstname").val(),LeaderMiddlename:$("#leader-middlename").val(),LeaderLastname:$("#leader-lastname").val(),LeaderPhone:$("#leader-phone").val(),LeaderEmail:$("#leader-email").val(),LeaderId:$("#leader-ID").val(),LeaderPassword:$("#leader-password").val(),UrgentName:$("#urg-name").val(),UrgentPhone:$("#urg-phone").val(),AuthName:$("#auth-name").val(),AuthDate:$("#auth-date").val()});var a=this;$.ajax({url:'/community/_design/bell/_view/isDuplicateName?include_docs=true&key="'+a.model.get("Name")+'"',type:"GET",dataType:"json",async:!1,success:function(b){if(b.rows.length>1)return void alert("Community has duplicates in the database. Please delete other copies and retry.");if(0===b.rows.length)a.model.save(),alert("Successfully Saved"),App.startActivityIndicator(),Backbone.history.navigate("listCommunity",{trigger:!0}),App.stopActivityIndicator();else{var c=b.rows[0].doc;a.model.id&&a.model.id===c._id?(a.model.save(),alert("Successfully Saved"),App.startActivityIndicator(),Backbone.history.navigate("listCommunity",{trigger:!0}),App.stopActivityIndicator()):alert("Community 'Name' you entered is a duplicate. Please try again with a different name.")}},error:function(){alert("There was an error in getting a response from the server. Please try again.")}})}})}),$(function(){App.Views.CommunityRow=Backbone.View.extend({tagName:"tr",events:{"click .destroy":function(a){confirm("Are you sure you want to delete this Community?")?(a.preventDefault(),this.model.destroy(),this.remove()):(a.preventDefault(),App.startActivityIndicator(),Backbone.history.navigate("listCommunity",{trigger:!0}),App.stopActivityIndicator())},"click .browse":function(a){a.preventDefault(),$("#modal").modal({show:!0})}},initialize:function(){},render:function(){var a=this,b=this.model,c="",d=b.attributes.Code,e=b.get("Name"),f=b.get("lastActivitiesSyncDate"),g=f.split("/").join("-");c=d+"."+e;var h=$.url().data.attr.host.split("."),i=h[0],j=$.url().data.attr.authority,k=new Date,l=new Date(k.getFullYear(),k.getMonth(),1),m=new Date(k.getFullYear(),k.getMonth()+1,0),n=a.changeDateFormat(a.turnDateToYYYYMMDDFormat(l)),o=a.changeDateFormat(a.turnDateToYYYYMMDDFormat(m));$.ajax({url:"http://"+i+":oleoleole@"+j+'/activitylog/_design/bell/_view/getDocByCommunityCodeWithValue?_include_docs=true&&startkey=["'+d+'","'+n+'"]&endkey=["'+d+'","'+o+'"]',type:"GET",dataType:"jsonp",success:function(c){var d,e=0,f=0;if(d=c.rows,d.length>0){e=0,f=0;for(var h=0;h<d.length;h++){var i=d[h].value.female_visits,j=d[h].value.male_visits;console.log(i+" "+j),e=e+i+j,console.log("Female Visits: "+i+" Male Visits: "+j+" Total: "+i+j);for(var k=d[h].value.female_opened,l=d[h].value.male_opened,m=0,n=0,o=0;o<k.length;o++)m+=k[o];for(var p=0;p<l.length;p++)n+=l[p];f=f+m+n,console.log("resource views: "+f)}}var q="<td>"+b.get("Name")+"</td><td>"+b.get("lastAppUpdateDate")+"</td><td>"+b.get("version")+"</td><td>"+b.get("lastPublicationsSyncDate")+"</td><td>"+b.get("lastActivitiesSyncDate")+"</td><td>"+e+"</td><td>"+f+"</td><td><a  class='btn btn-success' id='submit' href='#communityreport/"+g+"/"+b.get("Name")+"/"+b.get("Code")+"'>Generate Report</a>&nbsp&nbsp&nbsp<a role='button' class='btn btn-info' href='#addCommunity/"+b.get("_id")+"'> <i class='icon-pencil icon-white'></i>Edit</a>&nbsp&nbsp&nbsp<a role='button' class='btn btn-danger destroy' href='#addCommunity/"+b.get("_id")+"'> <i class='icon-remove icon-white'></i>Delete</a></td>";a.$el.append(q)},error:function(){console.log("Unable to get communities list.")}})},turnDateToYYYYMMDDFormat:function(a){var b=a.getFullYear().toString(),c=(a.getMonth()+1).toString(),d=a.getDate().toString(),e=c.split(""),f=d.split(""),g=b+"/"+(2===e.length?c:"0"+e[0])+"/"+(2===f.length?d:"0"+f[0]);return g},changeDateFormat:function(a){var b=a.match(/\d+/g),c=b[0],d=b[1],e=b[2];return c+"/"+d+"/"+e}})}),$(function(){App.Views.ConfigurationView=Backbone.View.extend({template:$("#template-Configuration").html(),template:_.template($("#template-Configuration").html()),vars:{},events:{"click #saveLanguage":function(a){var b=!1,c=$("#languageSelection").val();if(""!=c&&(this.model.set("currentLanguage",c),b=!0),""!=$("#appversion").val()&&(this.model.set("version",$("#appversion").val()),b=!0),""!=$("#notes").val()&&(this.model.set("notes",$("#notes").val()),b=!0),b){var d=this;console.log(this.model.toJSON()),this.model.save(null,{success:function(a,b){d.model.set("_rev",a.get("rev"))}}),alert("Configuration saved.")}else alert("You have not changed any thing.")}},render:function(){this.vars=this.model.toJSON(),this.$el.html(this.template(this.vars)),this.$el.append('<br>&nbsp;&nbsp;<button class="btn btn-success" id="saveLanguage" >Save</button>')}})}),$(function(){App.Views.Configurations=Backbone.View.extend({initialize:function(){this.$el.html("<h3>Set Configurations<h3>")},events:{"click #formButton":"setForm"},render:function(){this.form=new Backbone.Form({model:this.model}),this.$el.append(this.form.render().el),this.$el.append('<a style="margin-left:31px" class="btn btn-success" id="formButton">Submit Configurations </a>')},setForm:function(){if(this.form.commit(),null==this.form.validate()){var a=this.form.model,b=new App.Collections.Configurations;b.fetch({async:!1});var c=b.first();c.set("name",a.get("name")),c.set("nationName",a.get("nationName")),c.set("nationUrl",a.get("nationUrl")),c.set("code",a.get("code")),c.set("type",a.get("type")),c.set("notes",a.get("notes")),c.set("version",a.get("version")),"Select an Option"!=a.get("selectLanguage")&&c.set("currentLanguage",a.get("selectLanguage")),c.save(null,{success:function(a,b){App.configuration=c,console.log(App.configuration.get("name")),alert("Configurations are Successfully Added"),Backbone.history.navigate("dashboard",{trigger:!0})}})}}})}),$(function(){App.Views.Dashboard=Backbone.View.extend({template:$("#template-Dashboard").html(),vars:{},render:function(){var a=new App.Collections.Configurations;a.fetch({async:!1});var b=a.first();this.vars.imgURL="img/header_slice.png";var c=new App.Collections.MailUnopened({receiverId:$.cookie("Member._id")});c.fetch({async:!1}),this.vars.type=b.get("type"),this.vars.mails=c.length,this.$el.html(_.template(this.template,this.vars)),$(".now").html(moment().format("dddd | DD MMMM, YYYY"));var d=new App.Models.Member;d.id=$.cookie("Member._id"),d.on("sync",function(){var a="/members/"+d.id+"/";"undefined"!=typeof d.get("_attachments")&&(a+=_.keys(d.get("_attachments"))[0],document.getElementById("imgurl").src=a);var b,c=new App.Collections.Configurations;c.fetch({async:!1,success:function(){b=c.first().attributes.name}}),b=b.charAt(0).toUpperCase()+b.slice(1);var e=c.first().attributes.type;b+="nation"===e?" Nation Bell":" Community Bell",$(".bellLocation").html(b),d.get("visits")||(d.set("visits",1),d.save()),0==parseInt(d.get("visits"))?temp="Error!!":temp=d.get("visits")+" visits";var f="&nbsp;-&nbsp;",g=0;-1!=d.get("roles").indexOf("Learner")&&(f+="Learner",g=1),-1!=d.get("roles").indexOf("Leader")&&(1==g&&(f+=",&nbsp;"),f+="Leader",g=1),-1!=d.get("roles").indexOf("Manager")&&(1==g&&(f+=",&nbsp;"),f+="Manager"),$(".visits").html(temp),$(".name").html(d.get("firstName")+" "+d.get("lastName")+'<span style="font-size:15px;">'+f+'</span>&nbsp;<a href="../MyApp/index.html#member/edit/'+$.cookie("Member._id")+'"><i class="fui-gear"></i></a>')}),d.fetch()}})}),$(function(){App.Views.GroupRow=Backbone.View.extend({tagName:"tr",roles:null,events:{"click .addtoPublication":"addtoPublication","click .browse":function(a){}},template:$("#template-GroupRow").html(),initialize:function(a){this.roles=a.roles},render:function(){var a=this.model.toJSON();"_design/bell"!=a._id&&this.$el.append(_.template(this.template,a))},addtoPublication:function(a){var b=a.currentTarget.name,c=new App.Models.Publication({_id:this.publicationId});c.fetch({success:function(a){courses=a.get("courses"),void 0==courses&&(courses=[]);for(var c in courses)if(courses[c].courseID===b)return void alert("This Course Already Exists In This Publication");var d={};d.courseID=b,d.stepIDs=[];var e=new App.Collections.CourseLevels;e.groupId=b,e.fetch({success:function(b,c){e.each(function(a){var b={stepID:a.get("_id")};b.resourceIDs=a.get("resourceId").length>0?a.get("resourceId"):[],d.stepIDs.push(b)}),courses.push(d),a.set({courses:courses}),a.save(null,{success:function(){alert("Added Successfully")}})},error:function(a){console.log(a),alert("Failed to add the course to the publication")}})}})}})}),$(function(){App.Views.GroupView=Backbone.View.extend({tagName:"table",className:"table table-striped",roles:null,events:{"click #admissionButton":function(a){alert("asdfasdf")}},render:function(){console.log(this.model),this.addCourseDetails()},addCourseDetails:function(){var a=this,b=this.model.toJSON(),c=this.courseLeader.toJSON();console.log(b),console.log(c),this.$el.append("<tr><td><b>Name</b></td><td>"+b.CourseTitle+"</td></tr>"),this.$el.append("<tr><td><b>Subject Level </b></td><td>"+b.subjectLevel+"</td></tr>"),this.$el.append("<tr><td><b>Grade Level </b></td><td>"+b.gradeLevel+"</td></tr>"),this.$el.append("<tr><td><b>Description</b></td><td>"+b.description+"</td></tr>"),this.$el.append("<tr><td><b>LeaderName </b></td><td>"+c.firstName+" "+c.lastName+"</td></tr>"),this.$el.append("<tr><td><b>Leader Email </b></td><td>"+b.leaderEmail+"</td></tr>"),this.$el.append("<tr><td><b>Leader Phone Number </b></td><td>"+b.leaderPhone+"</td></tr>"),this.$el.append("<tr><td><b>schedule</b></td><td>Date :  "+b.startDate+"-"+b.endDate+"<br>Time :  "+b.startTime+"- "+b.endTime+"</td></tr>"),this.$el.append("<tr><td><b>Location </b></td><td>"+b.location+"</td></tr>"),$(document).on("Notification:submitButtonClicked",function(b){var c=new Date,d=new App.Models.Mail;d.set("senderId",$.cookie("Member._id")),d.set("receiverId",a.model.get("courseLeader")),d.set("subject","Course Admission Request | "+a.model.get("name")),d.set("body",'Admission request received from user "'+$.cookie("Member.login")+'" in '+a.model.get("name")+' <br/><br/><button class="btn btn-primary" id="invite-accept" value="'+a.model.get("_id")+'" >Accept</button>&nbsp;&nbsp;<button class="btn btn-danger" id="invite-reject" value="'+a.model.get("id")+'" >Reject</button>'),d.set("status","0"),d.set("type","admissionRequest"),d.set("sentDate",c),d.save(),alert("Admission request successfully sent to this course leader.")})}})}),$(function(){App.Views.GroupsTable=Backbone.View.extend({tagName:"table",className:"table table-striped",roles:null,addOne:function(a){var b=new App.Views.GroupRow({model:a,roles:this.roles});b.publicationId=this.publicationId,b.render(),this.$el.append(b.el)},addAll:function(){this.$el.html("<tr><th>Title</th><th colspan='0'>Actions</th></tr>");var a=new App.Models.Member({_id:$.cookie("Member._id")});a.fetch({async:!1}),this.roles=a.get("roles"),this.collection.each(this.addOne,this)},render:function(){this.addAll()}})}),$(function(){App.Views.MemberLoginForm=Backbone.View.extend({template:$("#template-login").html(),vars:{},className:"form",events:{"click #formButton":"setForm","submit form":"setFormFromEnterKey"},render:function(){this.$el.html(_.template(this.template,this.vars));var a=$('<button class="btn btn-success" style="background-color:#34495e" id="formButton">Sign In</button>');$("#submit-button",this.$el).append(a)},setFormFromEnterKey:function(a){a.preventDefault(),this.setForm()},setForm:function(){var a=this,b=$("#username").val(),c=$("#password").val();$.getJSON('/members/_design/bell/_view/MembersByLogin?include_docs=true&key="'+b+'"',function(b){if(b.rows[0])if(b.total_rows>0&&b.rows[0].doc.password==c)if("active"==b.rows[0].doc.status){var d=new Date;$.cookie("Member.login",b.rows[0].doc.login,{path:"/apps/_design/bell"}),$.cookie("Member._id",b.rows[0].doc._id,{path:"/apps/_design/bell"}),$.cookie("Member.expTime",d,{path:"/apps/_design/bell"}),-1!=$.inArray("student",b.rows[0].doc.roles)&&b.rows[0].doc.roles.length<2?alert("You are not authorized to sign in"):a.trigger("success:login")}else alert("Your account is deactivated");else alert("Login or Password Incorrect");else alert("Login or Password Incorrect")})}})}),$(function(){App.Views.NationReportCommentView=Backbone.View.extend({tagName:"div",id:"comment-feedback",cId:null,initialize:function(a){console.log(a),this.cId=a.NationReportId,this.model=new App.Models.NationReportComment},events:{"click #submitFormButton":"submit","click #cancelFormButton":"cancel"},cancel:function(){$("#debug").hide(),this.remove()},submit:function(){if(0!=this.form.getValue("comment").length){var a=new Date;a.getDate(),this.form.setValue({NationReportId:this.cId}),this.form.setValue({commentNumber:this.collection.length+1}),this.form.setValue({memberLogin:$.cookie("Member.login")}),this.form.setValue({time:a.toString()}),this.form.commit(),this.model.save(),this.form.setValue({comment:""}),this.collection.fetch({async:!1}),this.model.set({comment:""}),this.render()}},addOne:function(a){$("#comments").append("<div id=tile><b>Login:</b>"+a.toJSON().memberLogin+"<br/><b>Time:</b>"+a.toJSON().time+"<br/><b>Comment:</b>"+a.toJSON().comment+"</div>"),console.log(a.toJSON())},render:function(){$("#debug").show(),this.$el.html("&nbsp;"),$("#comments").html("&nbsp;"),this.collection.forEach(this.addOne,this),this.form=new Backbone.Form({model:this.model}),this.$el.append(this.form.render().el),this.form.fields.NationReportId.$el.hide(),this.form.fields.commentNumber.$el.hide(),this.form.fields.memberLogin.$el.hide(),this.form.fields.time.$el.hide();var a=$('<div id="r-formButton"><button class="btn btn-primary" id="submitFormButton">Add Comment</button><button class="btn btn-info" id="cancelFormButton">Close</button></div>');this.$el.append(a)}})}),$(function(){App.Views.Publication=Backbone.View.extend({template:$("#template-Publication").html(),render:function(){this.$el.html(_.template(this.template))}})}),$(function(){App.Views.PublicationCourseRow=Backbone.View.extend({tagName:"tr",admn:null,events:{"click .destroy":function(a){var b=new App.Models.Publication({_id:this.Id});b.fetch({async:!1});var c=b.get("courses");for(var d in c)if(c[d].courseID===this.model.get("_id")){c.splice(d,1);break}this.$el.hide(),b.set({courses:c}),b.save()}},vars:{},template:_.template($("#template-publication-CourseRow").html()),initialize:function(a){this.model.on("destroy",this.remove,this)},render:function(){var a=this.model.toJSON();this.$el.append(this.template(a))}})}),$(function(){App.Views.PublicationCoursesTable=Backbone.View.extend({tagName:"table",isManager:null,className:"table table-striped",initialize:function(){},addOne:function(a){var b=new App.Views.PublicationCourseRow({model:a});b.Id=this.Id,b.render(),this.$el.append(b.el)},addAll:function(){this.$el.append('<tr><th>Course Title</th><th colspan="2">Actions</th></tr>'),0==this.collection.length&&this.$el.append('<tr><td colspan="2"> No Course in this publication <td></tr>'),this.collection.forEach(this.addOne,this)},render:function(){this.addAll()}})}),$(function(){App.Views.PublicationForm=Backbone.View.extend({className:"form",events:{"click .save":"saveForm","click #AddResPublication":"searchres","click #AddCoursePublication":"listCourses","click #cancel":function(){window.location.href="#publication"}},template:_.template($("#template-form-file").html()),render:function(){var a={};return _.has(this.model,"id")?a.header='Publication Issue : "'+this.model.get("IssueNo")+'"':a.header="New Publication Issue",this.form=new Backbone.Form({model:this.model}),a.form="",a.rlength=this.rlength,this.form.render(),this.$el.html(this.template(a)),$(".fields").html(this.form.el),$(".form .field-resources").hide(),$("#progressImage").hide(),this},saveForm:function(){var a=this.model.get("_id"),b=!0;if(this.form.commit(),void 0==this.model.get("IssueNo"))alert("Publication Issue is missing");else{if(void 0==a){var c=this,d=new App.Collections.Publication;d.fetch({async:!1}),d.each(function(a){c.model.get("IssueNo")==a.get("IssueNo")&&(alert("IssueNo already exist"),b=!1)})}b&&(this.form.commit(),this.model.save(null,{success:function(a){alert("Issue Saved!"),window.location.href="#publicationdetail/"+a.toJSON().id}}))}},searchres:function(){var a=!0,b=this.model.get("_id");if(this.form.commit(),void 0==this.model.get("IssueNo"))alert("Publication Issue is missing"),a=!1;else if(void 0==b){var c=new App.Collections.Publication;c.issue=this.model.get("IssueNo"),c.fetch({async:!1}),c=c.first(),void 0!=c&&void 0!=c.toJSON().IssueNo&&(alert("IssueNo already exist"),a=!1)}a&&this.model.save(null,{success:function(a){window.location.href="../MyApp/index.html#search-bell/"+a.toJSON().id}})},listCourses:function(){var a=!0,b=new Array,c=this.model.get("_id");if(this.form.commit(),this.model.set({courses:b}),void 0==this.model.get("IssueNo"))alert("Publication Issue is missing"),a=!1;else if(void 0==c){var d=new App.Collections.Publication;d.issue=this.model.get("IssueNo"),d.fetch({async:!1}),d=d.first(),void 0!=d&&void 0!=d.toJSON().IssueNo&&(alert("IssueNo already exist"),a=!1)}a&&this.model.save(null,{success:function(a){window.location.href="#courses/"+a.toJSON().id}})},statusLoading:function(){this.$el.children(".status").html('<div style="display:none" class="progress progress-striped active"> <div class="bar" style="width: 100%;"></div></div>')}})}),$(function(){App.Views.PublicationResourceRow=Backbone.View.extend({tagName:"tr",admn:null,events:{"click .destroy":function(a){var b=new App.Models.Publication({_id:this.Id});b.fetch({async:!1});var c=b.get("resources"),d=c.indexOf(this.model.get("_id"));d>-1&&c.splice(d,1),this.$el.hide(),b.set({resources:c}),b.save()}},vars:{},template:_.template($("#template-ResourceRow").html()),initialize:function(a){this.model.on("destroy",this.remove,this)},render:function(){var a=this.model.toJSON();this.$el.append(this.template(a))}})}),$(function(){App.Views.PublicationResourceTable=Backbone.View.extend({tagName:"table",isManager:null,className:"table table-striped",initialize:function(){},addOne:function(a){var b=new App.Views.PublicationResourceRow({model:a});b.Id=this.Id,b.render(),this.$el.append(b.el)},addAll:function(){this.$el.append('<tr><th>Resource Title</th><th colspan="2">Actions</th></tr>'),0==this.collection.length&&this.$el.append('<tr><td colspan="2"> No Resource in this publication <td></tr>'),this.collection.forEach(this.addOne,this)},render:function(){this.addAll()}})}),$(function(){App.Views.PublicationRow=Backbone.View.extend({tagName:"tr",admn:null,events:{"click .destroy":function(a){alert("deleting"),this.model.destroy(),a.preventDefault()},"click #a":function(a){alert(a)}},vars:{},template:_.template($("#template-PublicationRow").html()),initialize:function(a){this.model.on("destroy",this.remove,this)},render:function(){var a=this.model.toJSON();a.isManager=this.isManager;var b=new Date(a.Date);a.Date=b.toUTCString(),this.$el.append(this.template(a))}})}),$(function(){App.Views.PublicationTable=Backbone.View.extend({tagName:"table",isManager:null,className:"table table-striped",initialize:function(){},addOne:function(a){var b=new App.Views.PublicationRow({model:a});b.render(),this.$el.append(b.el)},addAll:function(){this.$el.append('<tr><th>Date Issue</th><th>Issue No.</th><th>Editor Name</th><th>Editor Email</th><th>Editor Phone</th><th colspan="2">Actions</th></tr>'),this.collection.forEach(this.addOne,this)},render:function(){this.addAll()}})}),$(function(){App.Views.ReportForm=Backbone.View.extend({className:"form",hide:!1,events:{"click .save":"saveForm","click #cancel":function(){window.history.back()}},template:_.template($("#template-form-file").html()),render:function(){var a={};_.has(this.model,"id")?(a.header='Title "'+this.model.get("title")+'"',a.hidesave=!0):(a.header="New Nation Report",a.hidesave=!1),this.form=new Backbone.Form({model:this.model}),this.form.render(),0==this.edit&&alert("here");return _.has(this.model,"id"),a.form="",console.log(a),this.$el.html(this.template(a)),$(".fields").html(this.form.el),$("#progressImage").hide(),this},saveForm:function(){var a,b=!0,c=this.model.get("title"),d=this.model.get("_id");console.log(d),this.form.commit(),a=this.model.get("title");var e=this;if(0==this.model.get("title").length)alert("Resource Title is missing");else if("News"!=this.model.get("Tag")||this.model.get("author")){if($("#gressImage").show(),this.model.set(" uploadDate",(new Date).getTime()),"All"==this.model.get("Level")?(this.model.set("toLevel",0),this.model.set("fromLevel",0)):parseInt(this.model.get("fromLevel"))>parseInt(this.model.get("toLevel"))&&(alert("Invalid range specified "),b=!1),void 0==d){var e=this,f=new App.Collections.Reports;f.fetch({async:!1}),f.each(function(a){e.model.get("title")==a.get("title")&&(alert("Title already exist"),b=!1)})}b&&(void 0==d?this.model.set("sum",0):this.model.set("title",c),this.model.save(null,{success:function(){if(e.model.unset("_attachments"),$('input[type="file"]').val())if(void 0!=d)if(c!=a){var b=!1,f=new App.Collections.Resources;if(f.fetch({async:!1}),f.each(function(c){a==c.get("title")&&(b=!0)}),b)alert("Resource title Already exist");else{var g=new App.Models.Resource;g.set("title",a),g.set("description",e.model.get("description")),g.set("articleDate",e.model.get("articleDate")),g.set("addedBy",e.model.get("addedBy")),g.set("openWith",e.model.get("openWith")),g.set("subject",e.model.get("subject")),g.set("Level",e.model.get("Level")),g.set("fromLevel",e.model.get("fromLevel")),g.set("toLevel",e.model.get("toLevel")),g.set("Tag",e.model.get("Tag")),g.set("author",e.model.get("author")),g.set("openWhichFile",e.model.get("openWhichFile")),g.set("uploadDate",e.model.get("uploadDate")),g.set("openUrl",e.model.get("openUrl")),g.set("averageRating",e.model.get("averageRating")),g.set("sum",0),g.set("timesRated",0),g.save(),console.log("MODEL UPDATION"),g.on("sync",function(){g.saveAttachment("form#fileAttachment","form#fileAttachment #_attachments","form#fileAttachment .rev"),g.on("savedAttachment",function(){alert("Resource Updated Successfully"),Backbone.history.navigate("#resources",{trigger:!0}),e.trigger("processed"),$("#progressImage").hide()},g)})}}else alert("Cannot update model due to identical title");else e.model.saveAttachment("form#fileAttachment","form#fileAttachment #_attachments","form#fileAttachment .rev");else e.model.trigger("processed");e.model.on("savedAttachment",function(){this.trigger("processed"),$("#progressImage").hide()},e.model)}}))}else alert("Please Specify Author For This News Resource")},statusLoading:function(){alert("asdf"),this.$el.children(".status").html('<div style="display:none" class="progress progress-striped active"> <div class="bar" style="width: 100%;"></div></div>')}})}),$(function(){App.Views.ReportsRow=Backbone.View.extend({tagName:"tr",admn:null,events:{"click .destroy":function(a){alert("deleting"),this.model.destroy(),a.preventDefault()},"click #open":function(a){void 0==this.model.get("views")?(this.model.set("views",1),this.model.save()):(this.model.set("views",this.model.get("views")+1),this.model.save())},"click #commentButton":function(a){console.log(a),console.log(a.target.attributes[0].nodeValue);var b=new App.Collections.NationReportComments;b.NationReportId=a.target.attributes[0].nodeValue,b.fetch({async:!1}),console.log(b.toJSON());var c=new App.Views.NationReportCommentView({collection:b,NationReportId:a.target.attributes[0].nodeValue});c.render(),$("#debug").append(c.el)}},vars:{},template:_.template($("#template-ReportRow").html()),initialize:function(a){this.model.on("destroy",this.remove,this)},render:function(){var a=this.model.toJSON();void 0==a.views&&(a.views=0),a.isManager=this.isManager;var b=new Date(a.Date);a.Date=b.toUTCString(),this.$el.append(this.template(a))}})}),$(function(){App.Views.ReportsTable=Backbone.View.extend({tagName:"table",isManager:null,className:"table table-striped",initialize:function(){},addOne:function(a){var b=new App.Views.ReportsRow({model:a});b.isManager=this.isManager,b.render(),this.$el.append(b.el)},addAll:function(){this.$el.append('<tr><th>Time</th><th>Request</th><th>Author</th><th>Views</th><th colspan="5">Actions</th></tr>'),this.collection.forEach(this.addOne,this)},render:function(){this.addAll()}})}),$(function(){App.Views.RequestRow=Backbone.View.extend({tagName:"tr",template:_.template($("#template-RequestRow").html()),initialize:function(a){this.model.on("destroy",this.remove,this)},render:function(){var a=this.model.toJSON(),b=new App.Models.Member({_id:a.senderId});b.fetch({async:!1}),a.login=b.toJSON().login,void 0==a.date&&(a.date="Not available"),void 0==a.sendFromName&&(a.sendFromName="Not available"),a.from="",this.$el.append(this.template(a))}})}),$(function(){App.Views.RequestsTable=Backbone.View.extend({tagName:"table",className:"table table-striped",initialize:function(){},addOne:function(a){var b=new App.Views.RequestRow({model:a});b.render(),this.$el.append(b.el)},addAll:function(){this.$el.append("<tr><th>Location</th><th>Request-Type</th><th>Request</th><th>From</th><th>Date(MM/DD/YY)</th><th>Response</th></tr>"),this.collection.forEach(this.addOne,this)},render:function(){this.addAll()}})}),$(function(){App.Views.TrendActivityReport=Backbone.View.extend({vars:{},events:{},template:$("#template-TrendActivityReport").html(),initialize:function(){},render:function(){var a=this;a.vars=a.data,a.vars.startDate=a.startDate,a.vars.endDate=a.endDate,a.vars.CommunityName=a.CommunityName,a.vars.lastActivitySyncDate=a.lastActivitySyncDate,a.$el.html(_.template(a.template,a.vars))}})}),$(function(){App.Views.courseSeach=Backbone.View.extend({className:"form",events:{"click #seachCourse":"seachCourse","click #back":"publicationdetails"},publicationdetails:function(){window.location.href="#publicationdetail/"+this.publicationId},render:function(){var a=this;this.$el.append('<p><h3>Courses</h3><a id="back" class="btn btn-success"> Done </a><h6 style="margin-top:-52px;float:right"><input placeholder="Key Word" style="margin-right:20px;height:30px;width:170px" type="text" id="SeachCourseText" ><a  style="margin-top: -11px; width: 60px;" class="btn btn-info" id="seachCourse" > Search </a> </h6></p>'),this.$el.append('<div id="courseList"></div>');var b=new App.Collections.Courses;b.fetch({success:function(b){var c=new App.Views.GroupsTable({collection:b});c.publicationId=a.publicationId,c.render(),$("#courseList").html(c.el)}})},seachCourse:function(a){var b=this,c=new App.Collections.Courses;""!=$("#SeachCourseText").val()&&(c.seachText='["'+$("#SeachCourseText").val()+'"]'),c.fetch({success:function(a){var c=new App.Views.GroupsTable({collection:a});c.publicationId=b.publicationId,c.render(),$("#courseList").html(c.el)}})}})}),$(function(){App.Views.listCommunityView=Backbone.View.extend({id:"invitationForm",events:{"click #cancelButton":"hidediv","click #formButton":"syncData"},hidediv:function(){$("#invitationdiv").fadeOut(1e3),setTimeout(function(){$("#invitationdiv").hide()},1e3)},render:function(){var a=$('<h6>Select Community(\'ies)</h6><select multiple id="comselect"></select><br><br><a class="btn btn-success" id="formButton">Send</button>');this.$el.append(a),this.$el.append("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"),this.$el.append('<a class="btn btn-warning" id="cancelButton">Cancel</button>')},syncData:function(){var a=$("#comselect").val();if(!a)return void alert("Please select Community first");App.startActivityIndicator();var b=new Array;if(a.length>0){for(var c=0;c<a.length;c++){var d=a[c],e=$("#comselect option[value='"+a[c]+"']").text();b.push({communityUrl:d,communityName:e,publicationId:this.pId,Viewed:!1})}$.couch.db("publicationdistribution").bulkSave({docs:b},{success:function(a){console.log(a)},error:function(a){console.log(a)}})}$("#list option[value='2']").text(),$("#invitationdiv").fadeOut(1e3),setTimeout(function(){$("#invitationdiv").hide()},1e3),App.stopActivityIndicator()},synchResCommunityWithURL:function(a,b,c){console.log("http://"+b+":"+App.password+"@"+a+":5984/pubresources"),$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"resources",target:"http://"+b+":"+App.password+"@"+a+":5984/pubresources",doc_ids:c}),success:function(a){console.log(a)},async:!1})},synchPubCommunityWithURL:function(a,b,c){console.log("http://"+b+":"+App.password+"@"+a+":5984/recpublication"),$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"publications",target:"http://"+b+":"+App.password+"@"+a+":5984/recpublication",doc_ids:c}),success:function(a){console.log(a)},async:!1})}})}),$(function(){App.Views.listSyncDbView=Backbone.View.extend({id:"invitationForm",events:{"click #cancelButton":"hidediv","click #formButton":"syncData","click #selectAll":"selectAll"},hidediv:function(){$("#invitationdiv").fadeOut(1e3),setTimeout(function(){$("#invitationdiv").hide()},1e3)},render:function(){var a=$('<h6>Select Item(\'s) To Sync</h6><br><br><input type="checkbox" value="Resources" name="syncData">Resources<br><input type="checkbox" value="ActivityReports" name="syncData">Log Activity Reports<br><input type="checkbox" value="Reports" name="syncData">Reports<br><input type="checkbox" value="Application" name="syncData" >Application<br><br><br>');this.$el.append(a),this.$el.append('<button class="btn btn-info" id="selectAll" style="width:110px">Select All</button><button style="margin-left:10px; width:110px" class="btn btn-success" id="formButton" style="width:110px">Send</button>'),
this.$el.append('<button class="btn btn-warning" id="cancelButton" style="width:110px;margin-left:10px">Cancel</button>')},selectAll:function(){"Select All"==$("#selectAll").text()?($("input[name='syncData']").each(function(){$(this).prop("checked",!0)}),$("#selectAll").text("Unselect All")):($("input[name='syncData']").each(function(){$(this).prop("checked",!1)}),$("#selectAll").text("Select All"))},syncData:function(){var a=this;App.startActivityIndicator(),$("input[name='syncData']").each(function(){$(this).is(":checked")&&("Resources"==$(this).val()?a.ReplicateResource():"ActivityReports"==$(this).val()?a.syncLogActivitiy():"Reports"==$(this).val()&&a.syncReports(),"Application"==$(this).val()&&a.checkAvailableUpdates())}),$("#invitationdiv").fadeOut(1e3),setTimeout(function(){$("#invitationdiv").hide()},1e3),App.stopActivityIndicator()},ReplicateResource:function(){App.startActivityIndicator();var a=this,b=($.url().attr("host").split("."),$.url().attr("host"),""),c="",d="",e=Backbone.Collection.extend({url:App.Server+"/configurations/_all_docs?include_docs=true"}),f=new e;f.fetch({async:!1});var g=f.first(),h=g.toJSON();d=h.rows[0].doc.type,b=h.rows[0].doc.nationUrl,c=h.rows[0].doc.nationName,App.$el.children(".body").html("Please Wait…");var i="",j="";$.ajax({url:"http://"+c+":"+App.password+"@"+b+":5984/communities/_all_docs?include_docs=true",type:"GET",dataType:"jsonp",success:function(e){for(var f=0;f<e.rows.length;f++){var g=e.rows[f],h=g.doc.url,k=g.doc.name;j=i,i=i+"<br>Replicating to "+k+". Please wait…",App.$el.children(".body").html(i),a.synchCommunityWithURL(h,k),i=j,i=i+"<br>Replication to "+k+" is complete.",App.$el.children(".body").html(i)}"nation"!=d&&(j=i,i=i+"<br>Replicating to "+k+". Please wait…",a.synchCommunityWithURL(b,c),i=j,i=i+"<br>Replication to "+k+" is complete.<br>Replication completed.")}}),App.stopActivityIndicator()},synchCommunityWithURL:function(a,b){console.log("http://"+b+":"+App.password+"@"+a+":5984/resources"),$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"resources",target:"http://"+b+":"+App.password+"@"+a+":5984/resources"}),success:function(a){},async:!1})},syncReports:function(){App.startActivityIndicator();var a=new App.Collections.Configurations;a.fetch({success:function(a){var b=a.first();console.log(b);var c=b.get("nationName"),d=b.get("nationUrl");$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"communityreports",target:"http://"+c+":"+App.password+"@"+d+":5984/communityreports"}),success:function(a){App.stopActivityIndicator(),alert("sync successfully "),Backbone.history.navigate("reports",{trigger:!0})},error:function(a,b,c){App.stopActivityIndicator(),alert("Status: "+b),alert("Error: "+c),Backbone.history.navigate("reports",{trigger:!0})},async:!1})}})},syncLogActivitiy:function(){var a=new App.Collections.Configurations;a.fetch({success:function(a){var b=a.first();console.log(b);var c=b.get("nationName"),d=b.get("nationUrl");$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"activitylog",target:"http://"+c+":"+App.password+"@"+d+"/activitylog"}),success:function(a){alert("Successfully Replicated Reports")},error:function(a,b,c){alert("Error (Try Later)")},async:!1})}})},versionCompare:function(a,b,c){function d(a){return(e?/^\d+[A-Za-z]*$/:/^\d+$/).test(a)}var e=c&&c.lexicographical;if(zeroExtend=c&&c.zeroExtend,v1parts=a.split("."),v2parts=b.split("."),!v1parts.every(d)||!v2parts.every(d))return NaN;if(zeroExtend){for(;v1parts.length<v2parts.length;)v1parts.push("0");for(;v2parts.length<v1parts.length;)v2parts.push("0")}e||(v1parts=v1parts.map(Number),v2parts=v2parts.map(Number));for(var f=0;f<v1parts.length;++f){if(v2parts.length==f)return 1;if(v1parts[f]!=v2parts[f])return v1parts[f]>v2parts[f]?1:-1}return v1parts.length!=v2parts.length?-1:0},checkAvailableUpdates:function(){var a,b=this,c=new App.Collections.Configurations;c.fetch({success:function(b){a=b.first()},async:!1});var d=a.get("nationName"),e=a.get("nationUrl"),f="http://"+d+":oleoleole@"+e+":5984/configurations/_all_docs?include_docs=true";$.ajax({url:f,type:"GET",dataType:"jsonp",success:function(c){var d=c.rows[0].doc;nationConfigJson=d,"undefined"==typeof d.version||d.version==a.get("version")||(b.versionCompare(d.version,a.get("version"))<0?console.log("Nation is at low level"):b.versionCompare(d.version,a.get("version"))>0?b.updateApp():console.log("Nation is uptodate"))}})},updateApp:function(){var a=Backbone.Collection.extend({url:App.Server+"/configurations/_all_docs?include_docs=true"}),b=new a;b.fetch({async:!1});var c=b.first().toJSON().rows[0].doc;c.version=this.latestVersion;var d=c.nationName,e=c.nationUrl;$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"http://"+d+":oleoleole@"+e+":5984/apps",target:"apps"}),success:function(a){console.log(a)},async:!1}),$.ajax({headers:{Accept:"application/json","Content-Type":"multipart/form-data"},type:"PUT",url:App.Server+"/configurations/"+c._id+"?rev="+c._rev,dataType:"json",data:JSON.stringify(c),success:function(a){console.log(a),alert("Successfully updated to latest version.")},async:!1})}})}),$(function(){App.Views.navBarView=Backbone.View.extend({tagName:"ul",className:"nav",authorName:null,template1:_.template($("#template-nav-logged-in").html()),template0:_.template($("#template-nav-log-in").html()),template2:_.template($("#template-nav-logged-in-cummunity").html()),initialize:function(a){0==a.isLoggedIn?this.template=this.template0:(this.template=this.template1,"community"==a.type&&(this.template=this.template2));var b=Backbone.history.location.href;b=b.split("#"),this.data={uRL:b[1]},this.$el.append(this.template(this.data))},render:function(){}})}),$(function(){App.Views.siteFeedback=Backbone.View.extend({tagName:"div",id:"site-feedback",authorName:null,initialize:function(){},events:{"click #formButton":"setForm","click #CancelButton":"cancelform","click #ViewAllButton":"gotoRoute"},gotoRoute:function(){var a=Backbone.history.location.href;a=a.split("#");for(var b=a[1].split("/"),c="LMS:"+b[0],d=1;d<b.length;d++)32!=b[d].length?c=c+"/"+b[d]:d=a.length;url=c,Backbone.history.navigate("siteFeedback",{trigger:!0})},cancelform:function(){$("#site-feedback").animate({height:"toggle"}),this.unsetForm()},setForm:function(){if(0!=$("#comment").val().length&&$('input[name="category"]:checked').val()){var a=Backbone.history.location.href,b=new Date;b.getDate(),a=a.split("#");var c="";$("#priority").is(":checked")&&(c="urgent"),this.model.set({comment:$("#comment").val(),category:$('input[name="category"]:checked').val(),priority:c,PageUrl:"Nation:"+a[1],Resolved:"0",memberLogin:$.cookie("Member.login"),time:b.toString()}),this.model.save(),alert("Feedback Successfully Sent"),this.unsetForm()}$("#site-feedback").animate({height:"toggle"})},unsetForm:function(){$("#comment",this.$el).val(""),$('input[name="category"]').attr("checked",!1),$("#priority").attr("checked",!1)},render:function(){this.$el.append('<br/><br/><div class="form-field" ><input name="PageUrl" id="PageUrl" type="text"></div>'),this.$el.append('<div class="form-field" style="margin-left:23px;"><input name="priority" value="urgent" id="priority" type="checkbox"><label for="priority">urgent</label></div>'),this.$el.append('<div class="form-field" style="margin-top: -28px;margin-left: 115px;"> <input type="radio" name="category" value="Bug">&nbsp Bug &nbsp&nbsp&nbsp<input type="radio" name="category" value="Question">&nbsp Question &nbsp&nbsp&nbsp<input type="radio" name="category" value="Suggestion">&nbsp Suggestion &nbsp&nbsp&nbsp</div><br/><br/>'),this.$el.append('<div class="form-field" style="margin-left:23px;"><textarea �rows="7" type="text" name="comment" id="comment"></textarea></div>'),this.$el.append('<div class="form-field"><input name="Resolved" id="Resolved" type="text"></div>'),this.$el.append('<div class="form-field"><input name="memberLogin" id="memberLogin" type="text"></div>'),this.$el.append('<div class="form-field"><input name="time" id="time" type="text"></div>'),$("#PageUrl",this.$el).hide(),$("#Resolved",this.$el).hide(),$("#memberLogin",this.$el).hide(),$("#time",this.$el).hide();var a=$('<br/><div id="f-formButton"><button class="btn btn-hg btn-danger" id="CancelButton">Cancel</button><button class="btn btn-hg btn-info" id="ViewAllButton">View</button><button class="btn btn-hg btn-primary" id="formButton">Submit</button></div>');this.$el.append(a)}})}),$(function(){App.Views.siteFeedbackPage=Backbone.View.extend({tagName:"table",className:" table-feedback notification-table table-striped",authorName:null,searchText:null,Resolved:null,stack:null,category:null,urgent:null,applyFilters:null,resultArray:null,events:{"click #see-all":function(a){for(this.applyFilters="0";skipStack.length>0;)skipStack.pop();searchText="",this.resultArray=[],skip=0,skipStack.push(skip),this.fetchRecords()},"click #switch":function(a){for(this.applyFilters="1",this.category=$("#select_category").val(),this.urgent=$("#select_urgent").val(),"Resolved"==$("#select_status").val()?this.Resolved="1":this.Resolved="0";skipStack.length>0;)skipStack.pop();searchText="",this.resultArray=[],skip=0,skipStack.push(skip),this.fetchRecords()},"click #search_feedback":function(a){if(this.applyFilters="0",searchText=$("#searchText").val(),""!=searchText){for(;skipStack.length>0;)skipStack.pop();this.resultArray=[],skip=0,skipStack.push(skip),this.fetchRecords()}},"click #previousButton":function(a){skipStack.length>1?(skipStack.pop(),skip=skipStack.pop(),skipStack.push(skip),this.resultArray=[],this.fetchRecords()):$("#previousButton").hide()},"click #next_button":function(a){skipStack.push(skip),this.resultArray=[],this.fetchRecords()}},initialize:function(){this.resultArray=[],this.category="Bug",this.Resolved="1",this.applyFilters="0",this.searchText="","unknown"==url&&(url="siteFeedback"),null==$("#comments")&&(alert($("#comments")),$("#debug").append('<div id="comments"></div>'))},addAll:function(){this.$el.html('<h4>Keyword:&nbsp;<input class="form-control" type="text" placeholder="Search in comment" value="" size="30" id="searchText" style="height:24px;margin-top:1%;"></input>&nbsp;<span><button class="btn btn-info" id="search_feedback">Search</button>&nbsp;<button class="btn btn-info" id="see-all">See All</button></span>&nbsp;<img id="progress_img" src="vendor/progress.gif" width="3%"></h4><br/>'),this.$el.append('<Select id="select_category"><option>Bug</option><option>Question</option><option>Suggestion</option></select>&nbsp;&nbsp<select id="select_status"><option>Unresolve</option><option>Resolved</option></select>&nbsp;&nbsp<select id="select_urgent"><option>Normal</option><option>Urgent</option></select>&nbsp;&nbsp<button class="btn btn-info" id="switch">Apply Filters</button><br/><br/>'),this.$el.append("<th ><h4>Feedback</h4></th><th ><h4>Status</h4></th>"),$("#progress_img").hide(),console.log(this.collection.toJSON()),this.collection.forEach(this.addOne,this),this.$el.append('<br/><br/><input type="button" class="btn btn-hg btn-primary" id="previousButton" value="< Previous"> &nbsp;&nbsp;&nbsp;<button class="btn btn-hg btn-primary" id="next_button" >Next  ></button>')},addOne:function(a){a.get("category")||a.set("category","Bug"),a.get("priority")||a.set("priority",[]);var b=new App.Views.siteFeedbackPageRow({model:a});b.render(),this.$el.append(b.el)},render:function(){this.addAll(),skipStack.length<=1&&$("#previousButton").hide(),this.collection.length<5&&$("#next_button").hide(),$("#progress_img").hide()},fetchRecords:function(){var a=this;this.collection.fetch({success:function(){if(a.resultArray.push.apply(a.resultArray,a.searchInArray(a.collection.models,searchText)),a.resultArray.length!=limitofRecords&&a.collection.models.length==limitofRecords)return void a.fetchRecords();if(0==a.resultArray.length&&0==a.collection.models.length&&skipStack.length>1)return $("#next_button").hide(),void skipStack.pop();0==a.resultArray.length&&1==skipStack.length&&""!=searchText&&alert("No result found");var b=new App.Collections.siteFeedbacks;a.resultArray.length>0&&(b.set(a.resultArray),a.collection=b,a.$el.html(""),a.render())}})},filterResult:function(a){var b=a.get("PageUrl");b||(b="");for(var c=b.split("/"),d=c[0],e=1;e<c.length;e++)32!=c[e].length?d=d+"/"+c[e]:e=b.length;return d==url?!0:(console.log(url),!1)},checkFilters:function(a){return console.log(a),this.filterResult(a)?"0"==this.applyFilters?!0:this.Resolved==a.get("Resolved")&&this.category==a.get("category")?"Normal"==this.urgent&&0==a.get("priority").length?!0:"Urgent"==this.urgent&&a.get("priority").length>0?!0:!1:!1:!1},searchInArray:function(a,b){var c=this,d=[];return _.each(a,function(a){null!=a.get("comment")&&(skip++,a.get("category")||a.set("category","Bug"),a.get("priority")||a.set("priority",[]),a.get("comment").toLowerCase().indexOf(b.toLowerCase())>=0&&c.checkFilters(a)?d.length<limitofRecords?d.push(a):(enablenext=1,skip--):d.length>=limitofRecords&&skip--)}),d}})}),$(function(){App.Views.siteFeedbackPageRow=Backbone.View.extend({template0:$("#template-siteReviewRowAdmin").html(),template1:$("#template-siteReviewRownoAdmin").html(),tagName:"tr",authorName:null,events:{"click #resolveButton":"resolve","click #commentButton":"comment"},comment:function(a){console.log(a.target.attributes[0].nodeValue);var b=new App.Collections.reportsComment;b.feedbackId=a.target.attributes[0].nodeValue,b.fetch({async:!1});var c=new App.Views.addComment({collection:b,commentId:a.target.attributes[0].nodeValue});c.render(),$("#debug").append(c.el)},resolve:function(a){console.log(a),a.preventDefault(),this.model.on("sync",function(){location.reload()}),this.model.save({Resolved:"1"},{success:function(){}})},initialize:function(){"admin"==$.cookie("Member.login")?this.template=this.template0:this.template=this.template1},render:function(){var a=this.model.toJSON();0==this.model.get("priority").length?a.urgent="Normal":a.urgent="Urgent",console.log(a),this.$el.html(_.template(this.template,a))}})});