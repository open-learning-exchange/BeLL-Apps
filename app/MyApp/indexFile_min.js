function showFeedbackForm(){App.renderFeedback(),"visible"!=document.getElementById("site-feedback").style.visibility?($("#site-feedback").animate({height:"320px"}),document.getElementById("site-feedback").style.visibility="visible"):$("#site-feedback").animate({height:"toggle"})}function sendAdminRequest(a,b,c){var d=new Date,e=new App.Models.Mail;e.set("senderId",$.cookie("Member._id")),e.set("receiverId",a),e.set("subject","Course Admission Request | "+decodeURI(b)),e.set("body",'Admission request received from user "'+$.cookie("Member.login")+'" in '+decodeURI(b)+' <br/><br/><button class="btn btn-primary" id="invite-accept" value="'+c+'" >Accept</button>&nbsp;&nbsp;<button class="btn btn-danger" id="invite-reject" value="'+c+'" >Reject</button>'),e.set("status","0"),e.set("type","admissionRequest"),e.set("sentDate",d),e.save(),$("#admissionButton").hide(),alert("Admission request successfully sent to this course leader.")}function searchResources(){skip=0,popAll(),lastpage=!1,App.Router.SearchResult(),$("#previous_button").remove(),$("#searchText").focus(),$("#searchText").val(searchText)}function popAll(){for(;skipStack.length>0;)skipStack.pop()}function onFocus(a){var b=a.value.length;a.setSelectionRange&&a.setSelectionRange(b,b)}function showComposePopupMultiple(a){$("#subject").val(""),$("#recipients").val(""),$("#mailbodytexarea").val("");var b=new Array;$("input[name='courseMember']").each(function(){$(this).is(":checked")&&b.push($(this).val())}),console.log(b),$("#recipients").val(b),showComposePopup()}function hideMail(){}function showComposePopup(){$("#emailCompose").popup({horizontal:"right",vertical:"bottom",background:!1,blur:!1,scrolllock:!0}),$("#emailCompose").popup("show")}function HandleBrowseClick(a){var b=document.forms["fileAttachment"+a]._attachments;b.click()}function FieSelected(a){var b=document.getElementById("courseId"+a).value,c=document.getElementById("stepTitle"+a).value,d=document.getElementById("stepNo"+a).value,e=new App.Models.Group;if(e.set("_id",b),e.fetch({async:!1}),e.get("courseLeader")){var f=$('input[type="file"]'),g=f.val().split(".");if(""!=f.val()&&"doc"!=g[g.length-1]&&"pdf"!=g[g.length-1]&&"mp4"!=g[g.length-1]&&"ppt"!=g[g.length-1]&&"docx"!=g[g.length-1]&&"pptx"!=g[g.length-1]&&"jpg"!=g[g.length-1]&&"jpeg"!=g[g.length-1]&&"png"!=g[g.length-1])return void alert("Invalid attatchment.");var h=new Date,i=new App.Models.Mail;i.set("senderId",$.cookie("Member._id")),i.set("receiverId",e.get("courseLeader")),i.set("subject","Assignment | "+e.get("name")),i.set("body","Assignment submited for <b>"+c+"</b>."),i.set("status","0"),i.set("type","mail"),i.set("sentDate",h),i.save();var j=new App.Models.AssignmentPaper;j.set("sentDate",h),j.set("senderId",$.cookie("Member._id")),j.set("courseId",b),j.set("stepId",a),j.set("stepNo",d),j.save(null,{success:function(){$('input[type="file"]').val()?j.saveAttachment("form#fileAttachment"+a,"form#fileAttachment"+a+" #_attachments","form#fileAttachment"+a+" .rev"):alert("no attachment"),j.on("savedAttachment",function(){alert("Assignement successfully submitted.")},j)}})}}function validateEmail(a){var b=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return b.test(a)}function sendMail(){var a=Backbone.Collection.extend({url:App.Server+"/configurations/_all_docs?include_docs=true"}),b=new a;b.fetch({async:!1});var c=b.first(),d=c.toJSON(),e=d.rows[0].doc.code+d.rows[0].doc.nationName.substring(3,5),f=!0,g=$("#recipients").val(),h=new Array,i=new Array,j=new Array;j=g.split(",");for(var k=0;k<j.length;k++){var l=j[k];if(validateEmail(l)){if("mycommunity@olebell.org"!=l){var m=l.split("@")[0].split(".");if(m.length>0){var n=m[m.length-1];console.log(e+"    "+n),n==e&&"olebell.org"==l.split("@")[1]||(h.push(l),i.push(k))}else i.push(k),h.push(l)}}else i.push(k),h.push(l)}for(var k=0;k<i.length;k++)j.splice(i[k],1);var o=$("#subject").val(),p=$("textarea#mailbodytexarea").val(),q=$('input[type="file"]');if(q.val())var r=q.val().split(".");else f=!1;if(""==g)alert("Please enter recipient.");else if(""==o)alert("Please enter subject.");else if(""==p)alert("Please enter message.");else if(f&&""!=q.val()&&"doc"!=r[r.length-1]&&"pdf"!=r[r.length-1]&&"mp4"!=r[r.length-1]&&"ppt"!=r[r.length-1]&&"docx"!=r[r.length-1]&&"pptx"!=r[r.length-1]&&"jpg"!=r[r.length-1]&&"jpeg"!=r[r.length-1]&&"png"!=r[r.length-1])alert("Invalid attatchment.");else{if(j.length<=0)return;var s="";if(-1!=j.indexOf("mycommunity@olebell.org")){var t=new App.Collections.Members;return t.fetch({async:!1}),t.each(function(a){s=a.get("login"),sendSingleMail(s,p,o,j)}),void alert("Mail successfully sent.")}for(var k=0;k<j.length;k++){if(-1!=j[k].indexOf("@olebell.org")){var u=j[k].split("@");s=u[0].substring(0,u[0].lastIndexOf("."))}else s=j[k];sendSingleMail(s,p,o,j)}alert("Mail successfully sent."),$("#MakeMailForMembers").popup("hide")}}function sendSingleMail(a,b,c,d){$.getJSON('/members/_design/bell/_view/MembersByLogin?include_docs=true&key="'+a+'"',function(e){if(e.rows[0]){var f=new Date,g=e.rows[0].doc._id,h=new App.Models.Mail;h.set("senderId",$.cookie("Member._id")),h.set("receiverId",g),h.set("subject",c),h.set("body",b),h.set("status","0"),h.set("type","mail"),h.set("sentDate",f),h.set("mailingList",d),$("#emailCompose").popup("hide"),h.save(null,{success:function(){h.unset("_attachments"),$('input[type="file"]').val()&&h.saveAttachment("form#fileAttachment","form#fileAttachment #_attachments","form#fileAttachment .rev"),h.on("savedAttachment",function(){},h)}}),$("#emailCompose").popup("hide")}else alert("Invalid mail address "+a)})}function getScheduleDatesForCourse(a,b,c){for(var d=a.getDay(),e=new Array;b>a||a.valueOf()==b.valueOf();){d=a.getDay();for(var f=new Date(a.valueOf()),g=0;g<c.length;g++)if(d<=c[g]){var h=a.getDate()+(c[g]-d);if(f.setDate(h),b>f||f.valueOf()==b.valueOf()){var i=new Date(f.valueOf());e.push(i)}else{if(f.valueOf()!=b.valueOf())break;var i=new Date(f.valueOf());e.push(i)}}a.setDate(a.getDate()+(7-a.getDay()))}return e}function convertTo24Hour(a){var b=parseInt(a.substr(0,2));return b}function startRecording(){function a(a){var b=document.createElement("audio");b=mergeProps(b,{controls:!0,src:URL.createObjectURL(a)}),b.volume=0,b.play(),f.appendChild(b),f.appendChild(document.createElement("hr"));var e=new MediaStreamRecorder(a);d=e,e.mimeType="audio/wav",e.ondataavailable=function(a){c(a)},e.start(2e4),alert("You have 20 seconds")}function b(a){console.error("media error",a)}function c(a){var b=document.createElement("a");b.target="_blank",b.innerHTML="Listen Recording "+g++,b.style.color="black",b.href=URL.createObjectURL(a),f.appendChild(b),f.appendChild(document.createElement("hr"));var c=document.getElementsByTagName("audio")[0];c.pause(),alert("stoped")}var d,e={audio:!0};navigator.getUserMedia_=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia_&&navigator.getUserMedia_(e,a,b);var f=document.getElementById("audios-container"),g=1}function AddToShelf(a,b){App.Router.AddToShelf(a,b)}function AddToShelfAndSaveFeedback(a,b){App.Router.AddToShelfAndSaveFeedback(a,b)}function showSubjectCheckBoxes(){var a=["Agriculture","Arts","Business and Finance","Environment","Food and Nutrition","Geography","Health and Medicine","History","Human Development","Languages","Law","Learning","Literature","Math","Music","Politics and Government","Reference","Religion","Science","Social Sciences","Sports","Technology"],b=a.length,c="<label style='font-size:16px'><b>Subject</b></label><br>";c+="<select id='multiselect-subject-search' multiple='multiple' style='width: 370px;'>";for(var d=0;b>d;d++)c=c+'<option id="subject'+(d+1)+'" value="'+a[d]+'">'+a[d]+"</option>";c+="</select>",$("#SubjectCheckboxes").html(c)}function ResourceSearch(){skip=0,searchText=$("#searchText").val(),searchType=$("#searchtype").val();var a=new Array,b=new Array,c=new Array,d=new Array;if(ratingFilter.length=0,skipStack.push(skip),a=$("#multiselect-collections-search").val(),b=$("#multiselect-subject-search").val(),c=$("#multiselect-levels-search").val(),d=$("#search-language").val(),authorName=$("#Author-name").val(),mediumFilter=$("#multiselect-medium-search").val(),$("input[name='star']").each(function(){$(this).is(":checked")&&ratingFilter.push($(this).val())}),""!=searchText||a||b||c||d||authorName||mediumFilter||ratingFilter&&ratingFilter.length>0){var e=new App.Views.Search;e.collectionFilter=a,e.languageFilter=d,e.levelFilter=c,e.subjectFilter=b,e.ratingFilter=ratingFilter,e.mediumFilter=mediumFilter,e.authorName=authorName,e.addResource=!1,App.$el.children(".body").html(e.el),e.render(),$("#srch").show(),$(".row").hide(),$("#not-found").show(),$(".search-bottom-nav").hide(),$(".search-result-header").hide(),$("#selectAllButton").hide()}}function backtoSearchView(){$("#not-found").hide(),searchText="",App.Router.bellResourceSearch()}function changeRatingImage(a,b){var c="";c="star-on.png"==$("#"+a+1).attr("src")?"star-off.png":"star-on.png";for(var d=1;5>=d;d++)$("#"+a+d).attr("src",c)}function showRequestForm(a){App.renderRequest(a)}function showSearchView(){$("#not-found").hide(),App.Router.SearchBell(grpId,levelrevId,0)}function selectAllSearchResult(){$("input[name='result']").each(function(){$(this).prop("checked",!0)})}function CourseSearch(){skip=0,searchText=$("#searchText").val(),App.Router.GroupSearch()}function ListAllCourses(){App.Router.Groups()}function AddColletcion(){App.Router.AddNewSelect("Add New")}function EditColletcion(a){App.Router.EditTag(a)}function continueMerging(){var a=$("#selectCollections").val(),b=$("#collectionName").val();a?a.length<2?alert("Please select 2 or more than 2 items to merge"):""==b?alert("Collection Name can not be Empty"):App.Router.mergecollection(a,b):alert("Please Select Collections to Merge")}function cancelMerging(){document.getElementById("cont").style.opacity=1,document.getElementById("nav").style.opacity=1,$("#invitationdiv").hide()}var searchText="",skip=0,enablenext=0,searchRecordsPerPage=2,limitofRecords=5,skipStack=new Array,ratingFilter=new Array,rtitle=new Array,rids=new Array,numberOfNotificattions=".";url="unknown";var lastpage=!1,mailView;$(window).scroll(function(){var a=$("#addEvent"),b=$(window).scrollTop();b>=118?a.css({top:"0",position:"fixed"}):a.css({position:"fixed",top:"68px"})});