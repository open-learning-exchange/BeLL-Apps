$(function(){App.Views.ActivityReport=Backbone.View.extend({vars:{},events:{},template:$("#template-ActivityReport").html(),initialize:function(){},render:function(){var a=this;$.ajax({url:"/members/_design/bell/_view/MaleCount?group=false",type:"GET",dataType:"json",success:function(b){a.vars=a.data,b.rows[0]?a.vars.MaleMembers=b.rows[0].value:a.vars.MaleMembers=0,$.ajax({url:"/members/_design/bell/_view/FemaleCount?group=false",type:"GET",dataType:"json",success:function(b){b.rows[0]?a.vars.FemaleMembers=b.rows[0].value:a.vars.FemaleMembers=0,a.vars.startDate=a.startDate,a.vars.endDate=a.endDate,a.vars.CommunityName=a.CommunityName,a.$el.html(_.template(a.template,a.vars))}})}})}})}),$(function(){App.Views.BecomeMemberForm=Backbone.View.extend({className:"form",events:{"click #formButton":"setForm","submit form":"setFormFromEnterKey"},render:function(){this.form=new Backbone.Form({model:this.model}),this.$el.append(this.form.render().el),this.form.fields.status.$el.hide(),this.form.fields.yearsOfTeaching.$el.hide(),this.form.fields.teachingCredentials.$el.hide(),this.form.fields.subjectSpecialization.$el.hide(),this.form.fields.forGrades.$el.hide(),this.form.fields.visits.$el.hide();var a=$('<a class="btn btn-success" id="formButton">Save</button>');this.$el.append(a)},setFormFromEnterKey:function(a){a.preventDefault(),this.setForm()},setForm:function(){if(null==this.form.validate()){var a=this;this.model.once("sync",function(){alert("Thank you for becoming a member"),$.cookie("Member.login",a.model.get("login"),{path:"/apps/_design/bell/lms"}),$.cookie("Member._id",a.model.get("id"),{path:"/apps/_design/bell/lms"}),$.cookie("Member.login",a.model.get("login"),{path:"/apps/_design/bell/personal"}),$.cookie("Member._id",a.model.get("id"),{path:"/apps/_design/bell/personal"}),a.trigger("BecomeMemberForm:done")}),this.form.setValue({status:"active"}),this.form.commit();var b=!0,c=new App.Collections.Members;c.fetch({async:!1}),c.each(function(c){c.get("login")==a.model.get("login")&&(alert("Login already exist"),b=!1)}),-1==$.inArray("lead",this.model.get("roles"))&&(a.model.set("yearsOfTeaching",null),a.model.set("teachingCredentials",null),a.model.set("subjectSpecialization",null),a.model.set("forGrades",null)),this.model.set("visits",0),b&&this.model.save()}}})}),$(function(){App.Views.CalendarForm=Backbone.View.extend({className:"signup-form",events:{"click #formButton":"setForm"},render:function(){this.form=new Backbone.Form({model:this.model}),this.$el.append(this.form.render().el);var a;a=this.update?$('<div class="signup-submit"><a class="addEvent-btn btn btn-success" style="width:" id="formButton">Update Event</button></div>'):$('<div class="signup-submit"><a class="addEvent-btn btn btn-success" id="formButton">Add Event</button></div>'),this.$el.append(a)},setForm:function(){var a=this;this.model.once("sync",function(){a.trigger("CalendarForm:done")}),this.form.setValue("userId",$.cookie("Member._id")),null==this.form.validate()&&(this.form.commit(),this.model.save(),this.update?alert("Event Successfully Updated!!!"):alert("Event Successfully Created!!!"),Backbone.history.navigate("calendar",{trigger:!0}))}})}),$(function(){App.Views.CollectionRow=Backbone.View.extend({tagName:"tr",template:$("#template-CollectionRow").html(),initialize:function(a){},render:function(){var a=this.model.toJSON();a.display=this.display,a.CollectionName||(a.CollectionName="XYZ"),this.$el.append(_.template(this.template,a))}})}),$(function(){App.Views.CollectionTable=Backbone.View.extend({tagName:"table",id:"collectionTable",display:!1,className:"table table-striped",initialize:function(a){},addOne:function(a){var b=new App.Views.CollectionRow({model:a});b.display=this.display,b.render(),this.$el.append(b.el)},events:{"click .clickonalphabets":function(a){this.collection.skip=0;var b=$(a.target).text();this.collection.startkey=b,this.collection.fetch({async:!1}),this.collection.length>0&&this.render()},"click #allresources":function(a){this.collection.startkey="",this.collection.skip=0,this.collection.fetch({async:!1}),this.collection.length>0&&this.render()},"click #mergeCollection":function(a){this.displayMergeForm()},"click #nextButton":function(a){this.collection.skip+=20,this.collection.fetch({async:!1}),this.collection.length>0&&this.render()},"click #preButton":function(a){this.collection.skip-=20,this.collection.fetch({async:!1}),this.collection.length>0&&this.render()}},displayMergeForm:function(){$("#invitationdiv").fadeIn(1e3),document.getElementById("cont").style.opacity=.1,document.getElementById("nav").style.opacity=.1,$("#invitationdiv").show(),$("#invitationdiv").html('<h5 style="margin-left:40px;margin-top:40px">Select Collections to Merge<h5>');var a='<p style="margin-left:20px;"><label style="margin-left:20px"><b>Collections</b></label><select multiple="true" style="width:400px;" id="selectCollections">';this.collection.each(function(b){a+='<option value="'+b.get("_id")+'">'+b.get("CollectionName")+"</option>"}),a+="</select></p>",$("#invitationdiv").append(a),$("#invitationdiv").append('<br><label style="margin-left:40px"><b>Name</b></label><input id="collectionName" type="text"></input>'),$("#invitationdiv select").multiselect().multiselectfilter(),$("#invitationdiv select").multiselect("uncheckAll"),$("#invitationdiv").append("<br><br>"),$("#invitationdiv").append('<button class="btn btn-success" style="margin-left:40px" id="continueMerging" onClick="continueMerging()">Continue</button>'),$("#invitationdiv").append('<button class="btn btn-danger" style="margin-left:20px"  id="cancelMerging" onClick="cancelMerging()">Cancel</button>')},addAll:function(){var a="<tr><th colspan='6'>Collections";1==this.display&&(a+="<a id='mergeCollection' style='margin-left:20px' class='btn btn-info small'>Merge</a>"),a+="</th></tr>",this.$el.html(a);var b="<tr></tr>";b+="<tr><td colspan=7>",b+='<a  id="allresources" >#</a>&nbsp;&nbsp;';for(var c="ABCDEFGHIJKLMNOPQRSTUVWXYZ",d=0;d<c.length;d++){var e=c.charAt(d);b+='<a  class="clickonalphabets" value="'+e+'">'+e+"</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"}b+="</td></tr>",this.$el.append(b),this.collection.each(this.addOne,this);var f="<tr><td>";this.collection.length>=20&&(this.collection.skip>=20&&(f+='<button class="btn btn-success" id="preButton">Back</buttton>'),f+='<button class="btn btn-success" id="nextButton">Next</buttton>'),f+="</td></tr>",this.$el.append(f)},render:function(){var a=this.getRoles();a.indexOf("Manager")>=0?this.display=!0:this.display=!1,this.addAll()},getRoles:function(){var a=new App.Models.Member({_id:$.cookie("Member._id")});a.fetch({async:!1});var b=a.get("roles");return b}})}),$(function(){App.Views.CommunityReportCommentView=Backbone.View.extend({tagName:"div",id:"comment-feedback",cId:null,initialize:function(a){console.log(a),this.cId=a.CommunityReportId,this.model=new App.Models.CommunityReportComment},events:{"click #submitFormButton":"submit","click #cancelFormButton":"cancel"},cancel:function(){$("#debug").hide(),this.remove()},submit:function(){if(0!=this.form.getValue("comment").length){var a=new Date;a.getDate(),this.form.setValue({CommunityReportId:this.cId}),this.form.setValue({commentNumber:this.collection.length+1}),this.form.setValue({memberLogin:$.cookie("Member.login")}),this.form.setValue({time:a.toString()}),this.form.commit(),this.model.save(),this.form.setValue({comment:""}),this.collection.fetch({async:!1}),this.model.set({comment:""}),this.render()}},addOne:function(a){$("#comments").append("<div id=tile><b>Login:</b>"+a.toJSON().memberLogin+"<br/><b>Time:</b>"+a.toJSON().time+"<br/><b>Comment:</b>"+a.toJSON().comment+"</div>"),console.log(a.toJSON())},render:function(){$("#debug").show(),this.$el.html("&nbsp;"),$("#comments").html("&nbsp;"),this.collection.forEach(this.addOne,this),this.form=new Backbone.Form({model:this.model}),this.$el.append(this.form.render().el),this.form.fields.CommunityReportId.$el.hide(),this.form.fields.commentNumber.$el.hide(),this.form.fields.memberLogin.$el.hide(),this.form.fields.time.$el.hide();var a=$('<div id="r-formButton"><button class="btn btn-primary" id="submitFormButton">Add Comment</button><button class="btn btn-info" id="cancelFormButton">Close</button></div>');this.$el.append(a)}})}),$(function(){App.Views.ConfigurationView=Backbone.View.extend({template:$("#template-Configuration").html(),template:_.template($("#template-Configuration").html()),vars:{},events:{"click #saveLanguage":function(a){var b=!1,c=$("#languageSelection").val();if(""!=c&&(this.model.set("currentLanguage",c),b=!0),""!=$("#appversion").val()&&(this.model.set("version",$("#appversion").val()),b=!0),""!=$("#notes").val()&&(this.model.set("notes",$("#notes").val()),b=!0),b){var d=this;console.log(this.model.toJSON()),this.model.save(null,{success:function(a,b){d.model.set("_rev",a.get("rev"))}}),alert("Configuration saved."),location.reload()}else alert("You have not changed any thing.")}},render:function(){this.vars=this.model.toJSON(),this.$el.html(this.template(this.vars)),this.$el.append('<br>&nbsp;&nbsp;<button class="btn btn-success" id="saveLanguage" >Save</button>')}})}),$(function(){App.Views.Configurations=Backbone.View.extend({initialize:function(){this.$el.html("<h3>Set Configurations<h3>")},events:{"click #formButton":"setForm"},render:function(){this.form=new Backbone.Form({model:this.model}),this.$el.append(this.form.render().el),this.$el.append('<a style="margin-left:31px;" class="btn btn-success" id="formButton">Submit Configurations </a>')},setForm:function(){if(this.form.commit(),null==this.form.validate()){var a=this.form.model,b=new App.Collections.Configurations;b.fetch({async:!1});var c=b.first();c.set("name",a.get("name")),c.set("nationName",a.get("nationName")),c.set("nationUrl",a.get("nationUrl")),c.set("code",a.get("code")),c.set("type",a.get("type")),c.set("notes",a.get("notes")),c.set("region",a.get("region")),c.set("version",a.get("version")),"Select an Option"!=a.get("selectLanguage")&&c.set("currentLanguage",a.get("selectLanguage")),c.save(null,{success:function(a,b){App.configuration=c;var d=new Date,e=d.getFullYear(),f=(1+d.getMonth()).toString();f=f.length>1?f:"0"+f;var g=d.getDate().toString();g=g.length>1?g:"0"+g;var h=e+"/"+f+"/"+g;$.ajax({type:"GET",url:'/activitylog/_design/bell/_view/getDocumentByDate?key="'+h+'"',dataType:"json",success:function(a){var b=a.rows[0].value;b.community=App.configuration.get("code"),$.ajax({type:"PUT",url:"/activitylog/"+b._id+"/?rev="+b._rev,data:JSON.stringify(b),async:!1,dataType:"json",success:function(a){console.log(a)}})}}),alert("Configurations are Successfully Added"),Backbone.history.navigate("dashboard",{trigger:!0})}})}}})}),$(function(){App.Views.CourseInfoView=Backbone.View.extend({authorName:null,tagName:"table",className:"courseInfo-table",initialize:function(){this.$el.html('<th colspan="20">Course Information</th>')},add:function(a){},render:function(){var a=this.model.toJSON(),b=this.leader.toJSON();this.$el.append("<tr><td>Name : </td><td>"+a.name+"</td></tr>"),this.$el.append("<tr><td>Levels : </td><td>"+a.subjectLevel+"</td></tr>"),this.$el.append("<tr><td>Description : </td><td>"+a.description+"</td></tr>"),this.$el.append("<tr><td>Leader Name: </td><td>"+b.firstName+" "+b.lastName+"</td></tr>"),this.$el.append("<tr><td>Leader Email : </td><td>"+b.email+"</td></tr>"),this.$el.append("<tr><td>Leader Phone Number : </td><td>"+b.phone+"</td></tr>");var c="",d="";""==a.backgroundColor&&(c="Not Set"),this.$el.append('<tr><td>Background Color : </td><td><div style="border:2px solid black;width:50px;height:20px;background-color:'+a.backgroundColor+'"></div>'+c+"</td></tr>"),""==a.foregroundColor&&(d="Not Set"),this.$el.append('<tr><td>foreground Color :</td><td><div style="border:2px solid black;width:50px;height:20px;background-color:'+a.foregroundColor+'"></div>'+d+"</td></tr>")}})}),$(function(){App.Views.CourseLevelsTable=Backbone.View.extend({id:"accordion",vars:{},modl:null,template:_.template($("#template-courseLevelsTable").html()),events:{"click #takequiz":"quiz","click #resourseOpened":function(a){resid=a.target.attributes.rid.nodeValue;var b=new App.Models.Member({_id:$.cookie("Member._id")});b.fetch({async:!1});var c=[];b.get("pendingReviews")&&(c=b.get("pendingReviews")),c.push(resid),b.set("pendingReviews",c),b.save(),ratingModel=new App.Models.Feedback,ratingModel.set("resourceId",resid),ratingModel.set("memberId",$.cookie("Member._id")),ratingView=new App.Views.FeedbackForm({model:ratingModel,resId:resid}),$("#externalDiv").html('<div id="star"></div>'),$("#star").append("Rating<br/>"),$("#star").raty(),$("#star > img").click(function(){ratingView.setUserRating($(this).attr("alt"))}),ratingView.render(),$("#externalDiv").append(ratingView.el),$("#externalDiv").show()}},quiz:function(a){var b=this,c=a.currentTarget.value;step=new App.Models.CourseStep({_id:c}),step.fetch({async:!1});var d=null;d=step.toJSON();var e=b.modl.get("stepsIds"),f=e.indexOf(c),g=new App.Views.takeQuizView({questions:d.questions,answers:d.answers,options:d.qoptions,passP:d.passingPercentage,resultModel:b.modl,stepIndex:f});g.render(),$("div.takeQuizDiv").html(g.el)},initialize:function(){$("div.takeQuizDiv").hide()},addAll:function(){this.collection.each(this.addOne,this)},addOne:function(a){if(this.vars=a.toJSON(),this.vars.outComes)if(this.vars.outComes instanceof Array);else{var b=this.vars.outComes;this.vars.outComes=new Array,this.vars.outComes[0]=b}else this.vars.outComes="",this.vars.questions&&this.vars.questions.length>0&&(this.vars.outComes=["Quiz"]);for(var c=0,d=this.modl.get("stepsStatus"),e=this.modl.get("stepsIds"),f=this.modl.get("stepsResult");c<d.length&&e[c]!=this.vars._id;)c++;c==d.length?(this.vars.status="Error!!",this.vars.marks="Error!!"):(this.vars.status=d[c],this.vars.marks=f[c],this.vars.index=c);var g=new Array,h=new Array;if(a.get("_attachments"))for(i=0;i<_.keys(a.get("_attachments")).length;i++){var j="/coursestep/"+a.get("_id")+"/",k="";"undefined"!=typeof a.get("_attachments")&&(j+=_.keys(a.get("_attachments"))[i],k=_.keys(a.get("_attachments"))[i],g.push(k),h.push(j))}this.vars.attachmentNames=g,this.vars.attachmentURLs=h,this.$el.append(this.template(this.vars))},setAllResults:function(){var a=this,b=$.cookie("Member._id"),c=this.collection.first().get("courseId"),d=new PouchDB("membercourseprogress");d.query({map:function(a){a.memberId&&a.courseId&&emit([a.memberId,a.courseId],a)}},{key:[b,c]},function(d,e){var f=new App.Collections.membercourseprogresses;f.memberId=b,f.courseId=c,f.fetch({async:!1,success:function(){a.renderaccordian(f.first())}})})},renderaccordian:function(a){var b=this;b.modl=a;for(var c=0,d=b.modl.get("stepsStatus"),e=d.length;e>c&&"0"!=d[c];)c++;b.addAll(),$("#accordion").accordion({header:"h3",heightStyle:"content"}).sortable({axis:"y",handle:"h3",stop:function(a,b){b.item.children("h3").triggerHandler("focusout")}})},render:function(){this.collection.length<1?this.$el.append('<p style="font-weight:900;">No data related to selected course found</p>'):this.setAllResults()}})}),$(function(){App.Views.CourseSearch=Backbone.View.extend({template:$("#template-Search").html(),vars:{},groupresult:null,resultArray:null,initialize:function(){this.groupresult=new App.Collections.SearchCourses,this.resultArray=[],enablenext=0},render:function(){""!=searchText&&this.fetchRecords()},fetchRecords:function(){var a=this;this.groupresult.fetch({success:function(){if(a.resultArray.push.apply(a.resultArray,a.searchInArray(a.groupresult.models,searchText)),a.resultArray.length!=searchRecordsPerPage&&a.groupresult.models.length==limitofRecords)a.fetchRecords();else if(0==a.groupresult.models.length)previousPageButtonPressed();else if(a.groupresult.models.length<limitofRecords&&0==a.resultArray.length&&1==skipStack.length)$("#not-found").html("No Such Record Exist"),$("#selectAllButton").hide();else{var b=new Backbone.Collection;if(a.resultArray.length>0){b.set(a.resultArray);var c=new App.Views.GroupsTable({collection:b});c.resourceids=a.resourceids,c.render(),$(".body").append(c.el)}else $("#not-found").html("No Such Record Exist"),$("#not-found").show()}}})},searchInArray:function(a,b){var c=[];return""!=b&&_.each(a,function(a){null!=a.get("name")&&(skip++,a.get("name").toLowerCase().indexOf(b.toLowerCase())>=0?c.length<searchRecordsPerPage?c.push(a):(enablenext=1,skip--):c.length>=searchRecordsPerPage&&skip--)}),c}})}),$(function(){App.Views.CourseStepsView=Backbone.View.extend({tagName:"table",className:"table table-striped",roles:null,addOne:function(a){},render:function(){this.collection.each(this.addStep,this)},addStep:function(a){this.$el.append("<tr><td></td><td><b>"+a.get("title")+"</b></br></br>"+a.get("description")+"</td></tr>")}})}),$(function(){App.Views.CoursesChartProgress=Backbone.View.extend({tagName:"div",className:"Graphbutton",arrayOfData:new Array,grandpassed:null,grandremaining:null,events:{"click #Donut":function(){$("#graph").html(" "),document.getElementById("horizontallabel").style.visibility="hidden",document.getElementById("veticallable").style.visibility="hidden",this.$el.html('<a class="btn btn-info" id="Bar">Detailed View</a>'),Morris.Donut({element:"graph",data:[{label:"Passed Steps",value:this.grandpassed},{label:"Remaining Steps",value:this.grandremaining}],colors:["#0B62A4","#7A92A3"]})},"click #Bar":function(){$("#graph").html(" "),document.getElementById("horizontallabel").style.visibility="visible",document.getElementById("veticallable").style.visibility="visible",this.$el.html('<a class="btn btn-info" id="Donut">Birdeye View</a>'),Morris.Bar({element:"graph",data:this.arrayOfData,xkey:"subject",ykeys:["passed","remaining"],labels:["passed","remaining"],gridTextWeight:900,gridTextSize:16,axes:!0,grid:!0,stacked:!0})}},addOne:function(a){temp=new Object,data=a.toJSON().stepsStatus,total=a.toJSON().stepsStatus.length,passed=0,remaining=0;for(var b=0;b<total;b++)"1"!=data[b]?(remaining++,this.grandremaining++):(passed++,this.grandpassed++);course=new App.Models.Group({_id:a.toJSON().courseId}),course.fetch({async:!1}),0==total?temp.subject=course.toJSON().name+" (No Steps)":temp.subject=course.toJSON().name,temp.passed=passed,temp.remaining=remaining,this.arrayOfData.push(temp)},BuildString:function(){0!=this.collection.length?this.collection.each(this.addOne,this):alert("No Data Found on Server")},render:function(){this.arrayOfData=[],this.grandpassed=0,this.grandremaining=0,this.BuildString(),Morris.Bar({element:"graph",data:this.arrayOfData,xkey:"subject",ykeys:["passed","remaining"],labels:["passed","remaining"],gridTextWeight:900,gridTextSize:12,axes:!0,grid:!0,stacked:!0,xLabelMargin:5}),this.$el.append('<a class="btn btn-info" id="Donut">Birdeye View</a>')}})}),$(function(){App.Views.CoursesStudentsProgress=Backbone.View.extend({tagName:"div",className:"Graphbutton",arrayOfData:new Array,grandpassed:null,grandremaining:null,totalRecords:null,startFrom:null,totalSpace:null,events:{"click #Donut":function(){$("#graph").html(" "),document.getElementById("horizontallabel").style.visibility="hidden",document.getElementById("veticallable").style.visibility="hidden",this.$el.html('<a class="btn btn-info" id="Bar">Detailed View</a>'),Morris.Donut({element:"graph",data:[{label:"Passed Steps",value:this.grandpassed},{label:"Remaining Steps",value:this.grandremaining}],colors:["#0B62A4","#7A92A3"]})},"click #Bar":function(){$("#graph").html(" "),document.getElementById("horizontallabel").style.visibility="visible",document.getElementById("veticallable").style.visibility="visible",this.$el.html('<a class="btn btn-info" id="Donut">Birdeye View</a>'),Morris.Bar({element:"graph",data:this.arrayOfData,xkey:"subject",ykeys:["passed","remaining"],labels:["passed","remaining"],gridTextWeight:900,gridTextSize:16,axes:!0,grid:!0,stacked:!0})}},addOne:function(a){temp=new Object,data=a.toJSON().stepsStatus,total=a.toJSON().stepsStatus.length,passed=0,remaining=0;for(var b=0;b<total;b++)"1"!=data[b]?(remaining++,this.grandremaining++):(passed++,this.grandpassed++);if(student=new App.Models.Member({_id:a.toJSON().memberId}),student.fetch({async:!1}),console.log(student.toJSON()),void 0!=student.toJSON().firstName){temp.name=student.toJSON().firstName,temp.passed=passed,temp.remaining=remaining,this.arrayOfData.push(temp);var c=new App.Collections.AssignmentPapers;c.senderId=a.get("memberId"),c.courseId=a.get("courseId"),c.fetch({async:!1});var d=this.startFrom+this.totalSpace/2-8,e='<table style="margin-top:14px;margin-left: '+d+'%; position:absolute ">';c.each(function(a){var b="/assignmentpaper/"+a.get("_id")+"/",c="";"undefined"!=typeof a.get("_attachments")&&(b+=_.keys(a.get("_attachments"))[0],c=_.keys(a.get("_attachments"))[0]),e=e+'<tr><td><a href="'+b+'" target="_blank" ><button class="btn btn-primary">Paper for Step No. '+a.get("stepNo")+"</button></td></tr></a>"}),e+="</table>",this.$el.append(e),this.startFrom=this.startFrom+this.totalSpace}},BuildString:function(){0!=this.collection.length?(this.startFrom=4,this.totalRecords=this.collection.length,this.totalSpace=93/this.collection.length,this.collection.each(this.addOne,this)):alert("No Data Found on Server")},render:function(){this.arrayOfData=[],this.grandpassed=0,this.grandremaining=0,this.BuildString(),Morris.Bar({element:"graph",data:this.arrayOfData,xkey:"name",ykeys:["passed","remaining"],labels:["passed","remaining"],gridTextWeight:900,gridTextSize:12,axes:!0,grid:!0,stacked:!0,xLabelMargin:5})}})}),$(function(){App.Views.Dashboard=Backbone.View.extend({template:$("#template-Dashboard").html(),vars:{},nationConfiguration:null,latestVersion:null,nationConfigJson:null,events:{"click #updateButton":"updateVersion","click #showReleaseNotesDiv":function(a){"none"==$("#releaseVersion").css("display")?$("#releaseVersion").slideDown("slow",function(){}):$("#releaseVersion").slideUp("slow",function(){$("#appversion").val(""),$("#notes").val("")})},"click #cancelnotes":function(a){$("#releaseVersion").slideUp("slow",function(){$("#appversion").val(""),$("#notes").val("")})},"click #savenotes":function(a){if(""==$("#appversion").val())return void alert("Please enter version no.");if(""==$("#notes").val())return void alert("Please enter release notes.");var b=Backbone.Collection.extend({url:App.Server+"/configurations/_all_docs?include_docs=true"}),c=new b;c.fetch({async:!1});var d=c.first();d=d.get("rows")[0].doc;var e=new App.Models.ReleaseNotes({_id:d._id});e.fetch({async:!1}),e.set("version",$("#appversion").val()),e.set("notes",$("#notes").val()),e.save(null,{success:function(a){$("#releaseVersion").slideUp("slow",function(){$("#appversion").val(""),$("#notes").val(""),alert("Notes successfully saved.")})}})},"click #viewReleaseNotes":function(a){"none"==$("#showReleaseNotes").css("display")?$("#showReleaseNotes").slideDown("slow",function(){$("textarea#shownotes").val(nationConfigJson.notes)}):$("#showReleaseNotes").slideUp("slow",function(){})}},updateVersion:function(a){var b=this;App.startActivityIndicator();var c=Backbone.Collection.extend({url:App.Server+"/configurations/_all_docs?include_docs=true"}),d=new c;d.fetch({async:!1});var e=d.first().toJSON().rows[0].doc;e.version=this.latestVersion;var f=e.nationName,g=e.nationUrl;$.ajax({url:"http://"+f+":oleoleole@"+g+'/community/_design/bell/_view/getCommunityByCode?_include_docs=true&key="'+App.configuration.get("code")+'"',type:"GET",dataType:"jsonp",success:function(a){if(a.rows.length>0){$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"http://"+f+":oleoleole@"+g+"/apps",target:"apps"}),async:!1,success:function(a){$.ajax({headers:{Accept:"application/json","Content-Type":"multipart/form-data"},type:"PUT",url:App.Server+"/configurations/"+e._id+"?rev="+e._rev,dataType:"json",data:JSON.stringify(e),success:function(a){console.log("Configurations Updated")},async:!1}),b.updateDesignDocs("activitylog"),b.updateDesignDocs("members"),b.updateDesignDocs("collectionlist"),b.updateDesignDocs("community"),b.updateDesignDocs("resources"),b.updateDesignDocs("coursestep"),b.updateDesignDocs("groups"),b.updateDesignDocs("publications")},error:function(){App.stopActivityIndicator(),alert("Not Replicated!")}});var c=a.rows[0].value,d=a.rows[0].id;$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"http://"+f+":oleoleole@"+g+"/community",target:"community",doc_ids:[d]}),success:function(a){console.log("Successfully Replicated.");var b=new Date,h=b.getFullYear(),i=(1+b.getMonth()).toString();i=i.length>1?i:"0"+i;var j=b.getDate().toString();j=j.length>1?j:"0"+j;c.lastAppUpdateDate=i+"/"+j+"/"+h,c.version=e.version,$.ajax({headers:{Accept:"application/json","Content-Type":"multipart/form-data"},type:"PUT",url:App.Server+"/community/"+d+"?rev="+c._rev,dataType:"json",data:JSON.stringify(c),success:function(a){$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"community",target:"http://"+f+":oleoleole@"+g+"/community",doc_ids:[d]}),success:function(a){alert("Updated Successfully"),window.location.reload(!1)},async:!1})},async:!1})},async:!1})}else alert(" The community is not authorized to update until it is properly configured with a nation"),window.location.reload(!1)},error:function(){console.log("http://"+f+":oleoleole@"+g+'/community/_design/bell/_view/getCommunityByCode?key="'+App.configuration.get("code")+'"')}})},updateDesignDocs:function(a){var b=Backbone.Collection.extend({url:App.Server+"/configurations/_all_docs?include_docs=true"}),c=new b;c.fetch({async:!1});var d=c.first().toJSON().rows[0].doc;d.version=this.latestVersion;var e=d.nationName,f=d.nationUrl;$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"http://"+e+":oleoleole@"+f+"/"+a,target:a,doc_ids:["_design/bell"]}),success:function(b){console.log(a+" DesignDocs successfully updated.")},async:!1})},render:function(){var a=this;this.vars.mails=0;var b=App.configuration.get("currentLanguage"),c=App.configuration.get("type");console.log(App.languageDict),console.log(b),this.vars.languageDict=App.languageDict,this.vars.imgURL="img/header_slice.png";var d=new App.Collections.MailUnopened({receiverId:$.cookie("Member._id")});d.fetch({async:!1}),this.vars.mails=d.length,this.$el.html(_.template(this.template,this.vars)),groups=new App.Collections.MemberGroups,groups.memberId=$.cookie("Member._id"),groups.fetch({success:function(a){groupsSpans=new App.Views.GroupsSpans({collection:groups}),groupsSpans.render(),$("#cc").append(groupsSpans.el),TutorsSpans=new App.Views.TutorsSpans({collection:groups}),TutorsSpans.render(),$("#tutorTable").append(TutorsSpans.el)}}),shelfSpans=new App.Views.ShelfSpans,shelfSpans.render(),UserMeetups=new App.Collections.UserMeetups,UserMeetups.memberId=$.cookie("Member._id"),UserMeetups.fetch({async:!1}),MeetupSpans=new App.Views.MeetupSpans({collection:UserMeetups}),MeetupSpans.render(),$("#meetUpTable").append(MeetupSpans.el),$(".now").html(moment().format("dddd | DD MMMM, YYYY"));var e=App.member,f="/members/"+e.id+"/";"undefined"!=typeof e.get("_attachments")&&(f+=_.keys(e.get("_attachments"))[0],document.getElementById("imgurl").src=f);var g,h=Backbone.Collection.extend({url:App.Server+"/configurations/_all_docs?include_docs=true"}),i=new h;i.fetch({async:!1,success:function(){g=i.first().toJSON().rows[0].doc}});var j=g.name,c=g.type;j=j.charAt(0).toUpperCase()+j.slice(1),j+="nation"===c?" Nation Bell":" Community Bell",$(".bellLocation").html(j),e.get("visits")||(e.set("visits",1),e.save()),0==parseInt(e.get("visits"))?temp="Error!!":temp=e.get("visits")+" visits";var k="&nbsp;-&nbsp;",l=0;if(-1!=e.get("roles").indexOf("Learner")&&(k+="Learner",l=1),-1!=e.get("roles").indexOf("Leader")&&(1==l&&(k+=",&nbsp;"),k+="Leader",l=1),-1!=e.get("roles").indexOf("Manager")&&(1==l&&(k+=",&nbsp;"),k+="nation"==c?'<a href="../nation/index.html#dashboard">Manager</a>':'<a href="#communityManage">Manager</a>'),$(".visits").html(temp),$(".name").html(e.get("firstName")+" "+e.get("lastName")+'<span style="font-size:15px;">'+k+'</span>&nbsp;<a href="#member/edit/'+$.cookie("Member._id")+'"><i class="fui-gear"></i></a>'),a.checkAvailableUpdates(e.get("roles"),a),"admin"===$.cookie("Member.login")){var m=$('<button id="welcomeButton" class="btn btn-hg btn-primary" onclick="document.location.href=\'#updatewelcomevideo\'">Update Welcome Video</button>');a.$el.append(m)}},checkAvailableUpdates:function(a,b){var c=this;if(-1!=$.inArray("Manager",a)){var d=App.configuration,e=d.get("nationName"),f=d.get("nationUrl"),g="http://"+e+":oleoleole@"+f+"/configurations/_all_docs?include_docs=true";nName=App.configuration.get("nationName"),pass=App.password,nUrl=App.configuration.get("nationUrl"),currentBellName=App.configuration.get("name");var h=(this.$el,"http://"+nName+":"+pass+"@"+nUrl+'/publicationdistribution/_design/bell/_view/getPublications?include_docs=true&key=["'+currentBellName+'",'+!1+"]");$.ajax({url:g,type:"GET",dataType:"jsonp",success:function(a){var e=a.rows[0].doc;nationConfigJson=e,"undefined"==typeof e.version||e.version==d.get("version")||(c.versionCompare(e.version,d.get("version"))<0?console.log("Nation has lower application version than that of your community application"):c.versionCompare(e.version,d.get("version"))>0?(b.latestVersion=e.version,b.$el.append('<button class="btn systemUpdate" id="updateButton">System Update Available ('+e.version+") </button>"),b.$el.append('<button class="btn systemUpdate" id="viewReleaseNotes">View Release Notes </button>')):console.log("Nation is uptodate"))},error:function(a,b,c){console.log('Error fetching application version from nation "'+d.nationName+'"'),console.log(b),console.log(c)}}),$.ajax({url:h,type:"GET",dataType:"jsonp",success:function(a){var c=[],d=[];_.each(a.rows,function(a){c.push(a.doc),d.push(a.doc.publicationId)});var e=0,f=new App.Collections.Publication,g=App.Server+"/publications/_design/bell/_view/allPublication?include_docs=true";f.setUrl(g),f.fetch({success:function(){var a=f.models;for(var d in c){var g=a.map(function(a){return a.get("_id")}).indexOf(c[d].publicationId);g>-1||e++}e>0&&b.$el.append('<a class="btn systemUpdate" id="newPublication" href="#publications/for-'+currentBellName+'">Publications (new '+e+")</a>")}})},error:function(a,b,c){console.log(a),console.log(b),console.log(c)}})}},versionCompare:function(a,b,c){function d(a){return(e?/^\d+[A-Za-z]*$/:/^\d+$/).test(a)}var e=c&&c.lexicographical;if(zeroExtend=c&&c.zeroExtend,v1parts=a.split("."),v2parts=b.split("."),!v1parts.every(d)||!v2parts.every(d))return NaN;if(zeroExtend){for(;v1parts.length<v2parts.length;)v1parts.push("0");for(;v2parts.length<v1parts.length;)v2parts.push("0")}e||(v1parts=v1parts.map(Number),v2parts=v2parts.map(Number));for(var f=0;f<v1parts.length;++f){if(v2parts.length==f)return 1;if(v1parts[f]!=v2parts[f])return v1parts[f]>v2parts[f]?1:-1}return v1parts.length!=v2parts.length?-1:0}})}),$(function(){App.Views.EventInfo=Backbone.View.extend({authorName:null,tagName:"table",className:"btable btable-striped resourceDetail",sid:null,rid:null,events:{"click #DestroyEvent":function(a){this.model.toJSON(),$.cookie("Member._id");this.model.destroy(),alert("Event Successfully Deleted!!!"),Backbone.history.navigate("calendar",{trigger:!0})}},initialize:function(){this.$el.append('<th colspan="2"><h6>Event Detail</h6></th>')},render:function(){var a=this.model.toJSON(),b=new Date(a.schedule);a.schedule=b.toUTCString(),console.log(a),this.$el.append("<tr><td>Title</td><td>"+a.title+"</td></tr>"),this.$el.append("<tr><td>Description</td><td>"+a.description+"</td></tr>"),
this.$el.append("<tr><td>Start Date</td><td>"+a.startDate+"</td></tr>"),this.$el.append("<tr><td>End Date</td><td>"+a.endDate+"</td></tr>"),this.$el.append("<tr><td>Timing</td><td>"+a.startTime+"-"+a.endTime+"</td></tr>"),this.$el.append('<tr><td colspan="2"><button class="btn btn-danger" id="DestroyEvent">Destroy</button><a href="#calendar" style="margin-left:10px" class="btn btn-info">&lt;&lt; Calendar</a></td></tr>')}})}),$(function(){App.Views.FeedbackForm=Backbone.View.extend({tagName:"form",user_rating:"null",events:{"click #formButton":"setForm","submit form":"setFormFromEnterKey"},render:function(){var a=this;this.user_rating=0,console.log(this.model),this.form=new Backbone.Form({model:this.model});var b=this.model;this.$el.append(this.form.render().el),this.form.fields.rating.$el.hide(),this.form.fields.memberId.$el.hide(),this.form.fields.resourceId.$el.hide(),this.form.fields.communityCode.$el.hide();var c=$('<a class="btn btn-success" style="margin-left:10px" id="formButton">Save</a>');$btnAddToShelf=$('<button class="btn btn-success" id="AddToShelf" style="margin-left:10px">Save And Add To My Library</button>'),this.$el.append(c),this.$el.append($btnAddToShelf),$btnAddToShelf.click(function(){a.setForm(),a.user_rating>0&&AddToShelfAndSaveFeedback(b.get("resourceId"),escape(a.rtitle))})},setFormFromEnterKey:function(a){a.preventDefault(),this.setForm()},setUserRating:function(a){this.user_rating=a},setForm:function(){if(0==this.user_rating)alert("Please rate the resource first");else{0==this.form.getValue("comment").length&&this.form.setValue("comment","No Comment"),this.form.setValue("rating",this.user_rating),this.form.setValue("communityCode",App.configuration.get("code")),this.form.commit();var a=this,b=a.model,c=new App.Models.Member;c.set("_id",$.cookie("Member._id")),c.fetch({success:function(c,d){a.logActivity(c,b)}});var d=new PouchDB("feedback");d.post(a.model.toJSON(),function(b,c){if(b)console.log(b);else{var d=new PouchDB("resources"),e=a.model.get("resourceId");console.log(e),d.get(e,function(b,c){if(console.log(b),console.log(c),b)d.post({_id:e,sum:parseInt(a.user_rating),timesRated:1},function(a,b){console.log(a),console.log(b)});else{var f=parseInt(c.timesRated);f++;var g=parseInt(c.sum)+parseInt(a.user_rating);d.put({sum:g,timesRated:f},c._id,c._rev,function(a,b){console.log(a),console.log(b)})}console.log("Rating is successfully saved"),Backbone.history.navigate("resources",{trigger:!0})}),console.log(c)}}),$("#externalDiv").hide()}},logActivity:function(a,b){var c=this,d=new PouchDB("activitylogs"),e=new Date,f=this.getFormattedDate(e);d.get(f,function(e,g){e?c.createJsonlog(a,f,d,b):c.UpdatejSONlog(a,g,d,b,f)})},createJsonlog:function(a,b,c,d){var e=this,f={logDate:b,resourcesIds:[],male_visits:0,female_visits:0,male_timesRated:[],female_timesRated:[],male_rating:[],community:App.configuration.get("code"),female_rating:[],resources_names:[],resources_opened:[],male_opened:[],female_opened:[],male_deleted_count:0,female_deleted_count:0};c.put(f,b,function(f,g){f?(console.log("FeedbackForm:: createJsonlog:: error creating/pushing activity log doc in pouchdb.."),console.log(f)):(console.log("FeedbackForm:: createJsonlog:: created activity log in pouchdb for today.."),c.get(b,function(f,g){f?console.log("FeedbackForm:: createJsonlog:: Error fetching activitylog doc from Pouch after creating it"):e.UpdatejSONlog(a,g,c,d,b)}))})},UpdatejSONlog:function(a,b,c,d,e){var f=a.get("roles").indexOf("SuperManager");console.log(d),memRating=parseInt(d.get("rating"));var g=d.get("resourceId"),h=b.resourcesIds.indexOf(g);-1==h?(b.resourcesIds.push(g),"Male"==a.get("Gender")?-1==f?(b.male_rating.push(memRating),b.female_rating.push(0),b.male_timesRated.push(1),b.female_timesRated.push(0)):(b.male_rating.push(0),b.female_rating.push(0),b.male_timesRated.push(0),b.female_timesRated.push(0)):-1==f?(b.male_rating.push(0),b.female_rating.push(memRating),b.male_timesRated.push(0),b.female_timesRated.push(1)):(b.male_rating.push(0),b.female_rating.push(0),b.male_timesRated.push(0),b.female_timesRated.push(0))):"Male"==a.get("Gender")?-1==f&&(b.male_rating[h]=parseInt(b.male_rating[h])+memRating,b.male_timesRated[h]=parseInt(b.male_timesRated[h])+1):-1==f&&(b.female_rating[h]=parseInt(b.female_rating[h])+memRating,b.female_timesRated[h]=parseInt(b.female_timesRated[h])+1),c.put(b,e,b._rev,function(a,b){a?(console.log("FeedbackForm:: UpdatejSONlog:: err making update to record"),console.log(a)):console.log("FeedbackForm:: UpdatejSONlog:: updated daily log from pouchdb for today..")})},getFormattedDate:function(a){var b=a.getFullYear(),c=(1+a.getMonth()).toString();c=c.length>1?c:"0"+c;var d=a.getDate().toString();return d=d.length>1?d:"0"+d,c+"/"+d+"/"+b}})}),$(function(){App.Views.FeedbackRow=Backbone.View.extend({vars:{},tagName:"tr",events:{"click .destroy":function(a){a.preventDefault(),this.model.destroy(),this.remove()},"click .browse":function(a){a.preventDefault(),$("#modal").modal({show:!0})}},template:$("#template-FeedbackRow").html(),render:function(){var a=this.model.toJSON();a.memberName="",this.$el.append(_.template(this.template,a))}})}),$(function(){App.Views.FeedbackTable=Backbone.View.extend({tagName:"table",className:"btable btable-striped",addOne:function(a){var b=new App.Views.FeedbackRow({model:a});b.render(),this.$el.append(b.el)},addAll:function(){this.$el.append("<tr><th>Comment</th><th>Rating</th></tr>"),this.collection.each(this.addOne,this)},render:function(){this.addAll()}})}),$(function(){App.Views.GroupForm=Backbone.View.extend({className:"form",id:"groupform",prevmemlist:null,btnText:"Continue",events:{"click #sformButton":"setForm","click #uformButton":"setForm","submit form":"setFormFromEnterKey","click #inviteMemberButton":"MemberInvite","click #coursescheduleButton":"CourseSchedule","click #cancel":function(){window.history.back()}},CourseSchedule:function(){var a=new App.Views.CourseScheduleForm;a.courseId=this.model.id;var b,c=new App.Collections.CourseScheduleByCourse;c.courseId=this.model.id,c.fetch({async:!1}),c.length>0&&(b=c.first(),console.log(b),a.edit=!0,a.sid=b.get("_id"),a.srevid=b.get("_rev")),a.render(),App.$el.children(".body").html('<a id="BackToCourse" onclick = "location.reload()" class="btn btn-info"><< Back To Course</a>'),App.$el.children(".body").append('<p id="scheduletitle">'+this.model.get("name")+"|Schedule</p>"),App.$el.children(".body").append(a.el),$("#startTime").timepicker(),$("#endTime").timepicker(),$("#startDate").datepicker(),$("#endDate").datepicker(),$("#typeView").hide(),$(".days").hide(),c.length>0&&(b=c.first(),$("#startTime").val(b.get("startTime")),$("#endTime").val(b.get("endTime")),$("#startDate").val(b.get("startDate")),$("#endDate").val(b.get("endDate")),$("#location").val(b.get("location")),$("#type").val(b.get("type")),"Weekly"==b.get("type")&&$("#weekDays").val(b.get("weekDays"))),$("#type").on("change",function(){"Monthly"==this.value?($("#typeView").show(),$(".days").hide(),$("#typeView").multiDatesPicker()):"Weekly"==this.value?($(".days").show(),$("#typeView").hide()):($(".days").hide(),$("#typeView").hide())})},MemberInvite:function(){if($("textarea[name='description']").val().length>0){$("#invitationdiv").fadeIn(1e3),document.getElementById("cont").style.opacity=.1,document.getElementById("nav").style.opacity=.1,$("#invitationdiv").show();var a=new App.Models.InviFormModel;a.resId=this.model.get("_id"),a.senderId=$.cookie("Member._id"),a.type=this.model.get("kind"),a.title=this.model.get("name");var b=new App.Views.InvitationForm({model:a});b.description=this.model.get("description"),b.render(),$("#invitationdiv").html("&nbsp"),$("#invitationdiv").append(b.el)}else alert("Specify course description first")},getRoles:function(){var a=new App.Models.Member;return a.id=$.cookie("Member._id"),a.fetch({async:!1}),a.get("roles")},render:function(){$("#invitationdiv").hide();var a=this;void 0!=this.model.get("_id")&&(this.prevmemlist=this.model.get("members"),this.model.on({"change:statDate":this.sendMail,"change:endDate":this.sendMail,"change:startTime":this.sendMail,"change:endTime":this.sendMail,"change:location":this.sendMail})),this.model.get("languageOfInstruction")||this.model.set("languageOfInstruction",""),this.model.schema.members.options=[];var b=new App.Collections.leadermembers;b.fetch({success:function(){var c=[];c.push({label:"Select....",val:"0000"}),b.each(function(a){var b={label:a.toJSON().firstName+" "+a.toJSON().lastName,val:a.toJSON()._id};c.push(b)}),a.model.schema.courseLeader.options=c,a.form=new Backbone.Form({model:a.model}),a.$el.append(a.form.render().el),a.form.fields.members.$el.hide(),void 0==a.model.get("_id")&&a.form.fields.Day.$el.hide(),$(".field-backgroundColor input").spectrum({clickoutFiresChange:!0,preferredFormat:"hex"}),$(".field-foregroundColor input").spectrum({clickoutFiresChange:!0,preferredFormat:"hex"});var d=$('<a class="group btn btn-success" id="sformButton">Continue</button>'),e=$('<a class="group btn btn-success" style="" id="uformButton">Update</button>'),f=$('<a style="margin-left:52%;margin-top: -100px;" role="button" id="ProgressButton" class="btn" href="#course/report/'+a.model.get("_id")+"/"+a.model.get("name")+'"> <i class="icon-signal"></i> Progress</a><a style="margin-top: -100px;"class="btn btn-success" id="inviteMemberButton">Invite Member</button><a style="margin-top: -100px;"class="btn btn-success" id="" href="#course/members/'+a.model.get("_id")+'"> Members</a>');void 0!=a.model.get("_id")?(a.$el.prepend(f),a.$el.append(e)):a.$el.append(d),a.$el.append("<a class='btn btn-danger' style='margin-left : 20px;' id='cancel'>Cancel</a>")},async:!1})},setFormFromEnterKey:function(a){a.preventDefault(),this.setForm()},setForm:function(){var a=this,b=0;this.model.once("sync",function(){Backbone.history.navigate("course/manage/"+a.model.get("id"),{trigger:!0})});var c=this.model.get("courseLeader");if(this.form.commit(),this.model.set("name",this.model.get("CourseTitle")),void 0==this.model.get("_id")?(b=1,this.model.set("members",[$.cookie("Member._id")])):this.model.set("members",this.prevmemlist),0==this.model.get("CourseTitle").length)alert("Course Title is missing");else if(0==this.model.get("description").length)alert("Course description is missing");else{var d=new App.Models.Member;d.id=$.cookie("Member._id"),d.fetch({async:!1}),-1==d.get("roles").indexOf("Leader")&&(d.get("roles").push("Leader"),d.save());var e=!1,f=this.model.get("courseLeader"),g=this.model.get("members");g.indexOf(c);-1==g.indexOf(f)?g.push(f):e=!0,this.model.set("members",g),console.log();var h=this;this.model.save(null,{success:function(d){console.log(h.model.get("courseLeader"));var g=new App.Models.membercourseprogress,i=new Array,j=new Array,k=new Array;if(1==b)g.set("stepsIds",i),g.set("memberId",$.cookie("Member._id")),g.set("stepsResult",j),g.set("stepsStatus",k),g.set("courseId",d.get("id")),g.save(),h.model.get("courseLeader")!=$.cookie("Member._id")&&"0000"!=h.model.get("courseLeader")&&(g.set("stepsIds",i),g.set("memberId",h.model.get("courseLeader")),g.set("stepsResult",j),g.set("stepsStatus",k),g.set("courseId",d.get("id")),g.save()),alert("Course successfully Created.");else{if(f!==c&&e===!1){var l=new App.Collections.coursesteps;l.courseId=h.model.get("_id"),l.fetch({success:function(){l.each(function(a){i.push(a.get("_id")),j.push("0"),k.push("0")}),g.set("stepsIds",i),g.set("memberId",f),g.set("stepsResult",j),g.set("stepsStatus",k),g.set("courseId",l.courseId),g.save({success:function(){alert("saved")}})}})}var m=new App.Models.Group;m.id=a.model.get("_id"),m.fetch({async:!1}),a.model.set("_rev",m.get("_rev")),alert("Course successfully Updated.")}}})}},sendMail:function(a){memberList=a._previousAttributes.members;for(var b=0;b<memberList.length;b++){var c=new App.Models.Member({_id:memberList[b]});c.fetch({async:!1});var d=new Date,e=new App.Models.Mail;e.set("senderId",$.cookie("Member._id")),e.set("receiverId",c.get("_id")),e.set("subject","Change of Course Schedule | "+a.get("name"));var f="<b>Schedule is changed </b><br><br>New Schedule is:<br> Duration:   "+a.get("startDate")+"  to  "+a.get("endDate")+"<br>";f+="Timing:        "+a.get("startTime")+"  to  "+a.get("endTime"),f+="<br>Locatoin:      "+a.get("location"),e.set("body",f),e.set("status","0"),e.set("type","mail"),e.set("sentDate",d),e.save()}}})}),$(function(){App.Views.GroupMembers=Backbone.View.extend({vars:{},initialize:function(){},events:{"click  #selectAllMembers":"selectAllMembers","click  .removeMember":"removeMember","click #retrunBack":function(a){history.back()}},selectAllMembers:function(){"Select All"==$("#selectAllMembers").text()?($("input[name='courseMember']").each(function(){$(this).prop("checked",!0)}),$("#selectAllMembers").text("Unselect All")):($("input[name='courseMember']").each(function(){$(this).prop("checked",!1)}),$("#selectAllMembers").text("Select All"))},removeMember:function(a){var b=a.currentTarget.value,c=this,d=new App.Models.Group({_id:this.courseId});d.fetch({success:function(a){for(members=a.get("members"),members.splice(members.indexOf(b),1),a.set("members",members),a.save(),memberCoursePro=new App.Collections.membercourseprogresses,memberCoursePro.memberId=b,memberCoursePro.courseId=c.courseId,memberCoursePro.fetch({async:!1});model=memberCoursePro.first();)model.destroy();c.render(),alert("Member is Removed From Course")}})},render:function(){var a=new App.Models.Group({_id:this.courseId});a.fetch({async:!1});var b=a.get("members"),c=Backbone.Collection.extend({url:App.Server+"/configurations/_all_docs?include_docs=true"}),d=new c;d.fetch({async:!1});var e=d.first().toJSON(),f=e.rows[0].doc.code,g=e.rows[0].doc.nationName.substring(3,5);this.$el.html('<h3 style="margin-left:5%">Course Members | '+a.get("name")+"</h3>");for(var h='<table class="btable btable-striped"><th>Photo</th><th colspan=3>Name</th>',i=0;i<b.length;i++){var j=new App.Models.Member({_id:b[i]});j.fetch({async:!1});var k=j.get("login")+"."+f+g+"@olebell.org",l="img/default.jpg",m="/members/"+j.id+"/";"undefined"!=typeof j.get("_attachments")&&(m+=_.keys(j.get("_attachments"))[0],l=m),h+='<tr><td><img width="45px" height="45px" src="'+l+'"/></td><td>'+j.get("firstName")+" "+j.get("lastName")+'</td><td><input type="checkbox" name="courseMember" value="'+k+'">Send mail</td>',$.cookie("Member._id")==a.get("courseLeader")&&(h+='<td><button class="btn btn-danger removeMember" value="'+j.get("_id")+'">Remove</button></td>'),h+="</tr>"}h+='<tr><td></td><td></td><td><button class="btn"  id="selectAllMembers">Select All</button><button style="margin-left:10px" class="btn" onclick=showComposePopupMultiple("'+k+'") id="sendMailButton">Send Mail</button><button class="btn" style="margin-left:10px"  id="retrunBack">Back</button></td></tr>',h+="</table>",this.$el.append(h)}})}),$(function(){App.Views.GroupRow=Backbone.View.extend({tagName:"tr",roles:null,events:{"click .destroy":function(a){a.preventDefault();var b,c=this.model.get("_id"),d=new App.Collections.CourseLevels;d.groupId=c,d.fetch({success:function(){for(;b=d.first();)b.destroy()}}),console.log("Course Step Deleted");var b,e=new App.Collections.StepResultsbyCourse;e.courseId=c,e.fetch({success:function(){for(;b=e.first();)b.destroy()}}),console.log("Course Progress Deleted");var b,f=new App.Collections.EntityInvitation;f.entityId=c,f.fetch({success:function(){for(;b=f.first();)b.destroy()}});var g=new App.Models.CourseSchedule;g.courseId=c,g.fetch({success:function(){g.destroy()}}),this.model.destroy(),this.remove()},"click .browse":function(a){a.preventDefault(),$("#modal").modal({show:!0})}},template:$("#template-GroupRow").html(),initialize:function(a){this.roles=a.roles},render:function(){if(null==this.courseId){var a=this.model.toJSON();if(a.courseId=this.courseId,"_design/bell"==a._id)return;a.members||(a.members=new Array),void 0!=a.courseLeader&&a.courseLeader==$.cookie("Member._id")?a.isLeader=1:a.isLeader=0,-1!=this.roles.indexOf("Manager")||a.courseLeader==$.cookie("Member._id")||-1!=a.members.indexOf($.cookie("Member._id"))?a.viewProgress=1:a.viewProgress=0,-1!=this.roles.indexOf("Manager")?a.isAdmin=1:a.isAdmin=0,this.$el.append(_.template(this.template,a))}else{var a=this.model.toJSON();a.viewProgress=0,a.isAdmin=0,a.isLeader=0,a.courseId=this.courseId,this.$el.append(_.template(this.template,a))}}})}),$(function(){App.Views.GroupSpan=Backbone.View.extend({tagName:"td",className:"course-box",template:$("#template-GroupSpan").html(),render:function(){if(this.model.keys().length<5)return void this.model.destroy();var a=this.model.toJSON(),b=new App.Collections.membercourseprogresses;b.courseId=a._id,b.memberId=$.cookie("Member._id"),b.fetch({async:!1});var c="",d=0,e=0;if(0!=b.length)for(c=b.first().toJSON(),d=0,temp=0,e=c.stepsStatus.length;temp<e;)"1"==c.stepsStatus[temp]&&d++,temp++;console.log("here is Group Span"),0!=e?a.yes="<br>("+d+"/"+e+")":a.yes="<br>(No Steps)",this.$el.append(_.template(this.template,a))}})}),$(function(){App.Views.GroupView=Backbone.View.extend({tagName:"table",className:"table table-striped",roles:null,events:{"click #admissionButton":function(a){}},render:function(){console.log(this.model),this.addCourseDetails()},addCourseDetails:function(){var a=this.model.toJSON(),b=this.courseLeader.toJSON();console.log(a),console.log(b),this.$el.append("<tr><td><b>Name</b></td><td>"+a.CourseTitle+"</td></tr>"),this.$el.append("<tr><td><b>Subject Level </b></td><td>"+a.subjectLevel+"</td></tr>"),this.$el.append("<tr><td><b>Grade Level </b></td><td>"+a.gradeLevel+"</td></tr>"),this.$el.append("<tr><td><b>Description</b></td><td>"+a.description+"</td></tr>"),this.$el.append("<tr><td><b>Leader Name </b></td><td>"+b.firstName+" "+b.lastName+"</td></tr>"),this.$el.append("<tr><td><b>Leader Email </b></td><td>"+b.email+"</td></tr>"),this.$el.append("<tr><td><b>Leader Phone Number </b></td><td>"+b.phone+"</td></tr>"),this.$el.append("<tr><td><b>schedule</b></td><td>Date :  "+a.startDate+"-"+a.endDate+"<br>Time :  "+a.startTime+"- "+a.endTime+"</td></tr>"),this.$el.append("<tr><td><b>Location </b></td><td>"+a.location+"</td></tr>")}})}),$(function(){App.Views.GroupsSpans=Backbone.View.extend({tagName:"tr",addOne:function(a){var b=new App.Views.GroupSpan({model:a});b.render(),$("#cc").append(b.el)},addAll:function(){0!=this.collection.length?this.collection.each(this.addOne,this):$("#cc").append("<td class='course-box'>No Courses Accepted</td>")},render:function(){this.addAll()}})}),$(function(){App.Views.GroupsTable=Backbone.View.extend({tagName:"table",className:"btable btable-striped",roles:null,addOne:function(a){var b=new App.Views.GroupRow({model:a,roles:this.roles});b.courseId=this.courseId,b.render(),this.$el.append(b.el)},events:{"click .pageNumber":function(a){this.collection.startkey="",this.collection.skip=a.currentTarget.attributes[0].value,this.collection.fetch({async:!1}),this.collection.length>0&&this.render()}},addAll:function(){this.$el.html("<tr><th>Title</th><th colspan='0'>Actions</th></tr>");var a=new App.Models.Member({_id:$.cookie("Member._id")});a.fetch({async:!1}),this.roles=a.get("roles"),this.collection.each(this.addOne,this);var b,c=this;$.ajax({url:"/groups/_design/bell/_view/count?group=false",type:"GET",dataType:"json",success:function(a){if(b=a.rows[0].value,1!=c.displayCollec_Resources){for(var d="<tr><td colspan=7>",e=b/20,f=0;e>f;f++)d+=0==f?'<a  class="pageNumber" value="'+20*f+'">Home</a>&nbsp&nbsp':'<a  class="pageNumber" value="'+20*f+'">'+f+"</a>&nbsp&nbsp";d+="</td></tr>",c.$el.append(d)}}})},render:function(){this.collection.skip=0,this.addAll()}})}),$(function(){App.Views.InvitationForm=Backbone.View.extend({id:"invitationForm",events:{"click #formButton":"setForm","submit form":"setFormFromEnterKey","click #cancelButton":"hidediv"},title:null,entityId:null,type:null,senderId:null,hidediv:function(){$("#invitationdiv").fadeOut(1e3),document.getElementById("cont").style.opacity=1,document.getElementById("nav").style.opacity=1,setTimeout(function(){$("#invitationdiv").hide()},1e3)},SetParams:function(a,b,c,d){this.title=a,this.entityId=b,this.type=c,this.senderId=d},render:function(){console.log(this.model);var a=new App.Collections.Members,b=this,c=this;c.on("InvitationForm:MembersReady",function(){console.log(b.model.schema),this.model.schema.members.options=a,this.form=new Backbone.Form({model:c.model}),this.$el.append(this.form.render().el),this.form.fields.members.$el.hide(),this.form.fields.levels.$el.hide(),this.form.fields.invitationType.$el.change(function(){var a=b.form.fields.invitationType.$el.find("option:selected").text();"Members"==a?(b.form.fields.members.$el.show(),b.form.fields.levels.$el.hide()):"Level"==a?(b.form.fields.members.$el.hide(),b.form.fields.levels.$el.show()):(b.form.fields.members.$el.hide(),b.form.fields.levels.$el.hide())});var d=$('<a class="btn btn-success" id="formButton">Invite</button>');this.$el.append(d),this.$el.append("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"),this.$el.append('<a class="btn btn-danger" id="cancelButton">Cancel</button>')}),a.once("sync",function(){c.trigger("InvitationForm:MembersReady")}),a.fetch()},setFormFromEnterKey:function(a){a.preventDefault(),this.setForm()},setForm:function(){var a=new App.Models.Member({_id:$.cookie("Member._id")});a.fetch({async:!1}),this.form.commit();var b=new App.Collections.Members;b.fetch({async:!1});var c,d=this,e=new Date;"All"==this.model.get("invitationType")?b.each(function(a){c=new App.Models.Mail,c.set("senderId",d.model.senderId),c.set("receiverId",a.get("_id")),c.set("status","0"),c.set("subject","Course Invitation | "+d.model.title),c.set("type","course-invitation"),c.set("body",d.description+'<br/><br/><button class="btn btn-primary" id="invite-accept" value="'+d.model.resId+'" >Accept</button>&nbsp;&nbsp;<button class="btn btn-danger" id="invite-reject" value="'+d.model.resId+'" >Reject</button>'),c.set("sendDate",e),c.set("entityId",d.model.resId),c.save()}):"Members"==this.model.get("invitationType")?b.each(function(a){d.model.get("members").indexOf(a.get("_id"))>-1&&(c=new App.Models.Mail,c.set("senderId",d.model.senderId),c.set("receiverId",a.get("_id")),c.set("status","0"),c.set("subject","Course Invitation | "+d.model.title),c.set("body",d.description+'<br/><br/><button class="btn btn-primary" id="invite-accept" value="'+d.model.resId+'" >Accept</button>&nbsp;&nbsp;<button class="btn btn-danger" id="invite-reject" value="'+d.model.resId+'" >Reject</button>'),c.set("type","course-invitation"),c.set("sendDate",e),c.set("entityId",d.model.resId),c.save(),console.log(c))}):b.each(function(a){var b=a.get("levels");d.model.get("levels").indexOf(b[0])>-1&&(c=new App.Models.Mail,c.set("senderId",d.model.senderId),c.set("receiverId",a.get("_id")),c.set("status","0"),c.set("subject","Course Invitation | "+d.model.title),c.set("body",d.description+'<br/><br/><button class="btn btn-primary" id="invite-accept" value="'+d.model.resId+'" >Accept</button>&nbsp;&nbsp;<button class="btn btn-danger" id="invite-reject" value="'+d.model.resId+'" >Reject</button>'),c.set("type","course-invitation"),c.set("sendDate",e),c.set("entityId",d.model.resId),c.save())}),$("#invitationdiv").fadeOut(1e3),alert("Invitation sent successfully"),document.getElementById("cont").style.opacity=1,document.getElementById("nav").style.opacity=1,setTimeout(function(){$("#invitationdiv").hide()},1e3)}})}),$(function(){App.Views.LevelDetail=Backbone.View.extend({events:{"click .remover":function(a){var b=this,c=a.currentTarget.value,d=this.model.get("resourceTitles"),e=this.model.get("resourceId"),f=e.indexOf(c);e.splice(f,1),d.splice(f,1),this.model.set("resourceId",e),this.model.set("resourceTitles",d),this.model.save(null,{success:function(a,d){b.model.set("_rev",d.rev),$("#"+c.replace(".","\\.")).remove()}})},"click .removeAttachment":function(a){var b=this,c=a.currentTarget.value;$.ajax({url:"/coursestep/"+this.model.get("_id")+"/"+_.keys(this.model.get("_attachments"))[c]+"?rev="+this.model.get("_rev"),type:"DELETE",success:function(a,c,d){alert("Successfully deleted."),App.Router.ViewLevel(b.model.get("_id"),b.model.get("_rev"))}})},"click .levelResView":function(a){var b=a.currentTarget.attributes[0].value,c=this.model.get("_id"),d=this.model.get("_rev");Backbone.history.navigate("resource/atlevel/feedback/"+b+"/"+c+"/"+d,{trigger:!0})},"click #addInstructions":function(a){var b=document.forms.fileAttachment._attachments;b.click()},"change #_attachments":function(a){var b=this,c=$('input[type="file"]'),d=c.val().split(".");return""!=c.val()&&"doc"!=d[d.length-1]&&"pdf"!=d[d.length-1]&&"mp4"!=d[d.length-1]&&"ppt"!=d[d.length-1]&&"docx"!=d[d.length-1]&&"pptx"!=d[d.length-1]&&"jpg"!=d[d.length-1]&&"jpeg"!=d[d.length-1]&&"png"!=d[d.length-1]&&"mp4"!=d[d.length-1]&&"mov"!=d[d.length-1]&&"mp3"!=d[d.length-1]?void alert("Invalid attatchment."):($('input[type="file"]').val()?this.model.saveAttachment("form#fileAttachment","form#fileAttachment #_attachments","form#fileAttachment .rev"):alert("no attachment"),void this.model.on("savedAttachment",function(){alert("Assignement successfully submitted."),App.Router.ViewLevel(b.model.get("_id"),b.model.get("_rev"))},this.model))}},render:function(){var a=0,b=this.model.get("resourceTitles"),c=this.model.get("resourceId"),d='</BR><table class="table table-striped">';if(this.model.get("resourceTitles")){for(a=0;a<this.model.get("resourceTitles").length;a++){var e=new App.Models.Resource({_id:c[a]});e.fetch({async:!1}),e.get("hidden")||(d+=e.get("_attachments")?"<tr id='"+c[a]+"'><td>"+b[a]+"</td><td><a class='levelResView btn btn-info' href='/apps/_design/bell/bell-resource-router/index.html#open/"+c[a]+"'  target='_blank' value='"+c[a]+"'><i class='icon-eye-open'></i>View</a></td><td><button class='remover btn btn-danger' value='"+c[a]+"'>Remove </button><input type='hidden' id='"+c[a]+"' value='"+b[a]+"'/>":"<tr id='"+c[a]+"'><td>"+b[a]+"</td><td>No Attachment</td><td><button class='remover btn btn-danger' value='"+c[a]+"'>Remove </button><input type='hidden' id='"+c[a]+"' value='"+b[a]+"'/>")}d+="</table>",this.$el.append(d),this.$el.append('<br/><br/><B>Instructions</B>&nbsp;&nbsp;<a class="btn btn-success"  style="" id="addInstructions">Add</a><br/><br/>');var f='<form method="post" id="fileAttachment">';if(f+='<input type="file" name="_attachments" id="_attachments" multiple="multiple" style="display: none" /> ',f+='<input class="rev" type="hidden" name="_rev"></form>',this.$el.append(f),!this.model.get("_attachments"))return;var g='<table class="table table-striped">';for(a=0;a<_.keys(this.model.get("_attachments")).length;a++){var h="/coursestep/"+this.model.get("_id")+"/",i="";"undefined"!=typeof this.model.get("_attachments")&&(h+=_.keys(this.model.get("_attachments"))[a],i=_.keys(this.model.get("_attachments"))[a]),g+="<tr><td>"+i+"</td><td><a class='btn btn-info' href='"+h+"'  target='_blank' ><i class='icon-eye-open'></i>View</a></td><td><button class='removeAttachment btn btn-danger' value='"+a+"'>Remove </button><input type='hidden'/>"}g+="</table>",this.$el.append(g)}}})}),$(function(){App.Views.LevelForm=Backbone.View.extend({className:"form",events:{"click #formButton":"setForm","submit form":"setFormFromEnterKey","click #retrunBack":function(a){history.back()},"click #addresources":function(a){this.addResource=!0,this.setForm()}},render:function(){var a=this;this.form=new Backbone.Form({model:a.model}),this.$el.append(this.form.render().el),this.form.fields.courseId.$el.hide(),this.form.fields.questions.$el.hide(),this.form.fields.qoptions.$el.hide(),this.form.fields.answers.$el.hide(),this.form.fields.resourceId.$el.hide(),this.form.fields.resourceTitles.$el.hide();var b='<a class="btn btn-success" id="retrunBack"> Back </button>';b+='<a class="btn btn-success" id="formButton">Save</button>',b+='<a class="btn btn-success" id="addresources">Add Resource</button>',this.$el.append(b)},setFormFromEnterKey:function(a){a.preventDefault(),this.setForm()},setForm:function(){var a=this;this.model.once("sync",function(){var b=a.model.get("id"),c=a.model.get("rev");a.model.get("title");if(console.log(a.model),1!=a.edit){var d=new App.Collections.StepResultsbyCourse;d.courseId=a.model.get("courseId"),d.fetch({success:function(){d.each(function(b){var c=b.get("stepsIds"),d=b.get("stepsResult"),e=b.get("stepsStatus");c.push(a.model.get("id")),d.push("0"),e.push("0"),b.set("stepsIds",c),b.set("stepsResult",d),b.set("stepsStatus",e),b.save()})}}),a.addResource?window.location.href="#search-bell/"+b+"/"+c:Backbone.history.navigate("course/manage/"+a.model.get("courseId"),{trigger:!0})}else Backbone.history.navigate("level/view/"+b+"/"+c,{trigger:!0})}),this.form.commit(),isNaN(this.model.get("allowedErrors"))?alert("Not a valid Allowed Errors"):isNaN(this.model.get("step"))?alert("Not a valid Step Number"):(this.edit?(this.model.set("questions",this.ques),this.model.set("answers",this.ans),this.model.set("qoptions",this.opt),this.model.set("resourceId",this.res),this.model.set("resourceTitles",this.rest)):(this.model.set("questions",null),this.model.set("answers",null),this.model.set("qoptions",null),this.model.set("resourceId",[]),this.model.set("resourceTitles",[])),levels=new App.Collections.CourseLevels,levels.groupId=this.model.get("courseId"),levels.fetch({success:function(){levels.sort();var b=!0;a.edit?a.previousStep!=a.model.get("step")&&levels.each(function(c){c.get("step")==a.model.get("step")&&(b=!1)}):levels.each(function(c){c.get("step")==a.model.get("step")&&(b=!1)}),b?a.model.save():alert("Step already exists")}}))}})}),$(function(){App.Views.LevelRow=Backbone.View.extend({tagName:"tr",events:{"click .destroyStep":function(a){this.trigger("levelDeleted"),a.preventDefault();var b=this,c=new App.Collections.StepResultsbyCourse;c.courseId=this.model.get("courseId"),c.fetch({success:function(){c.each(function(a){var c=a.get("stepsIds"),d=a.get("stepsResult"),e=a.get("stepsStatus"),f=c.indexOf(b.model.get("_id"));c.splice(f,1),d.splice(f,1),e.splice(f,1),a.set("stepsIds",c),a.set("stepsResult",d),a.set("stepsStatus",e),console.log(a.toJSON()),a.save({success:function(){console.log("Model Updated")}})})}}),this.model.destroy(),this.remove()},"click .browse":function(a){a.preventDefault(),$("#modal").modal({show:!0})}},template:$("#template-LevelRow").html(),initialize:function(){},render:function(){var a=this.model.toJSON();this.$el.append(_.template(this.template,a))}})}),$(function(){App.Views.LevelsTable=Backbone.View.extend({tagName:"table",changedSteps:null,className:"btable btable-striped",events:{"click #Rearrange":function(a){if($("input[type='radio']").is(":visible")){$("#Rearrange").text("Rearrange");for(var b=0;b<this.changedSteps.length;b++)this.collection.models[this.changedSteps[b]].save();this.changedSteps.remove,$("input[type='radio']").hide(),$("#moveup").hide(),$("#movedown").hide()}else $("#Rearrange").text("Save"),$("input[type='radio']").show(),$("#moveup").show(),$("#movedown").show()},"click #moveup":function(a){for(var b,c=document.getElementsByName("stepRow"),d=0;d<c.length;d++)if(c[d].checked){if(b=c[d].parentNode.parentNode,d>0){this.collection.models[d].set("step",d),this.collection.models[d-1].set("step",d+1),this.changeColumnHtml(this.collection.models[d].get("step"),this.collection.models[d].get("title"),c[d].parentNode,!0),this.changeColumnHtml(this.collection.models[d-1].get("step"),this.collection.models[d-1].get("title"),c[d-1].parentNode,!1);var e=this.collection.models[d];this.collection.models[d]=this.collection.models[d-1],this.collection.models[d-1]=e,-1==this.changedSteps.indexOf(d)&&this.changedSteps.push(d),-1==this.changedSteps.indexOf(d-1)&&this.changedSteps.push(d-1)}break}var f=b.previousSibling,g=b.parentNode;f&&(g.removeChild(b),g.insertBefore(b,f))},"click #movedown":function(a){for(var b,c=document.getElementsByName("stepRow"),d=0;d<c.length;d++)if(c[d].checked){if(b=c[d].parentNode.parentNode,d<c.length-1){
this.collection.models[d].set("step",d+2),this.collection.models[d+1].set("step",d+1),this.changeColumnHtml(this.collection.models[d].get("step"),this.collection.models[d].get("title"),c[d].parentNode,!0),this.changeColumnHtml(this.collection.models[d+1].get("step"),this.collection.models[d+1].get("title"),c[d+1].parentNode,!1);var e=this.collection.models[d];this.collection.models[d]=this.collection.models[d+1],this.collection.models[d+1]=e,-1==this.changedSteps.indexOf(d)&&this.changedSteps.push(d),-1==this.changedSteps.indexOf(d+1)&&this.changedSteps.push(d+1)}break}var f=b.nextSibling,g=b.parentNode;f.nextSibling?(g.removeChild(b),g.insertBefore(b,f.nextSibling)):(g.removeChild(b),g.appendChild(b)),console.log(this.collection.models)}},changeColumnHtml:function(a,b,c,d){d?$(c).html('<input type="radio" name="stepRow" checked="checked" />&nbsp;&nbsp;Step '+a+" : "+b):$(c).html('<input type="radio" name="stepRow" />&nbsp;&nbsp;Step '+a+" : "+b)},addOne:function(a){var b=this,c=new App.Views.LevelRow({model:a});c.on("levelDeleted",function(){for(var a=c.model.get("step"),d=a;d<b.collection.models.length;d++)b.collection.models[d].set("step",d),b.updateModel(b.collection.models[d]);alert("Step successfully deleted."),b.collection.models.splice(a-1,1),0==b.collection.models.length&&($("#moveup").hide(),$("#movedown").hide(),$("#Rearrange").hide()),$("#addstep").attr("onClick","document.location.href='#level/add/"+b.groupId+"/nolevel/"+b.collection.models.length+"' "),location.reload()}),c.render(),this.$el.append(c.el)},updateModel:function(a){a.save({success:function(){}})},addAll:function(){this.collection.each(this.addOne,this)},initialize:function(){this.changedSteps=new Array},render:function(){this.$el.append('<br/><button class="btn btn-success" id="addstep"  onclick = "document.location.href=\'#level/add/'+this.groupId+"/nolevel/"+this.collection.models.length+"' \">Add Step</button>"),this.collection.models.length>0&&this.$el.append('&nbsp;&nbsp;&nbsp;<button class="btn btn-success" id="Rearrange" >Rearrange</button><br/><br/>'),this.$el.append('<button class="btn btn-success" id="moveup" >Up</button>&nbsp;&nbsp;&nbsp;'),this.$el.append('<button class="btn btn-success" id="movedown" >Down</button>'),this.addAll()}})}),$(function(){App.Views.ListCollectionView=Backbone.View.extend({id:"invitationForm",events:{"click #formButton":"setForm","submit form":"setFormFromEnterKey","click #cancelButton":"hidediv","click #deleteButton":"deleteRecord","click #invitationForm .bbf-form .field-IsMajor input":"nesttedHideShow"},nesttedHideShow:function(a){$("#invitationForm .bbf-form .field-IsMajor input").is(":checked")?$("#invitationForm .bbf-form .field-NesttedUnder").css("visibility","hidden"):$("#invitationForm .bbf-form .field-NesttedUnder").css("visibility","visible")},hidediv:function(){$("#invitationdiv").fadeOut(1e3),document.getElementById("cont").style.opacity=1,document.getElementById("nav").style.opacity=1,setTimeout(function(){$("#invitationdiv").hide()},1e3)},deleteCollectionNameFromResources:function(a){$.ajax({url:'/resources/_design/bell/_view/resourceOnTag?_include_docs=true&key="'+a+'"',type:"GET",dataType:"json",success:function(b){for(var c=b.rows,d=[],e=0;e<c.length;e++){if(c[e].value.Tag.length>0){var f=c[e].value.Tag.indexOf(a);f>-1&&c[e].value.Tag.splice(f,1)}d.push(c[e].value)}$.couch.db("resources").bulkSave({docs:d},{success:function(a){alert("Successfully pushed resources back")}})},async:!1})},deleteRecord:function(){$(".form .field-Tag select option[value="+this.model.get("_id")+"]").remove(),$("#"+this.model.get("_id")).parent("tr").remove(),this.deleteCollectionNameFromResources(this.model.get("_id")),this.model.set({show:!1}),this.model.save({success:location.reload()})},render:function(){var a=this;this.form=new Backbone.Form({model:a.model}),this.$el.append(this.form.render().el);var b=$('<a class="btn btn-success" id="formButton">Save</button>');this.$el.append(b),this.$el.append("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"),this.$el.append('<a class="btn btn-warning" id="cancelButton">Cancel</button>'),void 0!=this.model.get("_id")&&(this.$el.append("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"),this.$el.append('<a class="btn btn-danger" id="deleteButton">Delete</button>'))},setFormFromEnterKey:function(a){a.preventDefault(),this.setForm()},setForm:function(){this.form.commit();var a=this.model.get("CollectionName"),b=!1,c=new App.Collections.listRCollection;if(c.fetch({async:!1}),c.each(function(c){1==c.get("show")&&a==c.get("CollectionName")&&(b=!0)}),b)alert("Collection Name already exist"),$("#invitationdiv").fadeOut(1e3),document.getElementById("cont").style.opacity=1,document.getElementById("nav").style.opacity=1;else if("--Select--"!=this.model.get("NesttedUnder")?this.model.set({IsMajor:!1}):this.model.set({IsMajor:!0}),this.model.get("CollectionName").length>0){var d=this;this.model.save(null,{success:function(a){alert("Collection Saved Successfully"),void 0==d.model.get("_id")?("--Select--"==d.model.get("NesttedUnder")?1==d.model.get("IsMajor")?$(".form .field-Tag select").append('<option class="MajorCategory" value="'+d.model.get("id")+'">'+d.model.get("CollectionName")+"</option>"):$(".form .field-Tag select").append('<option value="'+d.model.get("id")+'">'+d.model.get("CollectionName")+"</option>"):null!=$(".form .field-Tag select option[value="+d.model.get("NesttedUnder")+"]")&&$(".form .field-Tag select option[value="+d.model.get("NesttedUnder")+"]").after('<option  value="'+d.model.get("id")+'">'+d.model.get("CollectionName")+"</option>"),$("#invitationdiv").fadeOut(1e3),document.getElementById("cont").style.opacity=1,document.getElementById("nav").style.opacity=1,setTimeout(function(){$("#invitationdiv").hide()},1e3),$(".form .field-Tag select").multiselect("refresh")):location.reload()}})}else alert("Enter collection name!")}})}),$(function(){App.Views.LogQuery=Backbone.View.extend({events:{"click #report_button":function(a){var b="Open BeLL";$("#community-select").val()&&(b=$("#community-select").val()),$("#start-date").val()&&$("#end-date").val()?(console.log("community: "+$("#community-select").val()+"	Start-Date: "+$("#start-date").val()+"    End-Date: "+$("#end-date").val()),App.Router.LogActivity(b,$("#start-date").val(),$("#end-date").val())):console.log("At least one of the criteria for report is missing")}},template:$("#template-LogQuery").html(),initialize:function(){},render:function(){this.$el.html(_.template(this.template))}})}),$(function(){App.Views.MailView=Backbone.View.extend({code:null,vars:{},recordsPerPage:null,modelNo:null,nextButton:null,unopen:null,searchText:null,resultArray:null,inViewModel:null,showNextButton:null,template:_.template($("#template-mail").html()),templateMailView:_.template($("#template-view-mail").html()),events:{"click #replyMailButton":function(a){$("#recipients").val(this.vars.login),$("#subject").val("Re : "+this.vars.subject),$("#mailbodytexarea").val("")},"click #mailComposeButton":function(a){$("#subject").val(""),$("#recipients").val(""),$("#mailbodytexarea").val("")},"click #nextButton":function(a){this.modelNo=0,this.resultArray=[],skipStack.push(skip),this.fetchRecords()},"click #all-mails":function(a){this.modelNo=0,skip=0,this.searchText="",$("#search-text").val(""),this.resultArray=[],this.unopen=!1,this.fetchRecords(),$("#nextButton").show(),$("#previousButton").hide()},"click #unread-mails":"unReadMails","click #backpage":function(a){this.render(),this.unReadMails()},"click .deleteBtn":function(a){var b=a.currentTarget.value;alert(b);var c=this.collection.at(b),d=new App.Models.Mail;d.id=c.get("id"),d.fetch({async:!1}),d.destroy(),this.render(),this.unReadMails()},"click #previousButton":function(a){skipStack.length>1?(skipStack.pop(),skip=skipStack.pop(),skipStack.push(skip),this.resultArray=[],this.modelNo=0,this.showNextButton=1,this.fetchRecords()):$("#previousButton").hide()},"click #invite-accept":function(a){if("admissionRequest"==mailView.inViewModel.get("type"))return void mailView.admissionRequestAccepted(a.currentTarget.value);var b=mailView.inViewModel.get("body").replace(/<(?:.|\n)*?>/gm,"");b=b.replace("Accept","").replace("Reject","").replace("&nbsp;&nbsp;","");var c=b+"<div style='margin-left: 3%;margin-top: 174px;font-size: 11px;color: rgb(204,204,204);'>this Course Was Full.</div>";if(b+="<div style='margin-left: 3%;margin-top: 174px;font-size: 11px;color: rgb(204,204,204);'>You have accepted this invitation.</div>","Meetup-invitation"==mailView.inViewModel.get("type"))return mailView.meetupRequestAccepted(a.currentTarget.value),void mailView.updateMailBody(b);var d=new App.Models.Group({_id:a.currentTarget.value});d.fetch({async:!1});var e=d.get("members").length;if(d.get("memberLimit")&&d.get("memberLimit")<e)return alert("This Course is full"),void mailView.updateMailBody(c);if(mailView.updateMailBody(b),d.get("_id")){var f=[];null!=d.get("members")&&(f=d.get("members")),-1==f.indexOf($.cookie("Member._id"))?(f.push($.cookie("Member._id")),d.set("members",f),d.save({},{success:function(){var a=new App.Models.membercourseprogress,b=new App.Collections.coursesteps,c=new Array,e=new Array,f=new Array;b.courseId=d.get("_id"),b.fetch({success:function(){b.each(function(a){c.push(a.get("_id")),e.push("0"),f.push("0")}),a.set("stepsIds",c),a.set("memberId",$.cookie("Member._id")),a.set("stepsResult",e),a.set("stepsStatus",f),a.set("courseId",b.courseId),a.save({success:function(){}})}}),alert("Course added to your dashboard"),Backbone.history.navigate("dashboard",{trigger:!0})}})):(alert("Course already added to your dashboard"),Backbone.history.navigate("dashboard",{trigger:!0}))}},"click #invite-reject":function(a){if("admissionRequest"==mailView.inViewModel.get("type"))return void mailView.admissoinRequestRejected(a.currentTarget.value);var b=mailView.inViewModel.get("body").replace(/<(?:.|\n)*?>/gm,"");b=b.replace("Accept","").replace("Reject","").replace("&nbsp;&nbsp;",""),b+="<div style='margin-left: 3%;margin-top: 174px;font-size: 11px;color: rgb(204,204,204);'>You have rejected this invitation.</div>",mailView.updateMailBody(b)},"click #search-mail":function(a){for(skip=0;skipStack.length>0;)skipStack.pop();this.searchText=$("#search-text").val(),this.resultArray=[],skipStack.push(skip),this.modelNo=0,this.fetchRecords()},"click #back":function(a){for(skip=0;skipStack.length>0;)skipStack.pop();this.resultArray=[],skipStack.push(skip),this.modelNo=0,this.render(),this.fetchRecords()}},unReadMails:function(a){this.modelNo=0,skip=0,this.searchText="",$("#search-text").val(""),this.resultArray=[],this.unopen=!0,this.fetchRecords(),$("#nextButton").show(),$("#previousButton").hide()},renderAllMails:function(a){mailView.modelNo=0,skip=0,this.searchText="",mailView.resultArray=[],mailView.unopen=!1,mailView.fetchRecords(),$("#nextButton").show(),$("#previousButton").hide()},viewButton:function(a){var b=a.currentTarget.value,c=mailView.collection.at(b),d="/mail/"+c.get("_id")+"/",e="";"undefined"!=typeof c.get("_attachments")&&(d+=_.keys(c.get("_attachments"))[0],e=_.keys(c.get("_attachments"))[0]),mailView.inViewModel=c,c.set("status","1"),console.log(a),c.save(),mailView.vars=c.toJSON();var f=new App.Models.Member;f.id=c.get("senderId"),f.fetch({async:!1}),mailView.vars.firstName=f.get("firstName"),mailView.vars.lastName=f.get("lastName"),mailView.vars.email=f.get("login")+"."+mailView.code+mailView.nationName.substring(3,5)+"@olebell.org",mailView.vars.modelNo=b,mailView.vars.login=mailView.vars.email,""!=e?(mailView.vars.isAttachment=1,mailView.vars.attchmentURL=d):mailView.vars.isAttachment=0,mailView.$el.html(""),mailView.$el.append(mailView.templateMailView(mailView.vars))},deleteButton:function(a){var b=a.currentTarget.value,c=mailView.collection.at(b);c.destroy(),mailView.renderAllMails()},initialize:function(a){this.code=a.community_code,this.nationName=a.nationName,this.modelNo=0,skip=0,this.unopen=!0,this.recordsPerPage=5,this.nextButton=1,this.searchText="",this.delegateEvents(),this.resultArray=[],this.showNextButton=0},addOne:function(a){vars=a.toJSON();var b=new App.Models.Member;if(b.set("id",a.get("senderId")),b.id=a.get("senderId"),b.fetch({async:!1}),void 0==b.id)var c="Error!!";else var c=b.get("firstName")+" "+b.get("lastName");if(vars.subject){var d="";d=0==vars.status?'<tr bgcolor="B4D3EC" style="color:black">':'<tr bgcolor="E7E7E7" style="color:#2D2D34">';var e="delete"+this.modelNo,f="view"+this.modelNo;d=d+"<td>"+vars.subject+'</td><td align="center">'+c+'</td><td align="right"><button value="'+this.modelNo+'" id ="'+e+'" class="btn btn-danger">Delete</button>&nbsp;&nbsp;<button value="'+this.modelNo+'" id="'+f+'" class="btn btn-primary" >View</button></td></tr>',$("#inbox_mails").append(d),this.modelNo++,$("#"+e).click(this.deleteButton),$("#"+f).click(this.viewButton),mailView=this}},addAll:function(){$("#inbox_mails").html(""),skipStack.length<=1?$("#previousButton").hide():$("#previousButton").show(),this.collection.forEach(this.addOne,this)},render:function(){this.$el.html(this.template(this.vars)),this.$el.append('<div class="mail-table"><span style="float:right; margin-left:10px;"><button id="nextButton" class="btn btn-primary fui-arrow-right"></button></span> <span style="float:right;"><button id="previousButton" class="btn btn-primary fui-arrow-left"></button></span></div>')},fetchRecords:function(){var a=this,b=new App.Collections.Mails({receiverId:$.cookie("Member._id"),unread:a.unopen});b.fetch({success:function(){if(a.resultArray.push.apply(a.resultArray,a.searchInArray(b.models,a.searchText)),a.resultArray.length!=limitofRecords&&b.models.length==limitofRecords)return void a.fetchRecords();if(0==a.resultArray.length&&skipStack.length>1)return $("#nextButton").hide(),void skipStack.pop();if(0==a.resultArray.length&&1==skipStack.length)return void $("#errorMessage").show();var c=new App.Collections.Mails;a.resultArray.length>0&&($("#errorMessage").hide(),c.set(a.resultArray),a.collection=c,a.addAll(),1==a.showNextButton&&($("#nextButton").show(),a.showNextButton=0))}})},searchInArray:function(a,b){var c=[];return _.each(a,function(a){null!=a.get("subject")&&null!=a.get("body")&&(skip++,a.get("subject").toLowerCase().indexOf(b.toLowerCase())>=0||a.get("body").toLowerCase().indexOf(b.toLowerCase())>=0?c.length<limitofRecords?c.push(a):(console.log("first"),skip--):c.length>=limitofRecords&&(console.log("second"),skip--))}),c},admissionRequestAccepted:function(a){var b=new App.Models.Group;b.id=a,b.fetch({async:!1});var c=mailView.inViewModel.get("senderId");b.get("members").push(c),b.save(null,{success:function(a,b){var d=new App.Models.membercourseprogress,e=new App.Collections.coursesteps,f=new Array,g=new Array,h=new Array;e.courseId=b.id,e.fetch({success:function(){e.each(function(a){f.push(a.get("_id")),g.push("0"),h.push("0")}),d.set("stepsIds",f),d.set("memberId",c),d.set("stepsResult",g),d.set("stepsStatus",h),d.set("courseId",e.courseId),d.save({success:function(){alert("saved")}})}})}});var d=mailView.inViewModel.get("body").replace(/<(?:.|\n)*?>/gm,"");d='Admission request received from user "a" has been Accepted<br>',d+="<div style='margin-left: 3%;margin-top: 174px;font-size: 11px;color: rgb(204,204,204);'>You have accepted this request.</div>",mailView.inViewModel.save();var e=new Date,f=new App.Models.Mail;f.set("senderId",$.cookie("Member._id")),f.set("receiverId",mailView.inViewModel.get("senderId")),f.set("subject","Admission Request Accepted | "+b.get("name")),f.set("body",'Your admission request for "'+b.get("name")+'" has been accepted by the course leader.'),f.set("status","0"),f.set("type","mail"),f.set("sentDate",e),f.save(),mailView.updateMailBody(d)},admissoinRequestRejected:function(a){var b=new App.Models.Group;b.id=a,b.fetch({async:!1});var c=mailView.inViewModel.get("body").replace(/<(?:.|\n)*?>/gm,"");c='Admission request received from user "a" has been Rejected<br>',c+="<div style='margin-left: 3%;margin-top: 174px;font-size: 11px;color: rgb(204,204,204);'>You have rejected this request.</div>";var d=new Date,e=new App.Models.Mail;e.set("senderId",$.cookie("Member._id")),e.set("receiverId",mailView.inViewModel.get("senderId")),e.set("subject","Admission Request Rejected | "+a.get("name")),e.set("body",'Your admission request for "'+a.get("name")+'" has been rejected by the course leader.'),e.set("status","0"),e.set("type","mail"),e.set("sentDate",d),e.save(),mailView.updateMailBody(c)},meetupRequestAccepted:function(a){var b=new App.Collections.UserMeetups;if(b.memberId=$.cookie("Member._id"),b.meetupId=a,b.fetch({async:!1}),b.length>0)return void alert("Your have already joined this Meetup");var c=new App.Models.MeetUp;if(c.id=a,c.fetch({async:!1}),console.log(c),!c.get("title"))return void alert("Meetup No more Exist");var d=new App.Models.UserMeetup;d.set({memberId:$.cookie("Member._id"),meetupId:a,meetupTitle:c.get("title")}),d.save(),alert("Successfully Joined")},updateMailBody:function(a){var b=new App.Models.Mail;b.id=mailView.inViewModel.get("id"),b.fetch({async:!1}),b.set("body",a),b.save(),$("#mail-body").html("<br/>"+a)}})}),$(function(){App.Views.ManageCommunity=Backbone.View.extend({events:{"click .SyncDbSelect":"SyncDbSelect","click #configuration":"Configuration","click .back":function(a){alert("back")}},initialize:function(){this.$el.append('<th colspan="2"><h6>Meetup Detail</h6></th>')},processJsonp:function(){alert()},render:function(){this.$el.html(""),nName=App.configuration.get("nationName"),pass=App.password,nUrl=App.configuration.get("nationUrl"),currentBellName=App.configuration.get("name");this.$el;this.$el.append('<div style="padding: 20px 20px 0px 20px; float: left;"> <a id="configuration"><button class="btn btn-primary" id="configbutton">Configurations</button></a> </div>'),this.$el.append('<div style="padding: 20px 20px 0px 0px; float: left;"> <button class="SyncDbSelect btn btn-primary" id="sync">Sync With Nation</button>  </div>'),this.$el.append('<div style="padding: 20px 20px 0px 0px; float: left;"> <a class="btn btn-primary" href="#publications/for-'+App.configuration.get("name")+'">Publications</a>  </div>')},syncDbs:function(a){alert("this is sync db function in community manage")},SyncDbSelect:function(){$("#invitationdiv").fadeIn(1e3);var a=new App.Views.listSyncDbView;a.render(),$("#invitationdiv").html("&nbsp"),$("#invitationdiv").append(a.el)},Configuration:function(){var a=new App.Collections.Configurations;a.fetch({async:!1});var b=a.first(),c=new App.Views.Configurations({model:b});c.render(),this.$el.html(c.el)}})}),$(function(){App.Views.MeetUpForm=Backbone.View.extend({className:"form",id:"meetUpForm",prevmemlist:null,saved:null,btnText:"Save",events:{"click #MeetUpformButton":"setForm","submit form":"setFormFromEnterKey","click #InviteMembers":"MemberInvite","click #MeetUpcancel":function(){window.history.back()}},MemberInvite:function(){var a=this.model;if(console.log(a),!a.get("id"))return void this.setForm();if($("textarea[name='description']").val().length>0){$("#invitationdiv").fadeIn(1e3),document.getElementById("cont").style.opacity=.1,document.getElementById("nav").style.opacity=.1,$("#invitationdiv").show();var b=new App.Models.InviMeetup;b.resId=a.get("id"),b.senderId=$.cookie("Member._id"),b.type=a.get("kind"),b.title=a.get("title"),b.description=a.get("description");var c=new App.Views.MeetupInvitation({model:b});c.render(),$("#invitationdiv").html("&nbsp"),$("#invitationdiv").append(c.el)}else alert("Specify Meetup description first")},render:function(){$("#invitationdiv").hide(),this.model.get("_id")?(this.$el.append("<h3>Edit Meetup | "+this.model.get("title")+"</h3>"),this.btnText="Update"):this.$el.append("<h3>Start a New Meetup</h3>"),this.form=new Backbone.Form({model:this.model}),this.$el.append(this.form.render().el),"Update"!=this.btnText&&this.form.fields.Day.$el.hide();var a=$('<a class="btn btn-success" id="MeetUpformButton">'+this.btnText+"</a>");$('<a class="btn btn-success" id="formButton">Cancel</a>');this.$el.append(a),"Update"!=this.btnText&&this.$el.append('<a class="btn btn-info" id="InviteMembers">Invite Members</a>'),this.$el.append("<a class='btn btn-danger' id='MeetUpcancel'>Cancel</a>"),console.log(this.model)},setFormFromEnterKey:function(a){a.preventDefault(),this.setForm()},setForm:function(){if(this.model.get("id"))return void alert("Saved already");var a=this;this.form.commit(),0==this.model.get("title").length?alert("Meetup title is missing"):0==this.model.get("description").length?alert("Meetup Description is missing"):0==this.model.get("meetupLocation").length?alert("Meetup Location is missing"):(this.model.set("creator",$.cookie("Member._id")),this.model.save(null,{success:function(b){if("Save"==a.btnText){var c=new App.Models.UserMeetup;c.set({memberId:$.cookie("Member._id"),meetupId:b.get("id"),meetupTitle:b.get("title")}),c.save(),a.MemberInvite(b)}else{var c=new App.Collections.UserMeetups;c.meetupId=b.get("id"),c.memberId=$.cookie("Member._id"),c.fetch({async:!1}),(res=c.first())&&(res.set("meetupTitle",b.get("title")),res.save(),alert("Updated Successfully")),Backbone.history.navigate("meetups",{trigger:!0})}}}))}})}),$(function(){App.Views.MeetUpRow=Backbone.View.extend({tagName:"tr",roles:null,events:{},template:$("#template-MeetUpRow").html(),initialize:function(a){this.roles=a.roles},render:function(){var a=this.model.toJSON();-1!=this.roles.indexOf("Manager")?a.isAdmin=1:a.isAdmin=0,a.creator&&a.creator==$.cookie("Member._id")?a.creator=1:a.creator=0,"_design/bell"!=a._id&&this.$el.append(_.template(this.template,a))}})}),$(function(){App.Views.MeetUpTable=Backbone.View.extend({tagName:"table",className:"btable btable-striped",roles:null,addOne:function(a){var b=new App.Views.MeetUpRow({model:a,roles:this.roles});b.render(),this.$el.append(b.el)},events:{"click .pageNumber":function(a){this.collection.startkey="",this.collection.skip=a.currentTarget.attributes[0].value,this.collection.fetch({async:!1}),this.collection.length>0&&this.render()}},addAll:function(){this.$el.html("<tr><th>Topic</th><th colspan='4'>Actions</th></tr>");var a=new App.Models.Member({_id:$.cookie("Member._id")});a.fetch({async:!1}),this.roles=a.get("roles"),this.collection.each(this.addOne,this);var b=this;$.ajax({url:"/meetups/_design/bell/_view/count?group=false",type:"GET",dataType:"json",success:function(a){if(meetupLength=a.rows[0].value,1!=b.displayCollec_Resources){for(var c="<tr><td colspan=7>",d=meetupLength/20,e=0;d>e;e++)c+=0==e?'<a  class="pageNumber" value="'+20*e+'">Home</a>&nbsp&nbsp':'<a  class="pageNumber" value="'+20*e+'">'+e+"</a>&nbsp&nbsp";c+="</td></tr>",b.$el.append(c)}}})},render:function(){this.addAll()}})}),$(function(){App.Views.MeetupDetails=Backbone.View.extend({authorName:null,tagName:"table",className:"table table-striped resourceDetail",sid:null,rid:null,events:{"click #DestroyMeetupItem":function(a){var b=this.model.toJSON(),c=$.cookie("Member._id"),d=new App.Collections.UserMeetups;d.memberId=c,d.meetupId=b._id,d.fetch({async:!1});for(var e;e=d.first();)e.destroy();alert("Successfully removed from My Meetups "),Backbone.history.navigate("dashboard",{trigger:!0})}},initialize:function(){this.$el.append('<th colspan="2"><h6>Meetup Detail</h6></th>')},render:function(){var a=this.model.toJSON(),b=new Date(a.schedule);a.schedule=b.toUTCString(),console.log(a),this.$el.append("<tr><td><b>Title  </b></td><td>"+a.title+"   ("+a.category+")</td></tr>"),this.$el.append("<tr><td><b>Category  </b></td><td>"+a.category+"</td></tr>"),this.$el.append("<tr><td><b>Description </b></td><td>"+a.description+"</td></tr>"),this.$el.append("<tr><td><b>Location </b></td><td>"+a.meetupLocation+"</td></tr>"),this.$el.append("<tr><td><b>Date </b></td><td>"+a.startDate+" --- "+a.endDate+"</td></tr>"),this.$el.append("<tr><td><b>Time </b></td><td>"+a.startTime+" --- "+a.endTime+"</td></tr>"),this.$el.append('<tr><td colspan="2"><button class="btn btn-danger" id="DestroyMeetupItem">Unjoin</button></td></tr>')}})}),$(function(){App.Views.MeetupInvitation=Backbone.View.extend({id:"invitationForm",events:{"click #formButton":"setForm","submit form":"setFormFromEnterKey","click #cancelButton":"hidediv"},title:null,entityId:null,type:null,senderId:null,hidediv:function(){$("#invitationdiv").fadeOut(1e3),document.getElementById("cont").style.opacity=1,document.getElementById("nav").style.opacity=1,setTimeout(function(){$("#invitationdiv").hide()},1e3),Backbone.history.navigate("meetups",{trigger:!0})},SetParams:function(a,b,c,d){this.title=a,this.entityId=b,this.type=c,this.senderId=d},render:function(){console.log(this.model);var a=new App.Collections.Members,b=this,c=this;c.on("InvitationForm:MembersReady",function(){console.log(b.model.schema),this.model.schema.members.options=a,this.form=new Backbone.Form({model:c.model}),this.$el.append(this.form.render().el),this.form.fields.members.$el.hide(),this.form.fields.invitationType.$el.change(function(){var a=b.form.fields.invitationType.$el.find("option:selected").text();"Members"==a?b.form.fields.members.$el.show():b.form.fields.members.$el.hide()});var d=$('<a class="btn btn-success" id="formButton">Invite</button>');this.$el.append(d),this.$el.append("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"),this.$el.append('<a class="btn btn-danger" id="cancelButton">Cancel</button>')}),a.once("sync",function(){c.trigger("InvitationForm:MembersReady")}),a.fetch()},setFormFromEnterKey:function(a){a.preventDefault(),this.setForm()},setForm:function(){var a=new App.Models.Member({_id:$.cookie("Member._id")});a.fetch({async:!1}),this.form.commit();var b=new App.Collections.Members;b.fetch({async:!1});var c,d=this,e=new Date;"All"==this.model.get("invitationType")?b.each(function(a){c=new App.Models.Mail,c.set("senderId",d.model.senderId),c.set("receiverId",a.get("_id")),c.set("status","0"),c.set("subject","Meetup Invitation | "+d.model.title),c.set("type","Meetup-invitation"),c.set("body",d.model.description+'<br/><br/><button class="btn btn-primary" id="invite-accept" value="'+d.model.resId+'" >Accept</button>&nbsp;&nbsp;<button class="btn btn-danger" id="invite-reject" value="'+d.model.resId+'" >Reject</button>'),c.set("sendDate",e),c.set("entityId",d.model.resId),c.save()}):"Members"==this.model.get("invitationType")&&b.each(function(a){d.model.get("members").indexOf(a.get("_id"))>-1&&(c=new App.Models.Mail,c.set("senderId",d.model.senderId),c.set("receiverId",a.get("_id")),c.set("status","0"),c.set("subject","Meetup Invitation | "+d.model.title),c.set("body",d.model.description+'<br/><br/><button class="btn btn-primary" id="invite-accept" value="'+d.model.resId+'" >Accept</button>&nbsp;&nbsp;<button class="btn btn-danger" id="invite-reject" value="'+d.model.resId+'" >Reject</button>'),c.set("type","Meetup-invitation"),c.set("sendDate",e),c.set("entityId",d.model.resId),c.save(),console.log(c))}),$("#invitationdiv").fadeOut(1e3),alert("Invitation sent successfully"),document.getElementById("cont").style.opacity=1,document.getElementById("nav").style.opacity=1,setTimeout(function(){$("#invitationdiv").hide()},1e3),Backbone.history.navigate("meetups",{trigger:!0})}})}),$(function(){App.Views.MeetupSpan=Backbone.View.extend({tagName:"td",className:"meetup-box",template:$("#template-Meetup").html(),render:function(){var a=this.model.toJSON();this.$el.append(_.template(this.template,a))}})}),$(function(){App.Views.MeetupSpans=Backbone.View.extend({tagName:"tr",addOne:function(a){var b=new App.Views.MeetupSpan({model:a});b.render(),$("#meetUpTable").append(b.el)},addAll:function(){0!=this.collection.length?this.collection.each(this.addOne,this):$("#meetUpTable").append("<td class='course-box'>No MeetUp</td>")},render:function(){this.addAll()}})}),$(function(){App.Views.MemberForm=Backbone.View.extend({className:"form",id:"memberform",events:{"click #formButton":"setForm","submit form":"setFormFromEnterKey","click #formButtonCancel":function(){window.history.back()},"click #deactive":function(a){a.preventDefault();this.model.on("sync",function(){location.reload()}),this.model.save({status:"deactive"},{success:function(){}})},"click #ptManager":function(a){},"click #active":function(a){a.preventDefault();this.model.on("sync",function(){location.reload()}),this.model.save({status:"active"},{success:function(){}})}},getRoles:function(a){var b=a?new App.Models.Member({_id:a}):new App.Models.Member({_id:$.cookie("Member._id")});b.fetch({async:!1});var c=b.get("roles");return c},render:function(){this.form=new Backbone.Form({model:this.model});var a="";this.$el.append(this.form.render().el),this.form.fields.status.$el.hide(),this.form.fields.yearsOfTeaching.$el.hide(),this.form.fields.teachingCredentials.$el.hide(),this.form.fields.subjectSpecialization.$el.hide(),this.form.fields.forGrades.$el.hide(),this.form.fields.visits.$el.hide(),this.form.setValue({community:App.configuration.get("name"),region:App.configuration.get("region"),nation:App.configuration.get("nationName")}),$("input[name='community']").attr("disabled",!0),$("input[name='region']").attr("disabled",!0),$("input[name='nation']").attr("disabled",!0);var b="<p id='imageText' style='margin-top: 15px;'></p>";void 0!=this.model.id?(a="Update",$("input[name='login']").attr("disabled",!0)):a="Register";var c=$('<div class="signup-submit"><a class="btn btn-success" id="formButton" style="margin-top: 10px;">'+a+'</button><a class="btn btn-danger" id="formButtonCancel" style="margin-top: 10px;">Cancel</button></div>'),d=$('<form method="post" id="fileAttachment" ><input type="file" name="_attachments" style="margin-left: 170px;" id="_attachments" multiple="multiple" /> <input class="rev" type="hidden" name="_rev"></form>'),e=$('<div id="browseImage" >'+b+'<img style="width:100px;height:100px;border-radius:50px" id="memberImage"></div>');if(this.$el.append(e),this.$el.append(d),this.$el.append(c),void 0!=this.model.id){"active"==this.model.get("status")?$(".signup-submit").append('<a class="btn btn-danger" id="deactive" href="#" style="margin-top: 10px;">Resign</a>'):$(".signup-submit").append('<a class="btn btn-success" id="active" style="margin-top: 10px;" href="#">Reinstate</a>');var f=this.getRoles(!1);if(f.indexOf("SuperManager")>-1){var g=this.getRoles(this.model.id);$("#memberform").append('<div style="margin-left: 170px;margin-top: -40px;"><input id="ptManager" type="checkbox" ><label for="ptManager">Promote To Manager</label></div>'),g.indexOf("Manager")>-1&&$("#ptManager").prop("checked",!0)}}var h="/members/"+this.model.id+"/";"undefined"!=typeof this.model.get("_attachments")&&(h+=_.keys(this.model.get("_attachments"))[0],document.getElementById("memberImage").src=h)},validImageTypeCheck:function(a){if(""==a.val())return 1;var b=a.val().split(".");return console.log(b[b.length-1]),"jpeg"==b[b.length-1]||"jpg"==b[b.length-1]||"png"==b[b.length-1]||"JPG"==b[b.length-1]?1:(alert("ERROR: Not a valid image file \n\n Valid Extensions are  [.jpg, .jpeg ]"),0)},setFormFromEnterKey:function(a){a.preventDefault(),this.setForm()},setForm:function(){if($("#ptManager").attr("checked")){var a=this.model.toJSON().roles.indexOf("Manager");0>a&&this.model.toJSON().roles.push("Manager")}else{var a=this.model.toJSON().roles.indexOf("Manager");a>-1&&this.model.toJSON().roles.splice(a,1)}var b=this;if(null==this.form.validate()&&this.validImageTypeCheck($('input[type="file"]'))){var c=Backbone.Collection.extend({url:App.Server+"/configurations/_all_docs?include_docs=true"}),d=new c;d.fetch({async:!1}),console.log("---***********---"),console.log(d),console.log(d.first().toJSON());var e=d.first().toJSON().rows[0].doc;this.form.setValue({status:"active",community:e.code,region:e.region,nation:e.nationName}),this.form.commit(),-1==$.inArray("lead",this.model.get("roles"))&&(b.model.set("yearsOfTeaching",null),b.model.set("teachingCredentials",null),b.model.set("subjectSpecialization",null),b.model.set("forGrades",null));var f=!0;if(void 0==this.model.get("_id")){this.model.set("roles",["Learner"]),
this.model.set("visits",0);var g=new App.Collections.Members;g.login=b.model.get("login"),g.fetch({async:!1,success:function(){g=g.first(),void 0!=g&&void 0!=g.toJSON().login&&(alert("Login already exist"),f=!1)}})}if(f){var h=this.model;this.model.save(null,{success:function(){if(b.model.unset("_attachments"),$('input[type="file"]').val())b.model.saveAttachment("form#fileAttachment","form#fileAttachment #_attachments","form#fileAttachment .rev");else if(void 0==b.model.attributes._rev){var a=new PouchDB("activitylogs"),c=new Date,d=b.getFormattedDate(c);a.get(d,function(c,f){c?b.createJsonlog(d,e,h,a):b.UpdatejSONlog(d,f,h,a)})}else alert("Successfully Updated!!!"),Backbone.history.navigate("members",{trigger:!0});b.model.on("savedAttachment",function(){if(void 0==b.model.attributes._rev){var a=new PouchDB("activitylogs"),c=new Date,d=b.getFormattedDate(c);a.get(d,function(c,f){c?b.createJsonlog(d,e,h,a):b.UpdatejSONlog(d,f,h,a)})}else alert("Successfully Updated!!!"),Backbone.history.navigate("members",{trigger:!0})},b.model)}})}}},getFormattedDate:function(a){var b=a.getFullYear(),c=(1+a.getMonth()).toString();c=c.length>1?c:"0"+c;var d=a.getDate().toString();return d=d.length>1?d:"0"+d,c+"/"+d+"/"+b},createJsonlog:function(a,b,c,d){var e={logDate:a,resourcesIds:[],male_visits:0,female_visits:0,female_new_signups:0,male_new_signups:0,male_timesRated:[],female_timesRated:[],male_rating:[],community:b.code,female_rating:[],resources_names:[],resources_opened:[],male_opened:[],female_opened:[],male_deleted_count:0,female_deleted_count:0};"Male"==c.get("Gender")?e.male_new_signups=1:e.female_new_signups=1,d.put(e,a,function(b,c){b?(console.log("MyApp::MemberForm.js (view):: createJsonlog: error creating activity log doc in pouchdb.."),console.log(b)):(console.log("created activity log in pouchdb for today.. i-e "+a),console.log(c)),alert("Successfully Registered!!!"),Backbone.history.navigate("members",{trigger:!0})})},UpdatejSONlog:function(a,b,c,d){"Male"==c.get("Gender")?b.male_new_signups=parseInt(b.male_new_signups?b.male_new_signups:0)+1:b.female_new_signups=parseInt(b.female_new_signups?b.female_new_signups:0)+1,d.put(b,a,b._rev,function(b,c){b?(console.log("MyApp::MemberForm.js (view):: UpdatejSONlog: err making update to record"),console.log(b)):(console.log("updated activity log in pouchdb for today.. i-e "+a),console.log(c)),alert("Successfully Registered!!!"),Backbone.history.navigate("members",{trigger:!0})})}})}),$(function(){App.Views.MemberLoginForm=Backbone.View.extend({className:"form login-form",events:{"keypress .bbf-form":"listenToEnterForSubmit","click #formButton":"setForm","submit form":"setFormFromEnterKey","click #formButton2":"signup","click #welcomeButton":"showWelcomeVideo"},listenToEnterForSubmit:function(a){13==a.keyCode&&this.setForm()},render:function(){var a=this,b=new App.Collections.Resources;b.setUrl(App.Server+"/resources/_design/bell/_view/welcomeVideo"),b.fetch({success:function(){if(b.length>0){var c=b.models[0].attributes.id,d="/apps/_design/bell/bell-resource-router/index.html#openres/"+c,e=$('<a id="welcomeButton" class="login-form-button btn btn-block btn-lg btn-success" target="_blank" href="hmmm" style="margin-left: -4px;margin-top: -21px; font-size:27px;">Welcome</button>');a.$el.append(e),a.$el.find("#welcomeButton").attr("href",d)}},error:function(){console.log("Error in fetching welcome video doc from db")},async:!1}),this.form=new Backbone.Form({model:this.model}),this.$el.append(this.form.render().el);var c=$('<a class="login-form-button btn btn-block btn-lg btn-success" style="margin-left: -4px;margin-top: -21px; font-size:27px;" id="formButton">Sign In</button>'),d=$('<div class="signup-div" ><a style="margin-left: -4px;margin-top: -21px; font-size:22px;" class="signup-form-button btn btn-block btn-lg btn-info" id="formButton2">Become A Member</button></div>');this.$el.append(c),this.$el.append(d)},showWelcomeVideo:function(){},setFormFromEnterKey:function(a){a.preventDefault(),this.setForm()},signup:function(){Backbone.history.navigate("member/add",{trigger:!0})},setForm:function(){var a=this;this.form.commit();var b,c=this.form.model,d=new App.Collections.Members;d.login=c.get("login"),d.fetch({success:function(){if(d.length>0)if(b=d.first(),b&&b.get("password")==c.get("password")&&b.get("login")==c.get("login"))if("active"==b.get("status")){App.member=b;var e=parseInt(b.get("visits"));e++,b.set("visits",e),b.once("sync",function(){}),b.save(null,{success:function(a,b){}}),a.logActivity(b);var f=new Date;if($.cookie("Member.login",b.get("login"),{path:"/apps/_design/bell"}),$.cookie("Member._id",b.get("_id"),{path:"/apps/_design/bell"}),$.cookie("Member.expTime",f,{path:"/apps/_design/bell"}),$.cookie("Member.roles",b.get("roles"),{path:"/apps/_design/bell"}),1==parseInt(b.get("visits"))&&-1!=b.get("roles").indexOf("SuperManager"))return void Backbone.history.navigate("configuration/add",{trigger:!0});a.trigger("success:login")}else alert("Your Account Is Deactivated");else alert("Login or Password Incorrect");else alert("Login or Password Incorrect.")}})},logActivity:function(a){var b=this,c=new PouchDB("activitylogs"),d=new Date,e=this.getFormattedDate(d);c.get(e,function(d,f){d?b.createJsonlog(a,e,c):b.UpdatejSONlog(a,f,c,e)})},UpdatejSONlog:function(a,b,c,d){var e=a.get("roles").indexOf("SuperManager");if("Male"==a.get("Gender")){var f=parseInt(b.male_visits);-1==e&&f++,b.male_visits=f}else{var f=parseInt(b.female_visits);-1==e&&f++,b.female_visits=f}b.community=App.configuration.get("code"),c.put(b,d,b._rev,function(a,b){a?(console.log("MemberLoginForm:: UpdatejSONlog:: err making update to record"),console.log(a)):console.log("MemberLoginForm:: updated daily log from pouchdb for today..")})},getFormattedDate:function(a){var b=a.getFullYear(),c=(1+a.getMonth()).toString();c=c.length>1?c:"0"+c;var d=a.getDate().toString();return d=d.length>1?d:"0"+d,c+"/"+d+"/"+b},createJsonlog:function(a,b,c){var d=a.get("roles").indexOf("SuperManager"),e={logDate:b,resourcesIds:[],male_visits:0,female_visits:0,male_timesRated:[],female_timesRated:[],male_rating:[],community:App.configuration.get("code"),female_rating:[],resources_names:[],resources_opened:[],male_opened:[],female_opened:[],male_deleted_count:0,female_deleted_count:0};if("Male"==a.get("Gender")){var f=parseInt(e.male_visits);-1==d&&f++,e.male_visits=f}else{var f=parseInt(e.female_visits);-1==d&&f++,e.female_visits=f}e.community=App.configuration.get("code"),c.put(e,b,function(a,b){a?(console.log("MemberLoginForm:: createJsonlog:: error creating/pushing activity log doc in pouchdb.."),console.log(a)):console.log("MemberLoginForm:: created activity log in pouchdb for today..")})}})}),$(function(){App.Views.MemberRow=Backbone.View.extend({tagName:"tr",getFormattedDate:function(a){var b=a.getFullYear(),c=(1+a.getMonth()).toString();c=c.length>1?c:"0"+c;var d=a.getDate().toString();return d=d.length>1?d:"0"+d,c+"/"+d+"/"+b},createJsonlog:function(a,b,c){var d={logDate:b,resourcesIds:[],male_visits:0,female_visits:0,male_timesRated:[],female_timesRated:[],male_rating:[],community:App.configuration.get("code"),female_rating:[],resources_names:[],resources_opened:[],male_opened:[],female_opened:[],male_deleted_count:0,female_deleted_count:0};"Male"==c?(d.male_deleted_count=parseInt(d.male_deleted_count?d.male_deleted_count:0)+1,d.female_deleted_count=parseInt(d.female_deleted_count?d.female_deleted_count:0)+0):(d.female_deleted_count=parseInt(d.female_deleted_count?d.female_deleted_count:0)+1,d.male_deleted_count=parseInt(d.male_deleted_count?d.male_deleted_count:0)+0),d.community=App.configuration.get("code"),a.put(d,b,function(a,b){a?(alert("Deleted members count failed to save."),console.log(a)):alert("Deleted members successfully saved.")})},UpdatejSONlog:function(a,b,c,d){"Male"==d?(c.male_deleted_count=parseInt(c.male_deleted_count?c.male_deleted_count:0)+1,c.female_deleted_count=parseInt(c.female_deleted_count?c.female_deleted_count:0)+0):(c.female_deleted_count=parseInt(c.female_deleted_count?c.female_deleted_count:0)+1,c.male_deleted_count=parseInt(c.male_deleted_count?c.male_deleted_count:0)+0),c.community=App.configuration.get("code"),a.put(c,b,c._rev,function(a,b){a?(alert("UpdatejSONlog:: err making update to record"),console.log(a)):alert("updated daily log from pouchdb for today..")})},events:{"click .destroy":function(a){var b=this,c=new PouchDB("activitylogs"),d=new Date,e=b.getFormattedDate(d),f=this.model.get("Gender");c.get(e,function(a,d){a?b.createJsonlog(c,e,f):b.UpdatejSONlog(c,e,d,f)}),a.preventDefault(),this.model.destroy(),this.remove()},"click #deactive":function(a){a.preventDefault();this.model.on("sync",function(){location.reload()}),this.model.save({status:"deactive"},{success:function(){}})},"click #active":function(a){a.preventDefault();this.model.on("sync",function(){location.reload()}),this.model.save({status:"active"},{success:function(){}})},"click .browse":function(a){a.preventDefault(),$("#modal").modal({show:!0})}},template:$("#template-MemberRow").html(),initialize:function(){},render:function(){this.model.get("visits")||this.model.set("visits");var a=this.model.toJSON();a.community_code=this.community_code,this.model.get("_id")!=$.cookie("Member._id")||this.isadmin?this.isadmin?(a.showdelete=!0,a.showedit=!0):(a.showdelete=!1,a.showedit=!1):(a.showdelete=!1,a.showedit=!0),a.src="img/default.jpg";var b="/members/"+this.model.id+"/";"undefined"!=typeof this.model.get("_attachments")&&(b+=_.keys(this.model.get("_attachments"))[0],a.src=b),this.$el.html(_.template(this.template,a))}})}),$(function(){App.Views.MembersTable=Backbone.View.extend({tagName:"table",className:"btable btable-striped",addOne:function(a){var b=new App.Views.MemberRow({model:a});b.isadmin=this.isadmin,b.community_code=this.community_code,b.render(),this.$el.append(b.el)},events:{"click .pageNumber":function(a){this.collection.startkey="",this.collection.skip=a.currentTarget.attributes[0].value,this.collection.fetch({async:!1}),this.collection.length>0&&this.render()}},addAll:function(){this.$el.html("<tr><th>Photo</th><th>Last Name</th><th>First Name</th><th>Visits</th><th>Email</th><th>Bell-Email</th><th>Actions</th></tr>"),console.log(this.collection),this.collection.each(this.addOne,this);var a=this;$.ajax({url:"/members/_design/bell/_view/count?group=false",type:"GET",dataType:"json",success:function(b){if(memberLength=b.rows[0].value,1!=a.displayCollec_Resources){for(var c="<tr><td colspan=7>",d=memberLength/20,e=0;d>e;e++)c+=0==e?'<a  class="pageNumber" value="'+20*e+'">Home</a>&nbsp&nbsp':'<a  class="pageNumber" value="'+20*e+'">'+e+"</a>&nbsp&nbsp";c+="</td></tr>",a.$el.append(c)}}})},render:function(){this.addAll()}})}),$(function(){App.Views.MembersView=Backbone.View.extend({searchText:"",events:{"click .Search":function(a){this.renderTable($("#searchText").val().toLowerCase())}},render:function(){this.$el.html('<h3 style="float:right"><input id="searchText" style="margin-right:15px;height:28px;width:170px" type="Text" placeholder="Last Name"><button style="margin-top:-10px;" class="Search btn btn-info">Search</button></h3>'),this.$el.append('<h3>Members<a style="margin-left:20px" class="btn btn-success" href="#member/add">Add a New Member</a></h3>'),this.$el.append('<div id="memberTable"></div>'),this.renderTable(searchText)},renderTable:function(a){App.startActivityIndicator();var b=new App.Collections.Configurations;b.fetch({async:!1});var c=b.first(),d=c.toJSON();code=d.code,nationName=d.nationName;var e=App.Router.getRoles();members=new App.Collections.Members,members.searchText=a,members.fetch({success:function(a){membersTable=new App.Views.MembersTable({collection:a}),membersTable.community_code=code+nationName.substring(3,5),e.indexOf("Manager")>-1?membersTable.isadmin=!0:membersTable.isadmin=!1,membersTable.render(),$("#memberTable").html(membersTable.el),App.stopActivityIndicator()},error:function(){App.stopActivityIndicator()}})}})}),$(function(){App.Views.PublicationTable=Backbone.View.extend({authorName:null,tagName:"table",className:"table table-striped",collectionInfo:[],add:function(a,b,c){this.collectionInfo[b._id]=b,c?this.$el.append('<tr id="'+a+'"><td>'+b.IssueNo+'</td><td><a name="'+b._id+'" class="synPublication btn btn-info">Sync publication</a></td></tr>'):this.$el.append('<tr id="'+a+'"><td>'+b.IssueNo+'</td><td><a name="'+b._id+'" class="synPublication btn btn-info">Sync publication</a><label>&nbsp&nbspNot Synced</label></td></tr>')},events:{"click .synPublication":"synPublication"},render:function(){this.$el.html("<tr><th>Issue Number</th><th>Actions</th></tr>");var a=this,b=App.configuration.get("nationName"),c=App.password,d=App.configuration.get("nationUrl"),e=App.configuration.get("name"),f="http://"+b+":"+c+"@"+d+'/publicationdistribution/_design/bell/_view/getPublications?include_docs=true&key=["'+e+'",'+!1+"]";$.ajax({url:f,type:"GET",dataType:"jsonp",success:function(e){var f="",g={};if(_.each(e.rows,function(a){g[a.doc.publicationId]=a.doc._id,f+='"'+a.doc.publicationId+'",'}),""!=f){f=f.substring(0,f.length-1);var h="http://"+b+":"+c+"@"+d+"/publications/_all_docs?include_docs=true&keys=["+f+"]";$.ajax({url:h,type:"GET",dataType:"jsonp",success:function(b){var c=new App.Collections.Publication,d=App.Server+"/publications/_design/bell/_view/allPublication?include_docs=true";c.setUrl(d),c.fetch({success:function(){_.each(b.rows,function(b){var d=b.doc,e=c.models,f=e.map(function(a){return a.get("_id")}).indexOf(d._id),h=g[d._id],i=!1;f>-1?(i=!0,a.add(h,d,i)):a.add(h,d,i)})}})},error:function(a,b,c){console.log(a),console.log(b),console.log(c)}})}},error:function(a,b,c){console.log(a),console.log(b),console.log(c)}})},synPublication:function(a){var b=this,c=a.currentTarget.name,d=$(a.currentTarget).closest("tr").attr("id"),e=this.collectionInfo[c];$.couch.allDbs({success:function(a){-1!=a.indexOf("tempresources")?$.couch.db("tempresources").drop({success:function(a){console.log(a),b.syncCourses(d,e)},error:function(a){console.log(a)}}):b.syncCourses(d,e)},async:!1})},syncCourses:function(a,b){var c=b.resources,d=b.courses,e=b.IssueNo,f=App.configuration.get("nationUrl"),g=App.configuration.get("nationName"),h=[],i=[],j=[];for(var k in d){var l=d[k];h.push(l.courseID);var m=l.stepIDs;for(var n in m){var o=m[n];i.push(o.stepID);var p=o.resourceIDs;for(var q in p)j.push(p[q])}}for(var r in c)j.push(c[r]);console.log("Syncing Resources and Courses.."),console.log("http://"+g+":"+App.password+"@"+f+"/resources"),console.log(j),App.startActivityIndicator(),$.couch.db("tempresources").create({success:function(a){console.log(a),$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"http://"+g+":"+App.password+"@"+f+"/resources",target:"tempresources",doc_ids:j}),async:!1,success:function(a){console.log(a),$.ajax({url:"/tempresources/_all_docs?include_docs=true",type:"GET",dataType:"json",success:function(a){for(var b=a.rows,c=[],d=0;d<b.length;d++)b[d].doc.sum=0,b[d].doc.timesRated=0,c.push(b[d].doc);$.couch.db("tempresources").bulkSave({docs:c},{success:function(a){$.couch.replicate("tempresources","resources",{success:function(a){alert("Resources successfully synced"),$.couch.db("tempresources").drop({success:function(a){console.log(a)},error:function(a){console.log(a)}}),alert('Publication "'+e+'" Resources successfully synced')},error:function(a){console.log(a),alert("Unable to sync Resources"),$.couch.db("tempresources").drop({success:function(a){console.log(a)},error:function(a){console.log(a)}})}},{create_target:!0})},error:function(a){$.couch.db("tempresources").drop({success:function(a){console.log(a)},error:function(a){console.log(a)}}),alert("Error!")}})},error:function(){alert("Unable to get resources."),$.couch.db("tempresources").drop({success:function(a){console.log(a)},error:function(a){console.log(a)}})},async:!1}),$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"http://"+g+":"+App.password+"@"+f+"/groups",target:"groups",doc_ids:h}),success:function(a){$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"http://"+g+":"+App.password+"@"+f+"/coursestep",target:"coursestep",doc_ids:i}),success:function(a){$.couch.db("publications").saveDoc(b,{success:function(a){console.log("adding publication# "+b.IssueNo+" doc at community for bookkeeping"),console.log(a)},error:function(a,b,c){console.log(c)}}),$.ajax({url:"http://"+App.configuration.get("nationName")+":oleoleole@"+App.configuration.get("nationUrl")+'/community/_design/bell/_view/getCommunityByCode?_include_docs=true&key="'+App.configuration.get("code")+'"',type:"GET",dataType:"jsonp",success:function(a){var b=a.rows[0].value,c=a.rows[0].id;$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"http://"+App.configuration.get("nationName")+":oleoleole@"+App.configuration.get("nationUrl")+"/community",target:"community",doc_ids:[c]}),success:function(a){console.log("Successfully Replicated.");var d=new Date,e=d.getFullYear(),f=(1+d.getMonth()).toString();f=f.length>1?f:"0"+f;var g=d.getDate().toString();g=g.length>1?g:"0"+g;b.lastPublicationsSyncDate=f+"/"+g+"/"+e,$.ajax({headers:{Accept:"application/json","Content-Type":"multipart/form-data"},type:"PUT",url:App.Server+"/community/"+c+"?rev="+b._rev,dataType:"json",data:JSON.stringify(b),success:function(a){$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"community",target:"http://"+App.configuration.get("nationName")+":oleoleole@"+App.configuration.get("nationUrl")+"/community",doc_ids:[c]}),success:function(a){alert("Successfully Replicated Publications."),App.stopActivityIndicator()},async:!1})},async:!1})},async:!1})},error:function(){console.log("http://"+g+":oleoleole@"+nationURL+'/community/_design/bell/_view/getCommunityByCode?key="'+App.configuration.get("code")+'"')}})},error:function(a,b,c){console.log('Error syncing/replicating Publication "'+e+'" course-steps'),console.log(b),console.log(c),App.stopActivityIndicator(),alert("Failed to sync course-steps")}})},error:function(a,b,c){console.log('Error syncing/replicating Publication "'+e+'" courses'),console.log(b),console.log(c),App.stopActivityIndicator(),alert("Failed to sync courses")}})},error:function(a,b,c){console.log('Error syncing/replicating Publication "'+e+'" resources'),console.log(b),console.log(c),$.couch.db("tempresources").drop({success:function(a){console.log(a)},error:function(a){console.log(a)}}),App.stopActivityIndicator(),alert("Failed to sync resources")}})}})},synResources:function(a,b,c,d){console.log("Syncing Resources.."),console.log("http://"+b+":"+App.password+"@"+a+"/resources"),console.log(c),$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"http://"+b+":"+App.password+"@"+a+"/resources",target:"resources",doc_ids:c}),success:function(a){console.log(a),alert('Publication "'+d+'" Resources successfully Synced')},error:function(a,b,c){console.log('Error syncing/replicating Publication "'+d+'" resources'),console.log(b),console.log(c)}})}})}),$(function(){App.Views.QuizView=Backbone.View.extend({template:$("#make-Quiz").html(),vars:{},quizQuestions:null,questionOptions:null,answers:null,currentQuestion:null,events:{"click .EditQuestiontoView":"EditQuestiontoView","click #delete-quiz-question":"deleteQuestion","click #cancel-edit-question":function(a){this.render(),this.displayQuestionsInView()},"click #cancel-quiz":function(){Backbone.history.navigate("level/view/"+this.levelId+"/"+this.revId,{trigger:!0})},"click #cancel-new-question":function(){$("textarea#quizQuestion").val(""),$("#option1").val(""),$("#option2").val(""),$("#option3").val(""),$("#option4").val(""),$("#option5").val(""),$("input[name=options]:checked").each(function(){this.checked=!1})},"click #save-new-question":function(a){this.savequestion()},"click #save-edit-question":function(a){this.savequestion(),this.render(),this.displayQuestionsInView()},"click #save-quiz":function(a){var b=new App.Models.CourseStep({_id:this.levelId,_rev:this.revId});b.fetch({async:!1}),b.set("questions",this.quizQuestions),b.set("qoptions",this.questionOptions),b.set("answers",this.answers);b.save(null,{success:function(a,b){alert("Quiz Successfully Saved"),Backbone.history.navigate("level/view/"+b.id+"/"+b.rev,{trigger:!0})}})}},savequestion:function(a){this.validQuestionAndOptions()?(this.saveQuestionAndOptions(),$("#question-no").html("Question :"),$("textarea#quizQuestion").val(""),$("#option1").val(""),$("#option2").val(""),$("#option3").val(""),$("#option4").val(""),$("#option5").val(""),$("input[name=options]:checked").each(function(){this.checked=!1})):alert("invalid inputs")},displayQuestionInView:function(a){var b=a;b++,$("#question-no").html("Question "+b+":"),$("textarea#quizQuestion").val(this.quizQuestions[a]),$("#option1").val(this.questionOptions[5*a]),$("#option2").val(this.questionOptions[5*a+1]),$("#option3").val(this.questionOptions[5*a+2]),$("#option4").val(this.questionOptions[5*a+3]),$("#option5").val(this.questionOptions[5*a+4]),$("input[name=options]:checked").each(function(){this.checked=!1});var c=this.questionOptions.indexOf(this.answers[a]);if(c>=0){var d=c%5,e=document.getElementsByName("options");e[d].checked=!0}},saveQuestionAndOptions:function(){this.quizQuestions[this.currentQuestion]=$("textarea#quizQuestion").val(),this.questionOptions[5*this.currentQuestion]=$("#option1").val(),this.questionOptions[5*this.currentQuestion+1]=$("#option2").val(),this.questionOptions[5*this.currentQuestion+2]=$("#option3").val(),this.questionOptions[5*this.currentQuestion+3]=$("#option4").val(),this.questionOptions[5*this.currentQuestion+4]=$("#option5").val(),this.answers[this.currentQuestion]=$("#"+$("input[name=options]:checked").val()).val(),this.displayQuestionsInView()},displayQuestionsInView:function(){$("#listofquestions").html("");for(var a=0;a<this.quizQuestions.length;a++)this.AddQuestiontoView(a);this.currentQuestion=this.quizQuestions.length},AddQuestiontoView:function(a){var b='<tr><td colspan="6"><h6>Question# '+(a+1)+"&nbsp&nbsp<a name="+a+' class="EditQuestiontoView btn btn-info">Edit</a>&nbsp&nbsp<button value="'+a+'" class="btn btn-danger" id="delete-quiz-question" >Delete</button></h6>'+this.quizQuestions[a]+"</td></tr>";b+="<tr>",b+="<td><b>Options</b></td>",b+="<td>"+this.questionOptions[5*a]+"</td>",b+="<td>"+this.questionOptions[5*a+1]+"</td>",b+="<td>"+this.questionOptions[5*a+2]+"</td>",b+="<td>"+this.questionOptions[5*a+3]+"</td>",b+="<td>"+this.questionOptions[5*a+4]+"</td>",b+="<td><b>"+this.answers[a]+"<b></td>",b+="</tr>",b+='<tr><td colspan="7"><div id="'+a+'"></div></td></tr>',$("#listofquestions").append(b)},EditQuestiontoView:function(a){this.currentQuestion=a.currentTarget.name,this.displayQuestionInView(this.currentQuestion),$("#question-div").appendTo("#"+this.currentQuestion),$("#save-edit-question").show(),$("#cancel-edit-question").show(),$("#save-new-question").hide(),$("#cancel-new-question").hide()},deleteQuestion:function(a){this.currentQuestion=a.currentTarget.value,this.quizQuestions.splice(this.currentQuestion,1),this.questionOptions.splice(5*this.currentQuestion,5),this.answers.splice(this.currentQuestion,1),this.render(),this.displayQuestionsInView()},validQuestionAndOptions:function(){return"undefined"==typeof $("textarea#quizQuestion").val()||""==$("textarea#quizQuestion").val()?!1:"undefined"==typeof $("#option1").val()||""==$("#option1").val()?!1:"undefined"==typeof $("#option2").val()||""==$("#option2").val()?!1:"undefined"==typeof $("#option3").val()||""==$("#option3").val()?!1:"undefined"==typeof $("#option4").val()||""==$("#option4").val()?!1:"undefined"==typeof $("#option5").val()||""==$("#option5").val()?!1:"undefined"==typeof $("input[name=options]:checked").val()||""==$("input[name=options]:checked").val()?!1:!0},initialize:function(){this.quizQuestions=new Array,this.questionOptions=new Array,this.answers=new Array,this.currentQuestion=0},render:function(){this.vars.courseTitle=this.ltitle,this.$el.html(_.template(this.template,this.vars)),$("#save-edit-question").hide(),$("#cancel-edit-question").hide()}})}),$(function(){App.Views.ReportForm=Backbone.View.extend({className:"form",hide:!1,events:{"click .save":"saveForm","click #cancel":function(){window.history.back()}},template:_.template($("#template-form-file").html()),render:function(){var a={};if(_.has(this.model,"id")){a.header='Title "'+this.model.get("title")+'"',a.hidesave=!0;var b=this.model.get("_attachments"),c=_.map(_.pairs(b),function(a){return{key:a[0],value:a[1]}});a.resourceAttachments=c}else a.header="New Report",a.hidesave=!1,a.resourceAttachments="No File Selected.";this.form=new Backbone.Form({model:this.model}),this.form.render(),0==this.edit&&alert("here");return _.has(this.model,"id"),a.form="",this.$el.html(this.template(a)),$(".fields").html(this.form.el),$("#progressImage").hide(),this},saveForm:function(){var a,b=!0,c=this.model.get("title"),d=this.model.get("_id");this.form.commit(),a=this.model.get("title");var e=this;if(0==this.model.get("title").length)alert("Resource Title is missing");else if("News"!=this.model.get("Tag")||this.model.get("author")){if($("#gressImage").show(),this.model.set(" uploadDate",(new Date).getTime()),"All"==this.model.get("Level")?(this.model.set("toLevel",0),this.model.set("fromLevel",0)):parseInt(this.model.get("fromLevel"))>parseInt(this.model.get("toLevel"))&&(alert("Invalid range specified "),b=!1),void 0==d){var e=this,f=new App.Collections.Reports;f.fetch({async:!1}),f.each(function(a){e.model.get("title")==a.get("title")&&(alert("Title already exist"),b=!1)})}b&&(void 0==d?this.model.set("sum",0):this.model.set("title",c),this.model.save(null,{success:function(){if(e.model.unset("_attachments"),$('input[type="file"]').val())if(void 0!=d)if(c!=a){var b=!1,f=new App.Collections.Resources;if(f.fetch({async:!1}),f.each(function(c){a==c.get("title")&&(b=!0)}),b)alert("Resource title Already exist");else{var g=new App.Models.Resource;g.set("title",a),g.set("description",e.model.get("description")),g.set("articleDate",e.model.get("articleDate")),g.set("addedBy",e.model.get("addedBy")),g.set("openWith",e.model.get("openWith")),g.set("openWhichFile",e.model.get("openWhichFile")),g.set("uploadDate",e.model.get("uploadDate")),g.set("openUrl",e.model.get("openUrl")),g.save(),g.on("sync",function(){g.saveAttachment("form#fileAttachment","form#fileAttachment #_attachments","form#fileAttachment .rev"),g.on("savedAttachment",function(){alert("Resource Updated Successfully"),Backbone.history.navigate("#resources",{trigger:!0}),e.trigger("processed"),$("#progressImage").hide()},g)})}}else alert("Cannot update model due to identical title");else e.model.saveAttachment("form#fileAttachment","form#fileAttachment #_attachments","form#fileAttachment .rev");else e.model.trigger("processed");e.model.on("savedAttachment",function(){this.trigger("processed"),$("#progressImage").hide()},e.model)}}))}else alert("Please Specify Author For This News Resource")},statusLoading:function(){alert("asdf"),this.$el.children(".status").html('<div style="display:none" class="progress progress-striped active"> <div class="bar" style="width: 100%;"></div></div>')}})}),$(function(){App.Views.ReportsRow=Backbone.View.extend({tagName:"tr",admn:null,events:{"click .destroy":function(a){alert("deleting"),this.model.destroy(),a.preventDefault()},"click #open":function(a){void 0==this.model.get("views")?(this.model.set("views",1),this.model.save()):(this.model.set("views",this.model.get("views")+1),this.model.save())},"click #commentButton":function(a){var b=new App.Collections.CommunityReportComments;b.CommunityReportId=a.target.attributes[0].nodeValue,b.fetch({async:!1});var c=new App.Views.CommunityReportCommentView({collection:b,CommunityReportId:a.target.attributes[0].nodeValue});c.render(),$("#debug").append(c.el)}},vars:{},template:_.template($("#template-ReportRow").html()),initialize:function(a){this.model.on("destroy",this.remove,this)},render:function(){var a=this.model.toJSON();void 0==a.views&&(a.views=0),a.isManager=this.isManager;var b=new Date(a.Date);a.Date=b.toUTCString(),this.$el.append(this.template(a))}})}),$(function(){App.Views.ReportsTable=Backbone.View.extend({tagName:"table",isManager:null,className:"btable btable-striped",initialize:function(){},addOne:function(a){var b=new App.Views.ReportsRow({model:a});b.isManager=this.isManager,b.render(),this.$el.append(b.el)},addAll:function(){this.$el.append('<tr><th>Time</th><th>Title</th><th>Author</th><th>Views</th><th colspan="5">Actions</th></tr>'),this.collection.forEach(this.addOne,this)},render:function(){this.addAll()}})}),$(function(){App.Views.RequestRow=Backbone.View.extend({tagName:"tr",template:$("#template-RequestRow").html(),render:function(){var a=this.model.toJSON(),b=new App.Models.Member({_id:a.senderId});b.fetch({async:!1}),b=b.toJSON(),a.name=b.firstName+" "+b.lastName,this.$el.html(_.template(this.template,a))}})}),$(function(){App.Views.RequestTable=Backbone.View.extend({tagName:"table",className:"table table-striped",id:"requestsTable",addOne:function(a){if("_design/bell"!=a.toJSON()._id){var b=new App.Views.RequestRow({model:a});b.render(),this.$el.append(b.el)}},addAll:function(){0!=this.collection.length?(this.$el.append("<tr><th>User</th><th>Category</th><th>Request</th></tr>"),this.collection.each(this.addOne,this)):this.$el.append("<th>No Requests</th>")},render:function(){this.addAll()}})}),$(function(){App.Views.RequestView=Backbone.View.extend({tagName:"div",id:"site-request",type:null,events:{"click #formButton":"setForm","click #CancelButton":"cancelform","click #ViewAllButton":"gotoRoute"},gotoRoute:function(){document.getElementById("nav").style.visibility="visible",Backbone.history.navigate("AllRequests",{trigger:!0})},cancelform:function(){$("#site-request").animate({height:"toggle"}),this.form.setValue({request:""});var a=this;setTimeout(function(){a.remove()},1e3),document.getElementById("nav").style.visibility="visible"},setForm:function(){var a=Backbone.Collection.extend({url:App.Server+"/configurations/_all_docs?include_docs=true"}),b=new a;b.fetch({async:!1});var c=b.first(),d=c.toJSON(),e=new Date;console.log(e);var f=("0"+(e.getMonth()+1).toString()).substr(-2)+"/"+("0"+e.getDate().toString()).substr(-2)+"/"+e.getFullYear().toString().substr(2);0!=this.form.getValue("request").length&&(this.form.setValue({status:"0"}),this.form.setValue({senderId:$.cookie("Member._id")}),this.form.setValue({date:f}),this.form.setValue({sendFrom:d.rows[0].doc.type}),this.form.setValue({sendFromName:d.rows[0].doc.name}),this.form.setValue({response:""}),this.form.setValue({type:this.type}),this.form.commit(),this.model.save(),console.log(this.model.toJSON()),alert("Request Successfully Sent"),this.form.setValue({request:""})),$("#site-request").animate({height:"toggle"});var g=this;setTimeout(function(){g.remove()},1e3),document.getElementById("nav").style.visibility="visible"},render:function(){document.getElementById("nav").style.visibility="hidden";var a=new App.Models.request;this.model=a,this.form=new Backbone.Form({model:a}),"Course"==this.type?this.$el.html('<span style=" font-weight: bold;visibility: visible;">I would like to enroll in a course on the following subject</span>'):"Resource"==this.type?this.$el.html('<span style=" font-weight: bold;visibility: visible;">I would like to have the following resource in BELL</span>'):"Meetup"==this.type?this.$el.html('<span style=" font-weight: bold;visibility: visible;">I would like to join a Meetup on the following topic</span>'):this.$el.html('<span style=" font-weight: bold;visibility: visible;">Error!!!!</span>'),
this.$el.append(this.form.render().el),this.form.fields.senderId.$el.hide(),this.form.fields.status.$el.hide(),this.form.fields.response.$el.hide(),this.form.fields.type.$el.hide(),this.form.fields.sendFrom.$el.hide(),this.form.fields.sendFromName.$el.hide(),this.form.fields.date.$el.hide();var b=$('<br/><div id="f-formButton"><button class="btn btn-hg btn-danger" id="CancelButton">Cancel</button><button class="btn btn-hg btn-info" id="ViewAllButton">View All</button><button class="btn btn-hg btn-primary" id="formButton">Submit</button></div>');this.$el.append(b)}})}),$(function(){App.Views.ResourceForm=Backbone.View.extend({className:"form",id:"resourceform",hide:!1,events:{'keydown input[name="title"]':"getFocusForTitle",'keydown input[name="author"]':"getFocusForAuthor",'keydown input[name="Year"]':"getFocusForYear",'keydown select[name="language"]':"getFocusForLanguage",'keydown input[name="Publisher"]':"getFocusForPublisher","keydown #_attachments":"getFocusForBrowse","keydown  .save":"getFocusForSave","click .save":"saveForm","click #cancel":function(){window.history.back()},"click #add_newCoellection":function(){App.Router.AddNewSelect("Add New")},"click #saveUpdatedWelcomeVideoForm":"saveUpdatedWelcomeVideoForm"},getFocusForTitle:function(a){9==a.keyCode&&(a.preventDefault(),$.trim($('[name="title"]').val()),$('[name="author"]').focus())},getFocusForAuthor:function(a){9==a.keyCode&&(a.preventDefault(),$.trim($('[name="author"]').val()),$('[name="Year"]').focus())},getFocusForBrowse:function(a){if(9==a.keyCode){a.preventDefault();var b=$(":focus");$(".save").attr("tabindex",0),$(".save").addClass("myTabIndexClass"),$(".myTabIndexClass").focus(),b=$(":focus")}},getFocusForSave:function(a){if(9==a.keyCode){a.preventDefault();var b=$(":focus");$("#cancel").attr("tabindex",0),$("#cancel").focus(),b=$(":focus"),a.preventDefault()}},getFocusForYear:function(a){9==a.keyCode&&(a.preventDefault(),$.trim($('[name="Year"]').val()),$('[name="language"]').focus())},getFocusForLanguage:function(a){9==a.keyCode&&(a.preventDefault(),$('[name="Publisher"]').focus())},getFocusForPublisher:function(a){9==a.keyCode&&(a.preventDefault(),$('[name="linkToLicense"]').focus())},getFocusForLinkToLicense:function(a){9==a.keyCode&&(a.preventDefault(),$.trim($('[name="Publisher"]').val()),$('[name="resourceType"]').focus())},getFocusForResourceType:function(a){9==a.keyCode&&(a.preventDefault(),$('[name="subject"]').focus())},template:_.template($("#template-form-file").html()),render:function(){var a={};if(_.has(this.model,"id")){a.header='Details "'+this.model.get("title")+'"';var b=this.model.get("_attachments"),c=_.map(_.pairs(b),function(a){return{key:a[0],value:a[1]}});a.resourceAttachments=c,a.resourceTitle=this.model.get("title"),a.resourceUrl=this.model.get("url")}else a.header="New Resource",a.resourceAttachments="No File Selected.",a.resourceUrl="";this.form=new Backbone.Form({model:this.model}),this.form.render(),this.form.fields.uploadDate.$el.hide(),0==this.edit&&this.form.fields.addedBy.$el.val($.cookie("Member.login")),this.form.fields.addedBy.$el.attr("disabled",!0),this.form.fields.averageRating.$el.hide();var d=this;return _.has(this.model,"id")&&"All"==this.model.get("Level")&&(d.hide=!0),a.form="",this.$el.html(this.template(a)),$(".fields").html(this.form.el),this.$el.append('<button class="btn btn-success" id="add_newCoellection" >Add New</button>'),$("#progressImage").hide(),$('[name="title"]').focus(),this},saveUpdatedWelcomeVideoForm:function(){void 0===this.model.get("isWelcomeVideo")&&this.model.set("isWelcomeVideo",!0),this.form.commit(),this.model.set("Level",null),this.model.set("subject",null);var a=this,b=$('input[type="file"]').val();this.model.save(null,{success:function(c){b&&(a.model.unset("_attachments"),App.startActivityIndicator(),a.model.on("savedAttachment",function(){App.stopActivityIndicator(),this.trigger("processed")},a.model),a.model.saveAttachment("#fileAttachment","#_attachments","#fileAttachment .rev"),a.form.fields.addedBy.setValue($.cookie("Member.login")))}})},renderAddOrUploadWelcomeVideoForm:function(){var a=$("<h3> Edit Welcome Video Form </h3><br><br><br><br>");this.$el.append(a),this.form=new Backbone.Form({model:this.model}),this.$el.append(this.form.render().el);for(var b in this.form.fields)this.form.fields[b].$el.hide();this.form.fields.addedBy.$el.show(),this.form.fields.resourceType.$el.show(),this.form.fields.addedBy.editor.el.disabled=!0,this.form.fields.uploadDate.$el.show(),this.form.fields.openWith.$el.show(),this.form.fields.resourceFor.$el.show();var c=this.model.get("_attachments"),d=_.map(_.pairs(c),function(a){return{key:a[0],value:a[1]}});for(var b in d){var e=$("<label>").text(d[b].key);this.$el.append(e)}this.$el.append("<br><br>"),this.$el.append('<form method="post" id="fileAttachment"></form>'),this.$el.find("#fileAttachment").append('<label for="_attachments">Upload Welcome Video</label>'),this.$el.find("#fileAttachment").append('<input type="file" name="_attachments" id="_attachments" style="line-height: 28px;" multiple="multiple" label=" :" />'),this.$el.find("#fileAttachment").append('<input class="rev" type="hidden" name="_rev">'),this.$el.append('<button class="addNation-btn btn btn-success" id="saveUpdatedWelcomeVideoForm">Submit</button>'),this.$el.append('<a class="btn btn-danger" id="cancel">Cancel</a>')},saveForm:function(){var a=this.model.get("title"),b=this.model.get("_id"),c=this;this.form.commit(),"PDF.js"==this.model.get("openWith")&&this.model.set("need_optimization",!0);var d=this.model.get("title");if(0==this.model.get("title").length)alert("Resource Title is missing");else if(null==this.model.get("subject"))alert("Resource Subject is missing");else if(null==this.model.get("Level"))alert("Resource Level is missing");else if(b){var e=!0;a!=d&&this.DuplicateTitle()&&(e=!1),e&&this.model.save(null,{success:function(a){$('input[type="file"]').val()?(c.model.unset("_attachments"),App.startActivityIndicator(),c.model.saveAttachment("form#fileAttachment","form#fileAttachment #_attachments","form#fileAttachment .rev")):window.history.back()}})}else this.DuplicateTitle()||(this.model.set("sum",0),this.model.set("timesRated",0),this.model.save(null,{success:function(a){$('input[type="file"]').val()?(App.startActivityIndicator(),c.model.saveAttachment("form#fileAttachment","form#fileAttachment #_attachments","form#fileAttachment .rev")):window.history.back()}}));this.model.on("savedAttachment",function(){this.trigger("processed")},c.model)},DuplicateTitle:function(){var a=new App.Collections.Resources;return a.title=this.model.get("title"),a.fetch({async:!1}),a=a.first(),void 0!=a&&void 0!=a.toJSON().title?(alert("Title already exist"),!0):!1},statusLoading:function(){this.$el.children(".status").html('<div style="display:none" class="progress progress-striped active"> <div class="bar" style="width: 100%;"></div></div>')}})}),$(function(){App.Views.ResourceRow=Backbone.View.extend({tagName:"tr",id:null,admn:null,events:{"click .destroy":function(a){if(confirm("Are you sure you want to delete this resource?")){var b=this,c=new App.Collections.shelfResource;c.deleteResource=1,c.resourceId=this.model.get("_id"),c.fetch({async:!1});for(var d;d=c.first();)d.destroy();var e=new App.Collections.ResourceFeedback;for(e.resourceId=this.model.get("_id"),e.fetch({async:!1});d=e.first();)d.destroy();var f=new App.Collections.coursesteps;f.getAll=1,f.resourceId=this.model.get("_id"),f.fetch({async:!1}),f.each(function(a){a.get("resourceId")||a.set("resourceId",[]);var c=a.get("resourceId").indexOf(b.model.get("_id").toString());-1!=c&&(a.get("resourceId").splice(c,1),a.get("resourceTitles").splice(c,1),a.save())}),this.model.destroy(),alert("Resource Successfully deleted."),a.preventDefault()}},"click .removeFromCollection":function(a){var b=window.location.href.split("#")[1].split("/")[1],c=this.model.get("Tag"),d=c.indexOf(b);d>-1&&c.splice(d,1);var e=this;this.model.set("Tag",c),this.model.save(null,{success:function(a,b){e.remove(),alert("Removed Successfully From Collection")}})},"click .hides":function(a){$(this.el).html(""),this.model.set({hidden:!0}),this.model.save(),App.startActivityIndicator();var b=new App.Collections.shelfResource;b.deleteResource=1,b.resourceId=this.model.get("_id"),b.fetch({async:!1}),b.each(function(a){a.set({hidden:!0}),a.save()}),App.stopActivityIndicator();var c=new App.Models.Resource({_id:this.model.get("_id")});c.fetch({async:!1}),this.model=c,this.render()},"click .unhide":function(a){$(this.el).html(""),this.model.set({hidden:!1}),this.model.save(),App.startActivityIndicator();var b=new App.Collections.shelfResource;b.deleteResource=1,b.resourceId=this.model.get("_id"),b.fetch({async:!1}),b.each(function(a){a.set({hidden:!1}),a.save()}),App.stopActivityIndicator();var c=new App.Models.Resource({_id:this.model.get("_id")});c.fetch({async:!1}),this.model=c,this.render()},"click .trigger-modal":function(){$("#myModal").modal({show:!0})},"click .resFeedBack":function(a){var b=new App.Collections.ResourcesFrequency;if(b.memberID=$.cookie("Member._id"),b.fetch({async:!1}),0==b.length){var c=new App.Models.ResourceFrequency;return c.set("memberID",$.cookie("Member._id")),c.set("resourceID",[this.model.get("_id")]),c.set("reviewed",[0]),c.set("frequency",[1]),void c.save()}var c=b.first(),d=c.get("resourceID").indexOf(this.model.get("_id").toString());if(-1==d)return c.get("resourceID").push(this.model.get("_id")),c.get("frequency").push(1),c.get("reviewed")?c.get("reviewed").push(0):c.set("reviewed",[0]),void c.save();var e=c.get("frequency");e[d]=e[d]+1,c.save(),$("ul.nav").html($("#template-nav-logged-in").html()).hide(),Backbone.history.navigate("resource/feedback/add/"+this.model.get("_id")+"/"+this.model.get("title"),{trigger:!0})}},vars:{},template:_.template($("#template-ResourceRow").html()),initialize:function(a){this.model.on("destroy",this.remove,this)},render:function(){var a=this.model.toJSON(),b="";if(void 0!=a.author&&""!=a.author&&(b=b+"<b>Author </b>"+a.author+" , "),void 0!=a.Year&&""!=a.Year&&(b=b+"<b>Year </b>"+a.Year+" , "),void 0!=a.openWith&&(b+="<b>Media </b>",b=b+a.openWith+" , "),void 0!=a.language&&a.language.length>0&&(b=b+"<b>Language </b>"+a.language+" , "),void 0!=a.subject){if(b+="<b>Subject(s) </b>",$.isArray(a.subject))for(var c=0;c<a.subject.length;c++)b=b+a.subject[c]+" / ";else b=b+a.subject+" / ";b=b.substring(0,b.length-3),b+=" , "}if(void 0!=a.Level){if(b+="<b>Level(s) </b>",$.isArray(a.Level))for(var c=0;c<a.Level.length;c++)b=b+a.Level[c]+" / ";else b=b+a.Level+" / ";b=b.substring(0,b.length-3),b+=" , "}if(void 0!=a.Publisher&&""!=a.Publisher&&(b=b+"<b>Publisher/Attribution </b>"+a.Publisher+" , "),void 0!=a.linkToLicense&&""!=a.linkToLicense&&(b=b+"<b>Link To License </b>"+a.linkToLicense+" , "),void 0!=a.resourceFor&&""!=a.resourceFor&&(b=b+"<b> Resource For </b>"+a.resourceFor+" , "),void 0!=a.resourceType&&""!=a.resourceType&&(b=b+"<b> Resource Type </b>"+a.resourceType+" , "),void 0!=a.Tag)if($.isArray(a.Tag)){a.Tag.length>0&&(b+="<b>Collection </b>");for(var c=0;c<a.Tag.length;c++)void 0!=this.collections.get(a.Tag[c])&&(b=b+this.collections.get(a.Tag[c]).toJSON().CollectionName+" / ")}else"Add New"!=a.Tag&&(b=b+"<b>Collection </b>"+a.Tag+" / ");b=b.substring(0,b.length-3),b+=" , ",b=b.substring(0,b.length-3),a.Details=b,void 0==a.hidden&&(a.hidden=!1),0!=this.model.get("sum")?(a.totalRatings=this.model.get("timesRated"),a.averageRating=parseInt(this.model.get("sum"))/parseInt(a.totalRatings)):(a.averageRating="Sum not found",a.totalRatings=0),this.isManager>-1?a.Manager=1:a.Manager=0,1==this.displayCollec_Resources?a.removeFormCollection=1:a.removeFormCollection=0,this.$el.append(this.template(a))}})}),$(function(){App.Views.ResourcesDetail=Backbone.View.extend({authorName:null,tagName:"table",className:"btable btable-striped resourceDetail",sid:null,rid:null,events:{"click #DestroyShelfItem":function(a){var b=this.model.toJSON(),c=b._id,d=$.cookie("Member._id"),e=new App.Collections.shelfResource;e.resourceId=c,e.memberId=d,e.fetch({async:!1}),e.each(function(a){a.destroy()}),alert("Resource Successfully removed from Shelf "),Backbone.history.navigate("dashboard",{trigger:!0})}},initialize:function(){this.$el.append('<th colspan="2"><h6>Resource Detail</h6></th>')},SetShelfId:function(a,b){this.sid=a,this.rid=b},render:function(){var a=this.model.toJSON();this.$el.append("<tr><td>Title</td><td>"+a.title+"</td></tr>"),this.$el.append("<tr><td>Subject</td><td>"+a.subject+"</td></tr>"),this.$el.append("<tr><td>Tag</td><td>"+a.Tag+"</td></tr>"),this.$el.append("<tr><td>Level</td><td>"+a.Level+"</td></tr>"),a.author?this.$el.append("<tr><td>Author</td><td>"+a.author+"</td></tr>"):this.$el.append("<tr><td>Author</td><td>No Author Defined</td></tr>"),a._attachments?this.$el.append("<tr><td>Attachment</td><td><a class='btn open'  target='_blank' style='background-color:#1ABC9C;position: absolute;display: inline-block; line-height: 25px;margin-top: 35px;margin-left:-620px;width: 65px;height:26px;font-size: large' href='/apps/_design/bell/bell-resource-router/index.html#open/"+a._id+"'>View</a></td></tr>"):this.$el.append("<tr><td>Attachment</td><td>No Attachment</td></tr>"),this.$el.append('<tr><td colspan="2"><button class="btn btn-danger" id="DestroyShelfItem">Remove</button></td></tr>')}})}),$(function(){App.Views.ResourcesTable=Backbone.View.extend({tagName:"table",isAdmin:null,className:"table table-striped",events:{"click #backButton":function(a){this.collection.skip>0&&(this.collection.skip=parseInt(this.collection.skip)-20),this.collection.fetch({async:!1}),this.collection.length>0&&this.render()},"click #nextButton":function(a){this.collection.skip=parseInt(this.collection.skip)+20,this.collection.fetch({async:!1}),this.collection.length>0&&this.render()},"click .clickonalphabets":function(a){this.collection.skip=0;var b=$(a.target).text();this.collection.startkey=b,this.collection.fetch({async:!1}),this.collection.length>0&&this.render()},"click #allresources":function(a){this.collection.startkey="",this.collection.skip=0,this.collection.fetch({async:!1}),this.collection.length>0&&this.render()},"click .pageNumber":function(a){this.collection.startkey="",this.collection.skip=a.currentTarget.attributes[0].value,this.collection.fetch({async:!1}),this.collection.length>0&&this.render()}},initialize:function(){},addOne:function(a){var b=new App.Views.ResourceRow({model:a,admin:this.isAdmin});b.isManager=this.isManager,b.displayCollec_Resources=this.displayCollec_Resources,b.collections=this.collections,b.render(),this.$el.append(b.el)},addAll:function(){0==this.collection.length&&this.$el.append("<tr><td width: 630px;>No resource found</td><td></td><td></td><td></td><td></td><td></td><td></td></tr>"),this.isadmin>-1?this.isAdmin=1:this.isAdmin=0,this.collection.forEach(this.addOne,this)},render:function(){if(1!=this.displayCollec_Resources&&(this.$el.html(""),void 0==this.removeAlphabet)){var a="<tr></tr>";a+="<tr><td colspan=7  style='cursor:default' >",a+='<a  id="allresources">#</a>&nbsp;&nbsp;';for(var b="ABCDEFGHIJKLMNOPQRSTUVWXYZ",c=0;c<b.length;c++){var d=b.charAt(c);a+='<a  class="clickonalphabets"  value="'+d+'">'+d+"</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"}a+="</td></tr>",this.$el.append(a)}this.$el.append("<br/><br/>"),this.$el.append("<tr><th style='width: 430px;'>Title</th><th colspan='6'>Actions</th></tr>"),this.addAll();var e="<tr><td>";0!=this.collection.skip&&(e+='<a class="btn btn-success" id="backButton" >Back</a>&nbsp;&nbsp;'),this.collection.length>=20&&(e+='<a class="btn btn-success" id="nextButton">Next</a>'),e+="</td></tr>",this.$el.append(e);var f,g=this;void 0==this.removeAlphabet&&$.ajax({url:"/resources/_design/bell/_view/count?group=false",type:"GET",dataType:"json",success:function(a){if(a.rows[0]&&(f=a.rows[0].value),1!=g.displayCollec_Resources){for(var b="<tr><td colspan=7><p style='width: 940px; word-wrap: break-word;'>",c=f/20,d=0;c>d;d++)b+=0==d?'<a  class="pageNumber" value="'+20*d+'">Home</a>&nbsp&nbsp':'<a  class="pageNumber" value="'+20*d+'">'+d+"</a>&nbsp&nbsp";b+="</p></td></tr>",g.$el.append(b)}}})}})}),$(function(){App.Views.Search=Backbone.View.extend({events:{"keypress #searchText":"SearchByEnter","click #searchR":"searchResult","click #addRestoPub":"addResourceToPublication","click #next_button":function(a){App.startActivityIndicator(),this.groupresult.skip=this.groupresult.skip+20,this.groupresult.fetch({async:!1}),App.stopActivityIndicator();var b=this;if(this.groupresult.length>0){var c=new App.Views.SearchSpans({collection:this.groupresult});c.resourceids=b.resourceids,c.render(),$("#srch").html(c.el),$("#previous_button").show(),this.groupresult.length<20&&$("#next_button").hide()}else this.groupresult.skip=this.groupresult.skip-20,$("#next_button").hide()},"click #previous_button":function(a){App.startActivityIndicator(),this.groupresult.skip=this.groupresult.skip-20,this.groupresult.fetch({async:!1}),App.stopActivityIndicator();var b=this;if(this.groupresult.length>0){var c=new App.Views.SearchSpans({collection:this.groupresult});c.resourceids=b.resourceids,c.render(),$("#srch").html(c.el),$("#next_button").show()}else $("#previous_button").hide();this.groupresult.skip<=0&&$("#previous_button").hide()}},template:$("#template-Search").html(),vars:{},groupresult:null,resultArray:null,initialize:function(){this.groupresult=new App.Collections.Resources,this.resultArray=[],enablenext=0},SearchByEnter:function(a){13==a.keyCode&&(1==this.vars.addResource?this.searchResult():ResourceSearch())},render:function(){var a=App.collectionslist;this.vars.tags=a.toJSON(),this.vars.addResource=this.addResource,"undefined"!=typeof this.Publications?this.vars.Publications=this.Publications:this.vars.Publications=!1,this.$el.html(_.template(this.template,this.vars)),(""!=searchText||this.collectionFilter||this.subjectFilter||this.levelFilter||this.languageFilter||this.mediumFilter||this.ratingFilter&&this.ratingFilter.length>0)&&(App.startActivityIndicator(),this.getSearchedRecords())},getSearchedRecords:function(){var a={},b=new Array;if(this.collectionFilter&&""==searchText.replace(" ","")&&!this.subjectFilter)for(var c=0;c<this.collectionFilter.length;c++)b.push(this.collectionFilter[c]);else this.collectionFilter&&(""!=searchText.replace(" ","")||this.subjectFilter)&&(a.Tag=this.collectionFilter);if(this.subjectFilter&&""==searchText.replace(" ",""))for(var c=0;c<this.subjectFilter.length;c++)b.push(this.subjectFilter[c].toLowerCase());else this.subjectFilter&&""!=searchText.replace(" ","")&&(a.subject=this.subjectFilter);if(!this.levelFilter||this.languageFilter||""!=searchText.replace(" ","")||this.subjectFilter||this.collectionFilter)this.levelFilter&&(this.languageFilter||""!=searchText.replace(" ","")||this.subjectFilter||this.collectionFilter)&&(a.Level=this.levelFilter);else for(var c=0;c<this.levelFilter.length;c++)b.push(this.levelFilter[c].toLowerCase());if(!this.mediumFilter||this.levelFilter||this.languageFilter||""!=searchText.replace(" ","")||this.subjectFilter||this.collectionFilter)this.mediumFilter&&(this.levelFilter||this.languageFilter||""!=searchText.replace(" ","")||this.subjectFilter||this.collectionFilter)&&(a.Medium=this.mediumFilter);else for(var c=0;c<this.mediumFilter.length;c++)b.push(this.mediumFilter[c].toLowerCase());if(!this.languageFilter||""!=searchText.replace(" ","")||this.subjectFilter||this.collectionFilter)this.languageFilter&&(""!=searchText.replace(" ","")||this.subjectFilter||this.collectionFilter)&&(a.language=this.languageFilter);else for(var c=0;c<this.languageFilter.length;c++)b.push(this.languageFilter[c]);if(!(this.ratingFilter.length>0)||this.mediumFilter||this.levelFilter||this.languageFilter||""!=searchText.replace(" ","")||this.subjectFilter||this.collectionFilter)this.ratingFilter.length>0&&(this.mediumFilter||this.levelFilter||this.languageFilter||""!=searchText.replace(" ","")||this.subjectFilter||this.collectionFilter)&&(a.timesRated=this.ratingFilter);else for(var c=0;c<this.ratingFilter.length;c++)b.push(parseInt(this.ratingFilter[c]));var d,e,f,g,h=[];if(""!=searchText){d=searchText.replace(/[!(.,'";):&]+/gi,"").toLowerCase(),b.push(d),$.ajax({url:'/collectionlist/_design/bell/_view/collectionByName?_include_docs=true&key="'+d+'"',type:"GET",dataType:"json",success:function(a){console.log(a),a.rows.length>0&&(g=a.rows[0].id,b.push(g))},error:function(){alert("Unable to get collections.")},async:!1}),f=searchText.replace(/[" "-]+/gi,"").toLowerCase(),null!=f&&b.push(f),d=searchText.replace(/[!(.,;'"):&]+/gi,"").toLowerCase(),e=d.replace(/[-]+/gi," "),b.push(e),d=d.replace(/[-]+/gi," ").split(" "),h=d;for(var i in d)" "!=d[i]&&""!=d[i]&&"the"!=d[i]&&"an"!=d[i]&&"a"!=d[i]&&"and"!=d[i]&&"&"!=d[i]&&b.push(d[i])}var j=JSON.stringify(b);console.log(j),this.groupresult.skip=0,this.groupresult.collectionName=j,this.groupresult.fetch({async:!1});var k;if(this.groupresult.models.length>0&&!this.isEmpty(a)){var l=this.groupresult.models;k=this.checkANDConditions(a,l)}if(this.groupresult.models.length>0&&""!=searchText&&this.isEmpty(a)){if(null!=g||void 0!=g)var m=g;var n=this.groupresult.models;k=this.checkSearchTextCompleteMatch(h,m,n)}null!=k&&(this.groupresult.models=k,0==k.length?this.groupresult.length=0:this.groupresult.length=k.length),App.stopActivityIndicator();var o=this;if(1==o.addResource){if(this.groupresult.length>0){var p=new App.Views.SearchSpans({collection:this.groupresult});p.resourceids=o.resourceids,p.render(),$("#srch").append(p.el)}}else{var q=App.member,r=q.get("roles"),s=new App.Views.ResourcesTable({collection:this.groupresult});s.removeAlphabet=!0,s.isManager=r.indexOf("Manager"),s.resourceids=o.resourceids,s.collections=App.collectionslist,s.render(),$("#srch").html('<h4>Search Result <a style="float:right" class="btn btn-info" onclick="backtoSearchView()">Back To Search</a></h4>'),$("#srch").append(s.el)}},isEmpty:function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},checkANDConditions:function(a,b){for(var c,d=[],e=0;e<b.length;e++){c=[];var f=b[e];for(var g in a){var h=a[g];if(Array.isArray(f.attributes[g])){for(var i=!1,j=0;j<h.length;j++){var k=h[j];f.attributes[g].indexOf(k)>-1&&(i=!0)}c.push(i)}else{var l=!1;if("timesRated"!=g)for(var m=0;m<h.length;m++){var k=h[m];f.attributes[g]==k&&(l=!0)}else for(var m=0;m<h.length;m++){var k=h[m],n=Math.ceil(f.attributes.sum/f.attributes[g]);n==k&&(l=!0)}c.push(l)}}-1==c.indexOf(!1)&&d.push(f)}return d},checkSearchTextCompleteMatch:function(a,b,c){for(var d,e,f,g,h=[],i=0;i<c.length;i++){d=[],e=[],f=[],g=[];for(var j=c[i],k=0;k<a.length;k++){j.attributes.title.toLowerCase().indexOf(a[k])>-1||j.attributes.title.replace(/[!(.," "-;):]+/g,"").toLowerCase().indexOf(a[k])>-1||j.attributes.title.replace(/[!(.,-;):]+/g," ").toLowerCase().indexOf(a[k])>-1?e.push(!0):e.push(!1),j.attributes.Publisher.toLowerCase().indexOf(a[k])>-1||j.attributes.Publisher.replace(/[!(.," "-;):]+/g,"").toLowerCase().indexOf(a[k])>-1||j.attributes.Publisher.replace(/[!(.,-;):]+/g," ").toLowerCase().indexOf(a[k])>-1?f.push(!0):f.push(!1),j.attributes.author.toLowerCase().indexOf(a[k])>-1||j.attributes.author.replace(/[!(.," "-;):]+/g,"").toLowerCase().indexOf(a[k])>-1||j.attributes.author.replace(/[!(.,-;):]+/g," ").toLowerCase().indexOf(a[k])>-1?g.push(!0):g.push(!1);for(var l=0;l<j.attributes.subject.length;l++)(j.attributes.subject[l].toLowerCase().indexOf(a[k])>-1||j.attributes.subject[l].replace(/[!(.," "-;):]+/g,"").toLowerCase().indexOf(a[k])>-1||j.attributes.subject[l].replace(/[!(.,-;):]+/g," ").toLowerCase().indexOf(a[k])>-1)&&d.push(!0);if(j.attributes.Tag)for(var m=0;m<j.attributes.Tag.length;m++)j.attributes.Tag[m].indexOf(b)>-1&&d.push(!0)}(-1==e.indexOf(!1)||-1==f.indexOf(!1)||-1==g.indexOf(!1))&&d.push(!0),d.indexOf(!0)>-1&&h.push(j)}return h},addResourceToStepView:function(){var a=this,b=new Backbone.Collection;if(a.resultArray.length>0){b.set(a.resultArray);var c=new App.Views.SearchSpans({collection:b});c.resourceids=a.resourceids,c.render(),$("#srch").append(c.el)}},searchResult:function(){searchText=$("#searchText").val();var a=new Array,b=new Array,c=new Array;ratingFilter.length=0,a=$("#multiselect-collections-search").val(),b=$("#multiselect-subject-search").val(),c=$("#multiselect-levels-search").val(),mediumFilter=$("#multiselect-medium-search").val(),$("input[name='star']").each(function(){$(this).is(":checked")&&ratingFilter.push($(this).val())}),(""!=searchText||a||b||c||mediumFilter||ratingFilter&&ratingFilter.length>0)&&(this.collectionFilter=a,this.levelFilter=c,this.subjectFilter=b,this.ratingFilter=ratingFilter,this.mediumFilter=mediumFilter,this.addResource=!0,App.$el.children(".body").html(search.el),this.render(),$("#searchText2").val(searchText),$("#srch").show(),$(".row").hide(),$(".search-bottom-nav").show(),$(".search-result-header").show(),$("#selectAllButton").show()),$("#previous_button").hide(),$("#searchText").focus(),$("#searchText").val(searchText)},addResourceToPublication:function(){"undefined"==typeof grpId&&(document.location.href="../nation/index.html#publication");var a=new Array,b=new App.Models.Publication({_id:grpId});b.fetch({async:!1}),$("input[name='result']").each(function(){if($(this).is(":checked")){var c=$(this).val();null!=b.get("resources")?(a=b.get("resources"),a.indexOf(c)<0&&a.push(c)):a.push(c)}}),b.set("resources",a),b.save(),b.on("sync",function(){alert("Your Resources have been added successfully"),window.location="../nation/index.html#publicationdetail/"+b.get("_id")})}})}),$(function(){App.Views.SearchSpan=Backbone.View.extend({tagName:"tr",className:"search-box",template:$("#template-Search-box").html(),render:function(){var a=this.model.toJSON();a.Tag||(a.Tag=""),a.name?(a.title="CourseSearchBox",a.Tag="CourseSearchBox"):a.name="ResourceSearchBox",this.$el.append(_.template(this.template,a))}})}),$(function(){App.Views.SearchSpans=Backbone.View.extend({addOne:function(a){this.resourceids?-1==$.inArray(a.get("id"),this.resourceids)&&this.renderView(a):this.renderView(a)},renderView:function(a){var b=new App.Views.SearchSpan({model:a});b.render(),this.$el.append(b.el)},addAll:function(){this.collection.each(this.addOne,this)},render:function(){this.addAll()}})}),$(function(){App.Views.ShelfSpan=Backbone.View.extend({tagName:"td",className:"shelf-box",template:$("#template-ShelfSpan").html(),render:function(){var a=this.model.toJSON();alert("test"),console.log(a),alert("shelf span in"),this.$el.append(_.template(this.template,a))}})}),$(function(){App.Views.ShelfSpans=Backbone.View.extend({tagName:"tr",render:function(){var a=!0,b=!0;for(var c in App.ShelfItems){a=!1;break}a||($.each(App.ShelfItems,function(a,b){var c=b.toString().split("+");"true"!=c[0]&&$("#ur").append('<td class="shelf-box"><a href="#resource/detail/'+a+"/"+c[2]+"/"+c[3]+'">'+c[1]+"</a></td>")}),$.each(App.ShelfItems,function(a,c){var d=c.toString().split("+");"true"!=d[0]&&(b=!1)})),b&&$("#ur").append('<td class="shelf-box">No Item In the Shelf</td>')}})}),$(function(){App.Views.TrendActivityReport=Backbone.View.extend({vars:{},events:{},template:$("#template-TrendActivityReport").html(),initialize:function(){},render:function(){var a=this;a.vars=a.data,a.vars.startDate=a.startDate,a.vars.endDate=a.endDate,a.vars.CommunityName=a.CommunityName,a.$el.html(_.template(a.template,a.vars))}})}),$(function(){App.Views.TutorSpan=Backbone.View.extend({tagName:"td",className:"tutor-box",template:$("#template-Tutor").html(),render:function(){if("821d357b8f3ba3c09836c91bebcb29d7"==$.cookie("Member._id")){var a={};a.leaderEmail=this.model,a._id="none"}else{var a=this.model.toJSON();a.leaderEmail||(a.leaderEmail="Undefined")}this.$el.append(_.template(this.template,a))}})}),$(function(){App.Views.TutorsSpans=Backbone.View.extend({tagName:"tr",addOne:function(a){var b=new App.Views.TutorSpan({model:a});b.render(),$("#tutorTable").append(b.el)},addAll:function(){if("821d357b8f3ba3c09836c91bebcb29d7"==$.cookie("Member._id"))for(var a=["English","Algebra","Midwifery"],b=0;3>b;b++)this.addOne(a[b],this);else 0!=this.collection.length?this.collection.each(this.addOne,this):$("#tutorTable").append("<td class='course-box'>No Tutor</td>")},render:function(){$("#tutorTable").append("<td class='course-box'> functionality is under construction </td>")}})}),$(function(){window.isActivityLogChecked=!1,App.Views.listSyncDbView=Backbone.View.extend({id:"invitationForm",events:{"click #cancelButton":"hidediv","click #formButton":"syncData","click #selectAll":"selectAll"},hidediv:function(){$("#invitationdiv").fadeOut(1e3),setTimeout(function(){$("#invitationdiv").hide()},1e3)},render:function(){var a=$('<h6>Select Item(\'s) To Sync</h6><br><br><input type="checkbox" value="ActivityReports" name="syncData">Log Activity Reports<br><input type="checkbox" value="Reports" name="syncData">Reports<br><input type="checkbox" value="ResourcesFeedbacks" name="syncData">Resources Feedbacks<br><input type="checkbox" value="ApplicationFeedbacks" name="syncData">Application Feedbacks<br><input type="checkbox" value="MembersDb" name="syncData">Members Database<br>');this.$el.append(a),this.$el.append('<button class="btn btn-info" id="selectAll" style="width:110px">Select All</button><button style="margin-left:10px; width:110px" class="btn btn-success" id="formButton" style="width:110px">Send</button>'),this.$el.append('<button class="btn btn-warning" id="cancelButton" style="width:110px;margin-left:10px">Cancel</button>')},selectAll:function(){"Select All"==$("#selectAll").text()?($("input[name='syncData']").each(function(){$(this).prop("checked",!0)}),$("#selectAll").text("Unselect All")):($("input[name='syncData']").each(function(){$(this).prop("checked",!1)}),$("#selectAll").text("Select All"))},syncData:function(){var a=this;App.startActivityIndicator(),$("input[name='syncData']").each(function(){$(this).is(":checked")&&("Resources"==$(this).val()?a.ReplicateResource():"ActivityReports"==$(this).val()?(isActivityLogChecked=!0,a.syncLogActivitiy()):"Reports"==$(this).val()?a.syncReports():"ResourcesFeedbacks"==$(this).val()?a.syncResourcesFeedbacks():"ApplicationFeedbacks"==$(this).val()?a.syncApplicationFeedbacks():"MembersDb"==$(this).val()&&a.syncMembersDb(),"Application"==$(this).val()&&a.checkAvailableUpdates())}),$("#invitationdiv").fadeOut(1e3),setTimeout(function(){$("#invitationdiv").hide()},1e3)},ReplicateResource:function(){App.startActivityIndicator();var a=this,b=($.url().attr("host").split("."),$.url().attr("host"),""),c="",d="",e=Backbone.Collection.extend({url:App.Server+"/configurations/_all_docs?include_docs=true"}),f=new e;f.fetch({async:!1});var g=f.first(),h=g.toJSON();d=h.rows[0].doc.type,b=h.rows[0].doc.nationUrl,c=h.rows[0].doc.nationName,App.$el.children(".body").html("Please Wait");var i="",j="";$.ajax({url:"http://"+c+":"+App.password+"@"+b+":5984/communities/_all_docs?include_docs=true",type:"GET",dataType:"jsonp",success:function(e){for(var f=0;f<e.rows.length;f++){var g=e.rows[f],h=g.doc.url,k=g.doc.name;j=i,i=i+"<br>Replicating to "+k+". Please wait",App.$el.children(".body").html(i),a.synchCommunityWithURL(h,k),i=j,i=i+"<br>Replication to "+k+" is complete.",App.$el.children(".body").html(i)}"nation"!=d&&(j=i,i=i+"<br>Replicating to "+k+". Please wait",a.synchCommunityWithURL(b,c),i=j,i=i+"<br>Replication to "+k+" is complete.<br>Replication completed.")}})},synchCommunityWithURL:function(a,b){console.log("http://"+b+":"+App.password+"@"+a+":5984/resources"),$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"resources",target:"http://"+b+":"+App.password+"@"+a+":5984/resources"}),success:function(a){},async:!1})},syncReports:function(){$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",
data:JSON.stringify({source:"communityreports",target:"http://"+App.configuration.get("nationName")+":"+App.password+"@"+App.configuration.get("nationUrl")+"/communityreports"}),success:function(a){alert("Successfully Replicated Reports"),0==isActivityLogChecked&&App.stopActivityIndicator()},error:function(a,b,c){alert("Error (Try Later)")}})},syncLogActivitiy:function(){$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"activitylog",target:"http://"+App.configuration.get("nationName")+":"+App.password+"@"+App.configuration.get("nationUrl")+"/activitylog"}),success:function(a){$.ajax({url:"http://"+App.configuration.get("nationName")+":oleoleole@"+App.configuration.get("nationUrl")+'/community/_design/bell/_view/getCommunityByCode?_include_docs=true&key="'+App.configuration.get("code")+'"',type:"GET",dataType:"jsonp",success:function(a){var b=a.rows[0].value,c=a.rows[0].id;$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"http://"+App.configuration.get("nationName")+":oleoleole@"+App.configuration.get("nationUrl")+"/community",target:"community",doc_ids:[c]}),success:function(a){console.log("Successfully Replicated.");var d=new Date,e=d.getFullYear(),f=(1+d.getMonth()).toString();f=f.length>1?f:"0"+f;var g=d.getDate().toString();g=g.length>1?g:"0"+g;b.lastActivitiesSyncDate=f+"/"+g+"/"+e,$.ajax({headers:{Accept:"application/json","Content-Type":"multipart/form-data"},type:"PUT",url:App.Server+"/community/"+c+"?rev="+b._rev,dataType:"json",data:JSON.stringify(b),success:function(a){$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"community",target:"http://"+App.configuration.get("nationName")+":oleoleole@"+App.configuration.get("nationUrl")+"/community",doc_ids:[c]}),success:function(a){alert("Successfully Replicated Log Activity Reports"),App.stopActivityIndicator()},async:!1})},async:!1})},async:!1})},error:function(){console.log("http://"+nationName+":oleoleole@"+nationURL+'/community/_design/bell/_view/getCommunityByCode?key="'+App.configuration.get("code")+'"')}})},error:function(a,b,c){alert("Error (Try Later)")}})},syncResourcesFeedbacks:function(){$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"feedback",target:"http://"+App.configuration.get("nationName")+":"+App.password+"@"+App.configuration.get("nationUrl")+"/feedback"}),success:function(a){alert("Successfully Replicated Resources Feedbacks"),0==isActivityLogChecked&&App.stopActivityIndicator()},error:function(a,b,c){alert("Error (Try Later)")}})},syncApplicationFeedbacks:function(){$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"report",target:"http://"+App.configuration.get("nationName")+":"+App.password+"@"+App.configuration.get("nationUrl")+"/report"}),success:function(a){alert("Successfully Replicated Application Feedbacks"),0==isActivityLogChecked&&App.stopActivityIndicator()},error:function(a,b,c){alert("Error (Try Later)")}})},syncMembersDb:function(){$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"members",target:"http://"+App.configuration.get("nationName")+":"+App.password+"@"+App.configuration.get("nationUrl")+"/members",filter:"bell/adminFilter"}),success:function(a){alert("Members database replicated."),0==isActivityLogChecked&&App.stopActivityIndicator()},error:function(a,b,c){alert("Error (Try Later)")}})},versionCompare:function(a,b,c){function d(a){return(e?/^\d+[A-Za-z]*$/:/^\d+$/).test(a)}var e=c&&c.lexicographical;if(zeroExtend=c&&c.zeroExtend,v1parts=a.split("."),v2parts=b.split("."),!v1parts.every(d)||!v2parts.every(d))return NaN;if(zeroExtend){for(;v1parts.length<v2parts.length;)v1parts.push("0");for(;v2parts.length<v1parts.length;)v2parts.push("0")}e||(v1parts=v1parts.map(Number),v2parts=v2parts.map(Number));for(var f=0;f<v1parts.length;++f){if(v2parts.length==f)return 1;if(v1parts[f]!=v2parts[f])return v1parts[f]>v2parts[f]?1:-1}return v1parts.length!=v2parts.length?-1:0},checkAvailableUpdates:function(){var a,b=this,c=new App.Collections.Configurations;c.fetch({success:function(b){a=b.first()},async:!1});var d=a.get("nationName"),e=a.get("nationUrl"),f="http://"+d+":oleoleole@"+e+":5984/configurations/_all_docs?include_docs=true";$.ajax({url:f,type:"GET",dataType:"jsonp",success:function(c){var d=c.rows[0].doc;nationConfigJson=d,"undefined"==typeof d.version||d.version==a.get("version")||(b.versionCompare(d.version,a.get("version"))<0?console.log("Nation is at low level"):b.versionCompare(d.version,a.get("version"))>0?b.updateApp():console.log("Nation is uptodate"))}})},updateApp:function(){var a=Backbone.Collection.extend({url:App.Server+"/configurations/_all_docs?include_docs=true"}),b=new a;b.fetch({async:!1});var c=b.first().toJSON().rows[0].doc;c.version=this.latestVersion;var d=c.nationName,e=c.nationUrl;$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"http://"+d+":oleoleole@"+e+":5984/apps",target:"apps"}),success:function(a){console.log(a)},async:!1}),$.ajax({headers:{Accept:"application/json","Content-Type":"multipart/form-data"},type:"PUT",url:App.Server+"/configurations/"+c._id+"?rev="+c._rev,dataType:"json",data:JSON.stringify(c),success:function(a){console.log(a),alert("Successfully updated to latest version.")},async:!1})}})}),$(function(){App.Views.meetupView=Backbone.View.extend({authorName:null,tagName:"table",className:"btable btable-striped",initialize:function(){this.$el.html('<h3 colspan="20">Meetup | '+this.model.get("title")+"</h3>")},events:{"click  #joinMeetUp":"joinMeetUp","click #meetupsInvitation":"MemberInvite"},MemberInvite:function(){$("#invitationdiv").fadeIn(1e3),document.getElementById("cont").style.opacity=.1,document.getElementById("nav").style.opacity=.1,$("#invitationdiv").show();var a=new App.Models.InviMeetup;a.resId=this.model.get("_id"),a.senderId=$.cookie("Member._id"),a.type=this.model.get("kind"),a.title=this.model.get("title"),a.description=this.model.get("description");var b=new App.Views.MeetupInvitation({model:a});b.render(),$("#invitationdiv").html("&nbsp"),$("#invitationdiv").append(b.el)},add:function(a){},joinMeetUp:function(){var a=new App.Collections.UserMeetups;if(a.memberId=$.cookie("Member._id"),a.meetupId=this.model.get("_id"),a.fetch({async:!1}),a.length>0)return void alert("Your have already joined this Meetup");var b=new App.Models.UserMeetup;b.set("memberId",$.cookie("Member._id")),b.set("meetupId",this.model.get("_id")),b.set("meetupTitle",this.model.get("title")),b.save(),alert("successfully Added to your Meetups"),Backbone.history.navigate("dashboard",{trigger:!0})},render:function(){$("#invitationdiv").hide();var a=this.model.toJSON(),b=new Date(a.schedule);a.schedule=b.toUTCString(),this.$el.append("<tr><td><b>Title  </b></td><td>"+a.title+"   ("+a.category+")</td></tr>"),this.$el.append("<tr><td><b>Category  </b></td><td>"+a.category+"</td></tr>"),this.$el.append("<tr><td><b>Description </b></td><td>"+a.description+"</td></tr>"),this.$el.append("<tr><td><b>Location </b></td><td>"+a.meetupLocation+"</td></tr>"),this.$el.append("<tr><td><b>Date </b></td><td>"+a.startDate+" --- "+a.endDate+"</td></tr>"),this.$el.append("<tr><td><b>Time </b></td><td>"+a.startTime+" --- "+a.endTime+"</td></tr>"),this.$el.append('<tr><td><a class="btn btn-success" id="joinMeetUp">Join Meetup</a><a style="margin-left:20px" class="btn btn-info" id="meetupsInvitation">Invite Members</a><a style="margin-left:20px" class="btn btn-info" href="#meetups">Back</a></td><td></td></tr>')}})}),$(function(){App.Views.navBarView=Backbone.View.extend({tagName:"ul",className:"nav",id:"itemsinnavbar",authorName:null,template1:_.template($("#template-nav-logged-in").html()),template0:_.template($("#template-nav-log-in").html()),initialize:function(a){0==a.isLoggedIn?this.template=this.template0:this.template=this.template1;var b=Backbone.history.location.href;b=b.split("#");var c="";if(!App.configuration){var d=new App.Collections.Configurations;d.fetch({async:!1});var e=d.first();App.configuration=e}if(!App.languageDict){var f=App.configuration.get("currentLanguage"),g=new App.Collections.Languages;g.fetch({async:!1});var h=g.first().toJSON();h[f];App.languageDict=h[f]}if(c=App.configuration.get("version"),this.data={uRL:b[1],versionNO:c,languageDict:App.languageDict},this.$el.append(this.template(this.data)),!App.member&&$.cookie("Member._id")){var i=new App.Models.Member;i.set("_id",$.cookie("Member._id")),i.fetch({async:!1,success:function(a,b){App.member=a},error:function(){App.Router.expireSession(),Backbone.history.stop(),App.start()}})}},render:function(){}})}),$(function(){App.Views.siteFeedback=Backbone.View.extend({tagName:"div",id:"site-feedback",authorName:null,initialize:function(){},events:{"click #formButton":"setForm","click #CancelButton":"cancelform","click #ViewAllButton":"gotoRoute"},gotoRoute:function(){Backbone.history.navigate("siteFeedback",{trigger:!0})},cancelform:function(){$("#site-feedback").animate({height:"toggle"}),this.unsetForm()},setForm:function(){if(0!=$("#comment").val().length&&$('input[name="category"]:checked').val()){var a=Backbone.history.location.href,b=new Date;b.getDate(),a=a.split("#");var c="";$("#priority").is(":checked")&&(c="urgent"),this.model.set({comment:$("#comment").val(),category:$('input[name="category"]:checked').val(),priority:c,PageUrl:"Personal:"+a[1],Resolved:"0",memberLogin:$.cookie("Member.login"),time:b.toString(),communityCode:App.configuration.get("code")}),this.model.save(),alert("Feedback Successfully Sent"),this.unsetForm()}$("#site-feedback").animate({height:"toggle"})},unsetForm:function(){$("#comment",this.$el).val(""),$('input[name="category"]').attr("checked",!1),$("#priority").attr("checked",!1)},render:function(){this.$el.append('<br/><br/><div class="form-field" ><input name="PageUrl" id="PageUrl" type="text"></div>'),this.$el.append('<div class="form-field" style="margin-left:23px;"><input name="priority" value="urgent" id="priority" type="checkbox"><label for="priority">urgent</label></div>'),this.$el.append('<div class="form-field" style="margin-top: -19px;margin-left: 115px;"> <input type="radio" name="category" value="Bug">&nbsp Bug &nbsp&nbsp&nbsp<input type="radio" name="category" value="Question">&nbsp Question &nbsp&nbsp&nbsp<input type="radio" name="category" value="Suggestion">&nbsp Suggestion &nbsp&nbsp&nbsp</div><br/><br/>'),this.$el.append('<div class="form-field" style="margin-left:23px;"><textarea rows="7" type="text" name="comment" placeholder="Give us your feedback on the current page ... " id="comment"></textarea></div>'),this.$el.append('<div class="form-field"><input name="Resolved" id="Resolved" type="text"></div>'),this.$el.append('<div class="form-field"><input name="memberLogin" id="memberLogin" type="text"></div>'),this.$el.append('<div class="form-field"><input name="time" id="time" type="text"></div>'),$("#PageUrl",this.$el).hide(),$("#Resolved",this.$el).hide(),$("#memberLogin",this.$el).hide(),$("#time",this.$el).hide();var a=$('<br/><div id="f-formButton"><button class="btn btn-hg btn-danger" id="CancelButton">Cancel</button><button class="btn btn-hg btn-info" id="ViewAllButton">View</button><button class="btn btn-hg btn-primary" id="formButton">Submit</button></div>');this.$el.append(a)}})}),$(function(){App.Views.siteFeedbackPage=Backbone.View.extend({tagName:"table",className:" table-feedback notification-table table-striped",authorName:null,searchText:null,Resolved:null,stack:null,category:null,urgent:null,applyFilters:null,resultArray:null,events:{"click #see-all":function(a){for(this.applyFilters="0";skipStack.length>0;)skipStack.pop();searchText="",this.resultArray=[],skip=0,skipStack.push(skip),this.fetchRecords()},"click #switch":function(a){for(this.applyFilters="1",this.category=$("#select_category").val(),this.urgent=$("#select_urgent").val(),"Resolved"==$("#select_status").val()?this.Resolved="1":this.Resolved="0";skipStack.length>0;)skipStack.pop();searchText="",this.resultArray=[],skip=0,skipStack.push(skip),this.fetchRecords()},"click #search_feedback":function(a){if(this.applyFilters="0",searchText=$("#searchText").val(),""!=searchText){for(;skipStack.length>0;)skipStack.pop();this.resultArray=[],skip=0,skipStack.push(skip),this.fetchRecords()}},"click #previousButton":function(a){skipStack.length>1?(skipStack.pop(),skip=skipStack.pop(),skipStack.push(skip),this.resultArray=[],this.fetchRecords()):$("#previousButton").hide()},"click #next_button":function(a){skipStack.push(skip),this.resultArray=[],this.fetchRecords()}},initialize:function(){this.resultArray=[],this.category="Bug",this.Resolved="1",this.applyFilters="0",this.searchText="","unknown"==url&&(url="siteFeedback"),null!=$("#comments")&&$("#debug").append('<div id="comments"></div>')},addAll:function(){this.$el.html('<h4>Keyword:&nbsp;<input class="form-control" type="text" placeholder="Search in comment" value="" size="30" id="searchText" style="height:24px;margin-top:1%;"></input>&nbsp;<span><button class="btn btn-info" id="search_feedback">Search</button>&nbsp;<button class="btn btn-info" id="see-all">See All</button></span>&nbsp;<img id="progress_img" src="vendor/progress.gif" width="3%"></h4><br/>'),this.$el.append('<Select id="select_category"><option>Bug</option><option>Question</option><option>Suggestion</option></select>&nbsp;&nbsp<select id="select_status"><option>Unresolve</option><option>Resolved</option></select>&nbsp;&nbsp<select id="select_urgent"><option>Normal</option><option>Urgent</option></select>&nbsp;&nbsp<button class="btn btn-info" id="switch">Apply Filters</button><br/><br/>'),this.$el.append("<th ><h4>Feedback</h4></th><th ><h4>Status</h4></th>"),$("#progress_img").hide(),console.log(this.collection.toJSON()),this.collection.forEach(this.addOne,this),this.$el.append('<br/><br/><input type="button" class="btn btn-hg btn-primary" id="previousButton" value="< Previous"> &nbsp;&nbsp;&nbsp;<button class="btn btn-hg btn-primary" id="next_button" >Next  ></button>')},addOne:function(a){if(a.get("category")||a.set("category","Bug"),a.get("priority")||a.set("priority",[]),"_design/bell"!=a.toJSON()._id){var b=new App.Views.siteFeedbackPageRow({model:a});b.render(),this.$el.append(b.el)}},render:function(){this.addAll(),skipStack.length<=1&&$("#previousButton").hide(),this.collection.length<5&&$("#next_button").hide()},fetchRecords:function(){$("#progress_img").show();var a=this;this.collection.fetch({success:function(){if(a.resultArray.push.apply(a.resultArray,a.searchInArray(a.collection.models,searchText)),a.resultArray.length!=limitofRecords&&a.collection.models.length==limitofRecords)return void a.fetchRecords();if(0==a.resultArray.length&&0==a.collection.models.length&&skipStack.length>1)return $("#next_button").hide(),void skipStack.pop();0==a.resultArray.length&&1==skipStack.length&&""!=searchText&&alert("No result found");var b=new App.Collections.siteFeedbacks;b.set(a.resultArray),a.collection=b,a.$el.html(""),a.render()}})},filterResult:function(a){var b=a.get("PageUrl");b||(b="");for(var c=b.split("/"),d=c[0],e=1;e<c.length;e++)32!=c[e].length?d=d+"/"+c[e]:e=b.length;return d==url?!0:(console.log(url),!1)},checkFilters:function(a){return console.log(a),this.filterResult(a)?"0"==this.applyFilters?!0:this.Resolved==a.get("Resolved")&&this.category==a.get("category")?"Normal"==this.urgent&&0==a.get("priority").length?!0:"Urgent"==this.urgent&&a.get("priority").length>0?!0:!1:!1:!1},searchInArray:function(a,b){var c=this,d=[];return _.each(a,function(a){null!=a.get("comment")&&(skip++,a.get("category")||a.set("category","Bug"),a.get("priority")||a.set("priority",[]),a.get("comment").toLowerCase().indexOf(b.toLowerCase())>=0&&c.checkFilters(a)?d.length<limitofRecords?d.push(a):(enablenext=1,skip--):d.length>=limitofRecords&&skip--)}),d}})}),$(function(){App.Views.siteFeedbackPageRow=Backbone.View.extend({template0:$("#template-siteReviewRowAdmin").html(),template1:$("#template-siteReviewRownoAdmin").html(),tagName:"tr",authorName:null,events:{"click #resolveButton":"resolve","click #commentButton":"comment"},comment:function(a){console.log(a.target.attributes[0].nodeValue);var b=new App.Collections.reportsComment;b.feedbackId=a.target.attributes[0].nodeValue,b.fetch({async:!1});var c=new App.Views.addComment({collection:b,commentId:a.target.attributes[0].nodeValue});c.render(),$("#debug").append(c.el)},resolve:function(a){console.log(a),a.preventDefault(),this.model.on("sync",function(){location.reload()}),this.model.save({Resolved:"1"},{success:function(){}})},initialize:function(){"admin"==$.cookie("Member.login")?this.template=this.template0:this.template=this.template1},render:function(){var a=this.model.toJSON();0==this.model.get("priority").length?a.urgent="Normal":a.urgent="Urgent",console.log(a),this.$el.html(_.template(this.template,a))}})}),$(function(){App.Views.siteFeedbackPageRow=Backbone.View.extend({template0:$("#template-siteReviewRowAdmin").html(),template1:$("#template-siteReviewRownoAdmin").html(),tagName:"tr",authorName:null,events:{"click #resolveButton":"resolve","click #commentButton":"comment"},comment:function(a){console.log(a.target.attributes[0].nodeValue);var b=new App.Collections.reportsComment;b.feedbackId=a.target.attributes[0].nodeValue,b.fetch({async:!1});var c=new App.Views.addComment({collection:b,commentId:a.target.attributes[0].nodeValue});c.render(),$("#debug").append(c.el)},resolve:function(a){console.log(a),a.preventDefault(),this.model.on("sync",function(){location.reload()}),this.model.save({Resolved:"1"},{success:function(){}})},initialize:function(){"admin"==$.cookie("Member.login")?this.template=this.template0:this.template=this.template1},render:function(){var a=this.model.toJSON();0==this.model.get("priority").length?a.urgent="Normal":a.urgent="Urgent",console.log(a),this.$el.html(_.template(this.template,a))}})}),$(function(){App.Views.takeQuizView=Backbone.View.extend({Questions:{},Optns:{},Score:0,Correctanswers:{},Givenanswers:new Array,index:-1,TotalCount:0,tagName:"form",id:"questionForm",mymodel:null,events:{"click #exitPressed":function(a){$("div.takeQuizDiv").hide(),document.getElementById("cont").style.opacity="1",document.getElementById("nav").style.opacity="1"},"click #finishPressed":function(a){$("div.takeQuizDiv").hide(),location.reload(),document.getElementById("cont").style.opacity="1",document.getElementById("nav").style.opacity="1"},"click #nextPressed":function(a){void 0!=$("input:radio[name='optn']:checked").val()?(this.Givenanswers.push(decodeURI($("input:radio[name='optn']:checked").val())),console.log(this.Givenanswers),console.log(this.Correctanswers),this.Givenanswers[this.index]==this.Correctanswers[this.index]&&(console.log("corre"),this.Score++),this.renderQuestion()):alert("no option selected")}},initialize:function(){this.Correctanswers=this.options.answers,this.Questions=this.options.questions,this.Optns=this.options.options,this.stepId=this.options.stepId,this.TotalCount=this.Questions.length,this.pp=parseInt(this.options.passP),console.log(this.pp),this.myModel=this.options.resultModel,this.stepindex=this.options.stepIndex,this.Givenanswers=[],console.log("=============================="),console.log(this.Correctanswers,"Correctanswers"),console.log(this.Questions,"Questions"),console.log(this.Optns,"Optns"),console.log(this.stepId,"stepId"),console.log(this.TotalCount,"TotalCount"),console.log(this.pp,"pp"),console.log(this.myModel,"myModel"),console.log(this.stepindex,"stepindex"),console.log(this.Givenanswers,"Givenanswers"),console.log("==============================")},renderQuestion:function(){if(console.log(this.index+1),console.log(this.TotalCount),this.index+1!=this.TotalCount){this.index++;var a=5*this.index;this.$el.html("&nbsp"),this.$el.append('<div class="Progress" style="float:right;"><p>'+(this.index+1)+"/"+this.TotalCount+"</p> </div>"),this.$el.append('<div class="quizText"><textarea disabled>'+this.Questions[this.index]+"</textarea> </div>"),o0=encodeURI(this.Optns[a]),o1=encodeURI(this.Optns[a+1]),o2=encodeURI(this.Optns[a+2]),o3=encodeURI(this.Optns[a+3]),o4=encodeURI(this.Optns[a+4]),this.$el.append('<div class="quizOptions"><input type="radio" name="optn" value='+o0+">"+this.Optns[a]+'<br><input type="radio" name="optn" value='+o1+">"+this.Optns[a+1]+'<br><input type="radio" name="optn" value='+o2+">"+this.Optns[a+2]+'<br><input type="radio" name="optn" value='+o3+">"+this.Optns[a+3]+'<br><input type="radio" name="optn" value='+o4+">"+this.Optns[a+4]+"</div>"),this.$el.append('<div class="quizActions" ><button class="btn btn-danger" id="exitPressed">Exit</button><button class="btn btn-primary" id="nextPressed">Next</button></div>')}else{this.$el.html("&nbsp");var b=Math.round(this.Score/this.TotalCount*100);console.log(b),this.$el.append('<div class="quizText"><h4>You Scored '+Math.round(this.Score/this.TotalCount*100)+"%<h4></div>"),this.$el.append('<div class="quizActions" ><button class="btn btn-info" id="finishPressed">Finish</button></div>');var c=this.myModel.get("stepsStatus"),d=this.myModel.get("stepsResult");this.pp<=b&&(c[this.stepindex]="1",this.myModel.set("stepsStatus",c)),d[this.stepindex]=b.toString(),this.myModel.set("stepsResult",d),this.myModel.save(null,{success:function(a,b){console.log("Result Saved!")},error:function(){console.log("Not Saved")}}),this.pp<=b?this.$el.append("</BR><p>You have Passed this Level</p>"):this.$el.append("</BR><p>You are unable to pass this Level. Read carefully and try again</p>")}},start:function(){$("div.takeQuizDiv").show(),this.renderQuestion()},render:function(){document.getElementById("cont").style.opacity="0.1",document.getElementById("nav").style.opacity="0.1",this.start()}})});